import{f as Y,a as I,t as ie,c as Pe}from"../chunks/Bdvgn338.js";import{p as Ve,U as y,V as A,W as De,k as e,X as P,a as we,Z as i,f as ce,s as a,t as V,c as g,r as d,_ as ke}from"../chunks/ZtE6Gyvq.js";import{d as Be,s as K}from"../chunks/BnZ86L-c.js";import{e as Fe,i as Ge}from"../chunks/BiYp4j9H.js";import{i as X}from"../chunks/CdTPX8-T.js";import{i as Z,r as Le,s as J}from"../chunks/DhWXMPZY.js";import{b as Oe}from"../chunks/CVoLLLxN.js";import{B as ze,a as Se,b as We,g as je,d as Ue}from"../chunks/BGuIuzZe.js";import{A as D,e as de,D as qe,N as ve,b as Ke}from"../chunks/CXrKfc7O.js";import{p as Q}from"../chunks/BciydY-1.js";var Xe=Y("<option> </option>"),Ze=Y('<div class="controls svelte-b6xay4"><div class="control-group svelte-b6xay4"><label for="chord-type" class="svelte-b6xay4">Chord Type</label> <select id="chord-type"></select></div> <div class="control-group svelte-b6xay4"><label for="inversion" class="svelte-b6xay4">Inversion</label> <select id="inversion"><option>Root</option><option>1st</option><option>2nd</option><option>3rd</option></select></div> <div class="control-group svelte-b6xay4"><label class="svelte-b6xay4"><input type="checkbox"/> Optimized Voice Leading</label></div> <div class="control-group svelte-b6xay4"><label for="voicing" class="svelte-b6xay4">Voicing</label> <select id="voicing"><option>Full Right Hand</option><option>Full Left Hand</option><option>1 & 7 Left / 3 & 5 Right</option><option>1 & 5 Left / 3 & 7 Right</option><option>Rootless A (3-5-7-9)</option><option>Rootless B (7-9-3-5)</option></select></div></div>'),Je=Y("<!> <!>",1);function lt(ue,r){Ve(r,!0);const he="Play the notes of the displayed chord on your MIDI keyboard. Try to match the voicing and inversion shown.";let E=["maj7","min7","7","dom7","half-dim7","dim7"],v=y(A(Q.url.searchParams.get("root")??r.rootKey??(r.randomMode?D[Math.floor(Math.random()*D.length)]:"C"))),u=y(A(Q.url.searchParams.get("quality")??r.chordType??(r.randomMode?E[Math.floor(Math.random()*E.length)]:"maj7"))),h=y(A(r.inversion??(r.randomMode?Math.floor(Math.random()*4):0))),m=y(A(r.voicing??(r.randomMode?de[Math.floor(Math.random()*de.length)]:"full-right"))),H=y(!1),w=y(!1),k=y(A([]));function me(){const o=D[Math.floor(Math.random()*D.length)],t=E[Math.floor(Math.random()*E.length)];let n;if(e(w)&&e(k).length>0){const l=o+"3",s=ve[l];n=Ue(s,t,e(k))}else n=Math.floor(Math.random()*4);i(v,o,!0),i(u,t,!0),i(h,n,!0)}function fe(){const o=$(e(v));i(k,o,!0),me(),r.onComplete?.()}function $(o){const l=["C","C#","Db","D","D#","Eb","E","F","F#","Gb","G","G#","Ab","A","A#","Bb","B"].indexOf(e(v))>=10?"3":qe,s=e(v)+l,f=ve[s],M=Se(f,e(u),e(h));return We(M,e(m))}function pe(o,t,n){const l=n.map(f=>f%12),s=t.noteNumber%12;if(l.includes(s)){const f=n.includes(t.noteNumber),M=e(m).startsWith("rootless");return f||M?{isCorrect:!0,message:f?"Correct chord tone!":"Correct chord tone (octave ignored)!",collected:!0,resetCollected:!1}:{isCorrect:!1,message:"Correct note, but check the inversion/octave!",collected:!1,resetCollected:!0}}return{isCorrect:!1,message:"Not a chord tone. Try again!",collected:!1,resetCollected:!0}}function _e(o){const t=o.target;i(u,t.value,!0)}function ge(o){const t=o.target;i(h,parseInt(t.value),!0)}function Ce(o){const t=o.target;i(m,t.value,!0)}function be(o){try{const t=je(e(v),e(u),e(h),e(m));return console.debug("Generated score data:",{currentRoot:e(v),chordType:e(u),voicing:e(m),inversion:e(h),scoreData:t}),{leftHand:t.leftHand,rightHand:t.rightHand,selectedNote:e(v)}}catch(t){return console.error("Error generating score data:",t),{selectedNote:"C",leftHand:[[]],rightHand:[["C4","E4","G4"]]}}}function ye(o,t){if(e(m).startsWith("rootless")){const n=new Set(o.map(s=>s%12)),l=new Set(t.map(s=>s%12));return n.size===l.size&&[...n].every(s=>l.has(s))}return o.length===t.length&&o.every(n=>t.includes(n))}function Me(){i(H,!1)}let xe=P(()=>`${e(v)} ${e(u)} - ${Ie(e(h))}`),Ne=P(()=>r.prompt??e(xe));function Ie(o){switch(o){case 0:return"Root Position";case 1:return"1st Inversion";case 2:return"2nd Inversion";case 3:return"3rd Inversion";default:return"Root Position"}}ze(ue,{get randomMode(){return r.randomMode},generateExpectedNotes:$,generateScoreProps:be,validateNoteEvent:pe,isCompleted:ye,onReset:Me,onComplete:fe,get initialNote(){return e(v)},description:he,get progressiveHints(){return r.progressiveHints},get prompt(){return e(Ne)},children:(t,n=De)=>{const l=P(()=>e(H)),s=P(()=>n().completed);var f=Je(),M=ce(f);{var Re=c=>{var p=ie();V(()=>K(p,i(H,!0))),I(c,p)},Te=c=>{var p=Pe(),R=ce(p);{var _=x=>{var N=ie();V(()=>K(N,i(H,!1))),I(x,N)};X(R,x=>{!e(s)&&e(l)&&x(_)},!0)}I(c,p)};X(M,c=>{e(s)&&!e(l)?c(Re):c(Te,!1)})}var Ae=a(M,2);{var Ee=c=>{var p=Ze(),R=g(p),_=a(g(R),2);_.__change=_e,Fe(_,21,()=>Ke,Ge,(U,q)=>{var T=Xe(),He=g(T,!0);d(T);var le={};V(()=>{K(He,e(q)),le!==(le=e(q))&&(T.value=(T.__value=e(q))??"")}),I(U,T)}),d(_);var x;Z(_),d(R);var N=a(R,2),C=a(g(N),2);C.__change=ge;var B=g(C);B.value=B.__value=0;var F=a(B);F.value=F.__value=1;var G=a(F);G.value=G.__value=2;var ee=a(G);ee.value=ee.__value=3,d(C);var te;Z(C),d(N);var L=a(N,2),oe=g(L),ae=g(oe);Le(ae),ke(),d(oe),d(L);var re=a(L,2),b=a(g(re),2);b.__change=Ce;var O=g(b);O.value=O.__value="full-right";var z=a(O);z.value=z.__value="full-left";var S=a(z);S.value=S.__value="1735";var W=a(S);W.value=W.__value="1537";var j=a(W);j.value=j.__value="rootless-a";var ne=a(j);ne.value=ne.__value="rootless-b",d(b);var se;Z(b),d(re),d(p),V(()=>{x!==(x=e(u))&&(_.value=(_.__value=e(u))??"",J(_,e(u))),te!==(te=e(h))&&(C.value=(C.__value=e(h))??"",J(C,e(h))),se!==(se=e(m))&&(b.value=(b.__value=e(m))??"",J(b,e(m)))}),Oe(ae,()=>e(w),U=>i(w,U)),I(c,p)};X(Ae,c=>{!r.randomMode&&!Q.url.searchParams.get("unitId")&&c(Ee)})}I(t,f)},$$slots:{default:!0}}),we()}Be(["change"]);export{lt as component};
