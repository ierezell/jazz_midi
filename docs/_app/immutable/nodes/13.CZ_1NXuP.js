import{f as U,a as K}from"../chunks/Bdvgn338.js";import{p as ae,U as w,V as y,W as ne,k as e,X as H,a as ce,Z as o,c as _,r as M,f as ie,_ as ue,s as b,t as de}from"../chunks/ZtE6Gyvq.js";import{d as fe}from"../chunks/BnZ86L-c.js";import{i as ve}from"../chunks/CdTPX8-T.js";import{r as me,i as V,s as D}from"../chunks/PYtk8PMn.js";import{b as ge}from"../chunks/CVoLLLxN.js";import{p as pe}from"../chunks/-nZJNBOr.js";import{S as he,N as F,M as O}from"../chunks/CXrKfc7O.js";import{B as _e}from"../chunks/Dal78mhG.js";import{p as Me}from"../chunks/D_WhGCa7.js";function be(E,u,C){let a="right";typeof C=="boolean"?a=C?"right":"left":a=C;const g=he[u],n=[];if(a==="left"||a==="both"){const d=F[E+"2"];n.push(...g.map(v=>d+v))}if(a==="right"||a==="both"){const d=F[E+"3"];n.push(...g.map(v=>d+v))}return a==="both"&&n.sort((d,v)=>d-v),n}var Ce=U('<div class="control-group svelte-1l89l8c"><label class="svelte-1l89l8c"><input type="checkbox" class="svelte-1l89l8c"/> In order</label></div> <div class="control-group svelte-1l89l8c"><label for="handMode" class="svelte-1l89l8c">Hand:</label> <select id="handMode" class="svelte-1l89l8c"><option class="svelte-1l89l8c">Right Hand</option><option class="svelte-1l89l8c">Left Hand</option><option class="svelte-1l89l8c">Both Hands</option></select></div> <div class="control-group svelte-1l89l8c"><label for="scaleMode" class="svelte-1l89l8c">Scale mode:</label> <select id="scaleMode" class="svelte-1l89l8c"><option class="svelte-1l89l8c">Major</option><option class="svelte-1l89l8c">Minor</option></select></div>',1),Se=U('<div class="scale-controls svelte-1l89l8c"><!></div>');function Ie(E,u){ae(u,!0);const C="Play the scale shown, ascending and/or descending, using your MIDI keyboard. Try to follow the correct order.";let a=pe(u,"strictMode",3,!0),g=w(y(u.sequentialMode??!1)),n=w(y(u.handMode??"right")),d=w(y(u.scaleMode??"Maj")),v=H(()=>u.rootKey??"C"),f=w(y([])),r=w(y(new Set)),X=H(()=>`${e(v)} ${e(d)==="Maj"?"Major":"Minor"} Scale`),Z=H(()=>u.prompt??e(X));function J(){o(f,[],!0),o(r,new Set,!0)}function Q(l,t,s,c){return e(g)?$(t,s):ee(t,s)}function j(l){return be(e(v),e(d),e(n))}function Y(l){const s=j().map(c=>O[c]);return{selectedNote:e(v),leftHand:e(n)==="left"||e(n)==="both"?[s]:[],rightHand:e(n)==="right"||e(n)==="both"?[s]:[]}}function $(l,t,s){const c=e(f).length,i=t[c];if(a()?l.noteNumber===i:l.noteNumber%12===i%12)o(f,[...e(f),l.noteNumber],!0),o(r,new Set([...e(r),l.noteNumber]),!0);else{const m=O[i]?.slice(0,-1)??String(i);return o(f,[],!0),o(r,new Set,!0),{isCorrect:!1,message:`Wrong note! Expected ${m} ${a()?"":"(any octave)"}`,collected:!1,resetCollected:!0}}return e(f).length===t.length?{isCorrect:!0,message:"Perfect scale! ðŸŽµâœ¨",collected:!0,resetCollected:!1}:{isCorrect:!0,message:`Good! Note ${c+1}/${t.length}`,collected:!0,resetCollected:!1}}function ee(l,t,s){const c=t.map(m=>m%12),i=l.noteNumber%12;if(a()?t.includes(l.noteNumber):c.includes(i)){o(r,new Set([...e(r),l.noteNumber]),!0);let m=!1;if(a())m=e(r).size===t.length;else{const S=new Set([...e(r)].map(N=>N%12)),x=new Set(c);m=S.size===x.size}return m?{isCorrect:!0,message:"Perfect scale! ðŸŽµ",collected:!0,resetCollected:!1}:{isCorrect:!0,message:`Good! ${e(r).size}/${t.length} notes`,collected:!0,resetCollected:!1}}else return o(r,new Set,!0),{isCorrect:!1,message:"Wrong note!",resetCollected:!0,collected:!1}}function te(l,t){if(e(g))return e(f).length===t.length&&e(f).every((s,c)=>a()?s===t[c]:s%12===t[c]%12);if(a()){const s=[...new Set(t)];return e(r).size===s.length}else{const s=new Set([...e(r)].map(i=>i%12)),c=new Set(t.map(i=>i%12));return s.size===c.size}}function le(l){const t=l.target;o(g,t.checked,!0),o(r,new Set,!0),o(f,[],!0)}function oe(l){const t=l.target;o(n,t.value,!0),o(r,new Set,!0),o(f,[],!0)}function se(l){const t=l.target;o(d,t.value,!0),o(r,new Set,!0),o(f,[],!0)}{const l=(s,c=ne)=>{var i=Se(),q=_(i);{var m=S=>{var x=Ce(),N=ie(x),R=_(N),P=_(R);me(P),P.__change=le,ue(),M(R),M(N);var z=b(N,2),p=b(_(z),2);p.__change=oe;var k=_(p);k.value=k.__value="right";var I=b(k);I.value=I.__value="left";var A=b(I);A.value=A.__value="both",M(p);var B;V(p),M(z);var L=b(z,2),h=b(_(L),2);h.__change=se;var T=_(h);T.value=T.__value="Maj";var W=b(T);W.value=W.__value="Min",M(h);var G;V(h),M(L),de(()=>{B!==(B=e(n))&&(p.value=(p.__value=e(n))??"",D(p,e(n))),G!==(G=e(d))&&(h.value=(h.__value=e(d))??"",D(h,e(d)))}),ge(P,()=>e(g),re=>o(g,re)),K(S,x)};ve(q,S=>{!u.randomMode&&!Me.url.searchParams.get("unitId")&&S(m)})}M(i),K(s,i)};let t=H(()=>u.onComplete??(()=>{}));_e(E,{get randomMode(){return u.randomMode},generateExpectedNotes:j,generateScoreProps:Y,validateNoteEvent:Q,isCompleted:te,onReset:J,get onComplete(){return e(t)},get initialNote(){return e(v)},description:C,exerciseType:"scale",get progressiveHints(){return u.progressiveHints},get prompt(){return e(Z)},children:l,$$slots:{default:!0}})}ce()}fe(["change"]);export{Ie as component};
