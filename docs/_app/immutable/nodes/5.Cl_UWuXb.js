import"../chunks/NZTpNUN0.js";import{p as ue,N as R,O as J,g as me,k as e,c as fe,P as _e,f as V,a as K,s as g,d as _,b as N,Q as l,R as A,r as m,S as U,t as k,T as pe}from"../chunks/DPDCOiIW.js";import{d as ge,s as x}from"../chunks/ZRc7GTJ1.js";import{i as B}from"../chunks/CPFqVV7e.js";import{A as L,I as H,M as X,N as D,e as be,i as Ne}from"../chunks/Dh5yjYp3.js";import{i as he,s as Ce,a as Z}from"../chunks/abe3cog1.js";import{B as xe,c as ee}from"../chunks/DkJRdrwJ.js";function Me(M,a,c){const h=M.target;l(a,h.value,!0),l(c,new Set,!0)}var ye=V('<option class="svelte-152807m"> </option>'),Ie=(M,a)=>a("treble"),Ee=(M,a)=>a("bass"),we=V('<div class="control-group svelte-152807m"><label for="intervalType" class="svelte-152807m">Interval:</label> <select id="intervalType" class="svelte-152807m"></select></div> <div class="control-group svelte-152807m"><span id="clef-label" class="svelte-152807m">Clef:</span> <div class="clef-buttons svelte-152807m" aria-labelledby="clef-label"><button>ðŸŽ¼ Treble</button> <button>ðŸŽµ Bass</button></div></div>',1),Se=V('<div class="interval-info svelte-152807m"><span class="root-note svelte-152807m"> </span> <span class="interval-name svelte-152807m"> </span> <span class="progress svelte-152807m"> </span></div>'),Te=V('<!> <div class="interval-controls svelte-152807m"><!> <!></div>',1);function De(M,a){ue(a,!0);let c=R(J(a.intervalType??(a.randomMode?L[Math.floor(Math.random()*L.length)]:"major3rd"))),h=R("treble"),d=R(J(new Set)),y=R(!1),I=R(null);function te(){l(d,new Set,!0),l(y,!1),l(I,null)}me(()=>{e(y)&&a.onComplete&&a.onComplete()});function ae(r){try{const t=e(h)==="bass"?"3":"4",o=ee(r,e(c),t),i=D[r+t],p=D[o+t];return l(I,i,!0),console.debug(`Interval ${H[e(c)]} from ${r}${t} to ${o}${t}:`,`Root MIDI: ${i}, Expected MIDI: ${p}`),[i,p]}catch(t){console.error("Error generating expected note:",t);const o=D.C4,i=D.E4;return l(I,o,!0),[o,i]}}function re(r){try{const t=ee(r,e(c),"4"),o=r+"4",i=t+"4",p=a.showBothNotes?[[o,i]]:[[i]];return{selectedNote:r,leftHand:[],rightHand:p}}catch(t){return console.error("Error generating score props:",t),{selectedNote:r,leftHand:[],rightHand:[["C4","E4"]]}}}function oe(r,t,o,i){const[p,j]=o,C=H[e(c)];return o.includes(t.noteNumber)?(l(d,new Set([...e(d),t.noteNumber]),!0),e(d).size===2?{isCorrect:!0,message:`Perfect ${C}! ðŸŽµâœ¨`,collected:!0,resetCollected:!1}:{isCorrect:!0,message:`Good! ${t.noteNumber===p?"root":C} played (${e(d).size}/2)`,collected:!0,resetCollected:!1}):(l(d,new Set,!0),{isCorrect:!1,message:`Wrong! You played ${X[t.noteNumber]?.slice(0,-1)}. Play ${C} from ${r}`,collected:!1,resetCollected:!0})}function se(r,t){const o=[...new Set(t)];return e(d).size===o.length}function O(r){l(h,r,!0),l(d,new Set,!0)}{const r=(i,p=_e)=>{var j=Te();const C=A(()=>e(y)),P=A(()=>p().completed);var q=K(j);{var le=s=>{var n=U();k(()=>x(n,l(y,!0))),N(s,n)},ne=s=>{var n=pe(),f=K(n);{var v=u=>{var b=U();k(()=>x(b,l(y,!1))),N(u,b)};B(f,u=>{!e(P)&&e(C)&&u(v)},!0)}N(s,n)};B(q,s=>{e(P)&&!e(C)?s(le):s(ne,!1)})}var Q=g(q,2),W=_(Q);{var ce=s=>{var n=we(),f=K(n),v=g(_(f),2);v.__change=[Me,c,d],be(v,21,()=>L,Ne,(G,S)=>{var T=ye(),de=_(T,!0);m(T);var F={};k(()=>{x(de,H[e(S)]),F!==(F=e(S))&&(T.value=(T.__value=e(S))??"")}),N(G,T)}),m(v);var u;he(v),m(f);var b=g(f,2),E=g(_(b),2),w=_(E);let z;w.__click=[Ie,O];var Y=g(w,2);let $;Y.__click=[Ee,O],m(E),m(b),k((G,S)=>{u!==(u=e(c))&&(v.value=(v.__value=e(c))??"",Ce(v,e(c))),z=Z(w,1,"clef-btn svelte-152807m",null,z,G),$=Z(Y,1,"clef-btn svelte-152807m",null,$,S)},[()=>({active:e(h)==="treble"}),()=>({active:e(h)==="bass"})]),N(s,n)};B(W,s=>{a.randomMode||s(ce)})}var ie=g(W,2);{var ve=s=>{var n=Se(),f=_(n),v=_(f);m(f);var u=g(f,2),b=_(u);m(u);var E=g(u,2),w=_(E);m(E),m(n),k(z=>{x(v,`Root: ${z??""}`),x(b,`â†’ ${H[e(c)]??""}`),x(w,`(${e(d).size??""}/2 notes)`)},[()=>X[e(I)]?.slice(0,-1)]),N(s,n)};B(ie,s=>{e(I)!==null&&s(ve)})}m(Q),N(i,j)};let t=A(()=>a.onComplete||(()=>{})),o=A(()=>a.rootKey||"C");xe(M,{get randomMode(){return a.randomMode},generateExpectedNotes:ae,generateScoreProps:re,validateNoteEvent:oe,isCompleted:se,onReset:te,get onComplete(){return e(t)},get initialNote(){return e(o)},children:r,$$slots:{default:!0}})}fe()}ge(["change","click"]);export{De as component};
