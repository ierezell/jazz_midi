import{f as Y,a as V}from"../chunks/CGs25f5Q.js";import{p as ie,U as N,V as y,g as ce,k as e,Z as r,W as ue,a as de,Y as S,c as h,r as p,f as fe,_ as ge,s as _,t as ve}from"../chunks/CPN3W99e.js";import{d as me}from"../chunks/Cf1jdkyt.js";import{i as he}from"../chunks/CO7pLaZ9.js";import{r as pe,i as D,s as F}from"../chunks/CZv5_2PD.js";import{b as _e}from"../chunks/DNtVZOVd.js";import{S as Me,N as O,M as w,d as U}from"../chunks/CXrKfc7O.js";import{B as be}from"../chunks/BvxIlnQz.js";import{p as H}from"../chunks/j92QXW3d.js";function A(C,a,M){let f="right";typeof M=="boolean"?f=M?"right":"left":f=M;const b=Me[a],d=[];if(f==="left"||f==="both"){const o=O[C+"2"];d.push(...b.map(i=>o+i))}if(f==="right"||f==="both"){const o=O[C+"3"];d.push(...b.map(i=>o+i))}return f==="both"&&d.sort((o,i)=>o-i),d}var Se=Y('<div class="control-group svelte-1l89l8c"><label class="svelte-1l89l8c"><input type="checkbox" class="svelte-1l89l8c"/> In order</label></div> <div class="control-group svelte-1l89l8c"><label for="handMode" class="svelte-1l89l8c">Hand:</label> <select id="handMode" class="svelte-1l89l8c"><option class="svelte-1l89l8c">Right Hand</option><option class="svelte-1l89l8c">Left Hand</option><option class="svelte-1l89l8c">Both Hands</option></select></div> <div class="control-group svelte-1l89l8c"><label for="scaleMode" class="svelte-1l89l8c">Scale mode:</label> <select id="scaleMode" class="svelte-1l89l8c"><option class="svelte-1l89l8c">Major</option><option class="svelte-1l89l8c">Minor</option></select></div>',1),Ce=Y('<div class="scale-controls svelte-1l89l8c"><!></div>');function Ie(C,a){ie(a,!0);const M="Play the scale shown, ascending and/or descending, using your MIDI keyboard. Try to follow the correct order.",f=S(()=>H.url.searchParams.get("root")),b=S(()=>H.url.searchParams.get("hand"));let d=N(y(a.sequentialMode??(a.randomMode?Math.random()>.5:!0))),o=N(y(a.handMode??(a.randomMode?Math.random()>.5?"right":"left":"right")));ce(()=>{e(b)&&r(o,e(b),!0)});let i=S(()=>H.url.searchParams.get("mode")??a.scaleMode??(a.randomMode?U[Math.floor(Math.random()*U.length)]:"Maj")),Z=S(()=>e(f)??a.rootKey??"C"),s=N(y(new Set)),c=N(y([]));function J(){r(s,new Set,!0),r(c,[],!0)}function Q(l){const t=A(l,e(i),e(o));return console.debug(`Scale for ${l} (${e(o)}):`,t.map(n=>w[n])),t}function X(l){let t=[],n=[];return(e(o)==="left"||e(o)==="both")&&(t=A(l,e(i),"left").map(u=>[w[u]])),(e(o)==="right"||e(o)==="both")&&(n=A(l,e(i),"right").map(u=>[w[u]])),{selectedNote:l,leftHand:t,rightHand:n}}function $(l,t,n,g){return e(d)?ee(t,n):te(t,n)}function ee(l,t,n){const g=e(c).length,u=t[g];if(l.noteNumber===u)r(c,[...e(c),l.noteNumber],!0),r(s,new Set([...e(s),l.noteNumber]),!0);else{const E=w[u]?.slice(0,-1)??String(u);return r(c,[],!0),r(s,new Set,!0),{isCorrect:!1,message:`Wrong note! Expected ${E} (note ${g+1})`,collected:!1,resetCollected:!0}}return e(c).length===t.length?{isCorrect:!0,message:"Perfect scale! ðŸŽµâœ¨",collected:!0,resetCollected:!1}:{isCorrect:!0,message:`Good! Note ${g+1}/${t.length}`,collected:!0,resetCollected:!1}}function te(l,t,n){return t.includes(l.noteNumber)?(r(s,new Set([...e(s),l.noteNumber]),!0),e(s).size===t.length?{isCorrect:!0,message:"Perfect scale! ðŸŽµ",collected:e(s).has(l.noteNumber),resetCollected:!1}:{isCorrect:!0,message:`Good! ${e(s).size}/${t.length} notes`,collected:e(s).has(l.noteNumber),resetCollected:!1}):(r(s,new Set,!0),{isCorrect:!1,message:"Wrong note!",resetCollected:!0,collected:!1})}function le(l,t){if(e(d))return e(c).length===t.length&&e(c).every((n,g)=>n===t[g]);{const n=[...new Set(t)];return e(s).size===n.length}}function re(l){const t=l.target;r(d,t.checked,!0),r(s,new Set,!0),r(c,[],!0)}function oe(l){const t=l.target;r(o,t.value,!0),r(s,new Set,!0),r(c,[],!0)}function ae(l){const t=l.target;r(i,t.value),r(s,new Set,!0),r(c,[],!0)}{const l=(n,g=ue)=>{var u=Ce(),E=h(u);{var se=P=>{var j=Se(),x=fe(j),z=h(x),k=h(z);pe(k),k.__change=re,ge(),p(z),p(x);var q=_(x,2),v=_(h(q),2);v.__change=oe;var I=h(v);I.value=I.__value="right";var R=_(I);R.value=R.__value="left";var B=_(R);B.value=B.__value="both",p(v);var L;D(v),p(q);var W=_(q,2),m=_(h(W),2);m.__change=ae;var T=h(m);T.value=T.__value="Maj";var G=_(T);G.value=G.__value="Min",p(m);var K;D(m),p(W),ve(()=>{L!==(L=e(o))&&(v.value=(v.__value=e(o))??"",F(v,e(o))),K!==(K=e(i))&&(m.value=(m.__value=e(i))??"",F(m,e(i)))}),_e(k,()=>e(d),ne=>r(d,ne)),V(P,j)};he(E,P=>{!a.randomMode&&!H.url.searchParams.get("unitId")&&P(se)})}p(u),V(n,u)};let t=S(()=>a.onComplete??(()=>{}));be(C,{get randomMode(){return a.randomMode},generateExpectedNotes:Q,generateScoreProps:X,validateNoteEvent:$,isCompleted:le,onReset:J,get onComplete(){return e(t)},get initialNote(){return e(Z)},description:M,exerciseType:"scale",get progressiveHints(){return a.progressiveHints},get prompt(){return a.prompt},children:l,$$slots:{default:!0}})}de()}me(["change"]);export{Ie as component};
