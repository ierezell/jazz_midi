import{f as T,a as q,t as Oe}from"../chunks/Bdvgn338.js";import{p as ze,U as x,V as O,g as Ge,k as e,X as J,Z as l,a as Le,s as n,c as d,r as u,t as oe,_ as Te}from"../chunks/ZtE6Gyvq.js";import{d as Fe,s as de}from"../chunks/BnZ86L-c.js";import{e as je,i as Ue}from"../chunks/BFmSp7VO.js";import{i as Q}from"../chunks/CdTPX8-T.js";import{r as Ke,i as se,s as ae,b as Ve}from"../chunks/U2hmf67d.js";import{b as We}from"../chunks/CVoLLLxN.js";import{p as fe}from"../chunks/-nZJNBOr.js";import{S as Ce,N as re,M as be,d as Me,A as ne}from"../chunks/CXrKfc7O.js";import{B as Xe}from"../chunks/BJLlDXwa.js";import{p as Ze}from"../chunks/Daj7DTR9.js";import{u as Je}from"../chunks/BmZ7kVW3.js";function Qe(Y,c,F){let f="right";typeof F=="boolean"?f=F?"right":"left":f=F;const $=Ce[c],z=[];if(f==="left"||f==="both"){const P=re[Y+"2"];z.push(...$.map(A=>P+A))}if(f==="right"||f==="both"){const P=re[Y+"3"];z.push(...$.map(A=>P+A))}return f==="both"&&z.sort((P,A)=>P-A),z}var Ye=T('<span class="lock-icon svelte-1l89l8c">ðŸ”’</span>'),$e=T("<span> <!></span>"),et=T('<div class="unlock-panel svelte-1l89l8c"><h4 class="svelte-1l89l8c">Available Root Notes:</h4> <div class="notes-grid svelte-1l89l8c"></div> <p class="unlock-hint svelte-1l89l8c">Practice scales to level up and unlock more root notes! <!></p></div>'),tt=T('<div class="unlock-status svelte-1l89l8c"><button class="info-btn svelte-1l89l8c"> </button> <!></div>'),lt=T('<div class="settings-panel svelte-1l89l8c"><div class="control-group svelte-1l89l8c"><label class="svelte-1l89l8c"><input type="checkbox" class="svelte-1l89l8c"/> In order</label></div> <div class="control-group svelte-1l89l8c"><label for="handMode" class="svelte-1l89l8c">Hand:</label> <select id="handMode" class="svelte-1l89l8c"><option class="svelte-1l89l8c">Right Hand</option><option class="svelte-1l89l8c">Left Hand</option><option class="svelte-1l89l8c">Both Hands</option></select></div> <div class="control-group svelte-1l89l8c"><label for="scaleMode" class="svelte-1l89l8c">Scale mode:</label> <select id="scaleMode" class="svelte-1l89l8c"><option class="svelte-1l89l8c">Major</option><option class="svelte-1l89l8c">Minor</option></select></div> <div class="control-group svelte-1l89l8c"><label for="octaves" class="svelte-1l89l8c">Octaves:</label> <select id="octaves" class="svelte-1l89l8c"><option class="svelte-1l89l8c">1 Octave</option><option class="svelte-1l89l8c">2 Octaves</option><option class="svelte-1l89l8c">3 Octaves</option></select></div> <div class="control-group svelte-1l89l8c"><label for="direction" class="svelte-1l89l8c">Direction:</label> <select id="direction" class="svelte-1l89l8c"><option class="svelte-1l89l8c">Ascending â†‘</option><option class="svelte-1l89l8c">Descending â†“</option><option class="svelte-1l89l8c">Up & Down â†•</option></select></div></div>'),ot=T('<div class="scale-controls svelte-1l89l8c"><!> <!></div>');function gt(Y,c){ze(c,!0);const F="Play the scale shown, ascending and/or descending, using your MIDI keyboard. Try to follow the correct order.";let f=fe(c,"strictMode",3,!0),$=fe(c,"octaves",3,2),z=fe(c,"direction",3,"up-down");function P(o){const t=[["C"],["C","G","F"],["C","G","F","D","Bb"],["C","G","F","D","Bb","A","Eb"],["C","G","F","D","Bb","A","Eb","E","Ab"],["C","G","F","D","Bb","A","Eb","E","Ab","B","Db"],ne],s=Math.min(Math.floor(o/2),t.length-1);return t[s]}let A=J(()=>Je.getProfile().level),h=J(()=>P(e(A))),ce=x(!1),j=x(O(c.sequentialMode??!1)),C=x(O(c.handMode??"right")),D=x(O(c.scaleMode??"Maj")),R=x(O($())),S=x(O(z())),ie=x("C"),G=J(()=>c.rootKey??e(ie));Ge(()=>{!c.rootKey&&e(h).length>0&&l(ie,c.randomMode?e(h)[Math.floor(Math.random()*e(h).length)]:e(h)[0],!0)});let p=x(O([])),i=x(O(new Set)),Se=J(()=>`${e(G)} ${e(D)==="Maj"?"Major":"Minor"} Scale`),Ne=J(()=>c.prompt??e(Se));function we(){l(p,[],!0),l(i,new Set,!0)}function ke(o,t,s,r){return e(j)?Ee(t,s):xe(t,s)}function pe(o){const t=Qe(e(G),e(D),e(C));if(e(R)===1&&e(S)==="up")return t;const s=e(C)==="left"?2:3,r=Ce[e(D)],a=[];if(e(S)==="up"||e(S)==="up-down")for(let m=0;m<e(R);m++){const v=re[e(G)+(s+m)];r.forEach(_=>{a.push(v+_)})}if(e(S)==="down"||e(S)==="up-down"){const m=[];for(let v=0;v<e(R);v++){const _=re[e(G)+(s+v)];r.forEach(b=>{m.push(_+b)})}if(e(S)==="down")a.push(...m.reverse());else{const v=[...m].reverse().slice(1);a.push(...v)}}return a}function ye(o){const r=pe().map(a=>be[a]).map(a=>[a]);return{selectedNote:e(G),leftHand:e(C)==="left"||e(C)==="both"?r:[],rightHand:e(C)==="right"||e(C)==="both"?r:[]}}function Ee(o,t,s){const r=e(p).length,a=t[r];if(f()?o.noteNumber===a:o.noteNumber%12===a%12)l(p,[...e(p),o.noteNumber],!0),l(i,new Set([...e(i),o.noteNumber]),!0);else{const v=be[a]?.slice(0,-1)??String(a);return l(p,[],!0),l(i,new Set,!0),{isCorrect:!1,message:`Wrong note! Expected ${v} ${f()?"":"(any octave)"}`,collected:!1,resetCollected:!0}}return e(p).length===t.length?{isCorrect:!0,message:"Perfect scale! ðŸŽµâœ¨",collected:!0,resetCollected:!1}:{isCorrect:!0,message:`Good! Note ${r+1}/${t.length}`,collected:!0,resetCollected:!1}}function xe(o,t,s){const r=t.map(v=>v%12),a=o.noteNumber%12;if(f()?t.includes(o.noteNumber):r.includes(a)){l(i,new Set([...e(i),o.noteNumber]),!0);let v=!1;if(f())v=e(i).size===t.length;else{const _=new Set([...e(i)].map(N=>N%12)),b=new Set(r);v=_.size===b.size}return v?{isCorrect:!0,message:"Perfect scale! ðŸŽµ",collected:!0,resetCollected:!1}:{isCorrect:!0,message:`Good! ${e(i).size}/${t.length} notes`,collected:!0,resetCollected:!1}}else return l(i,new Set,!0),{isCorrect:!1,message:"Wrong note!",resetCollected:!0,collected:!1}}function Ae(o,t){if(e(j))return e(p).length===t.length&&e(p).every((s,r)=>f()?s===t[r]:s%12===t[r]%12);if(f()){const s=[...new Set(t)];return e(i).size===s.length}else{const s=new Set([...e(i)].map(a=>a%12)),r=new Set(t.map(a=>a%12));return s.size===r.size}}function De(o){const t=o.target;l(j,t.checked,!0),l(i,new Set,!0),l(p,[],!0)}function Pe(o){const t=o.target;l(C,t.value,!0),l(i,new Set,!0),l(p,[],!0)}function Re(o){const t=o.target;l(D,t.value,!0),l(i,new Set,!0),l(p,[],!0)}function Be(o){const t=o.target;l(R,parseInt(t.value),!0),l(i,new Set,!0),l(p,[],!0)}function He(o){const t=o.target;l(S,t.value,!0),l(i,new Set,!0),l(p,[],!0)}function Ie(){if(c.randomMode){const o=e(h)[Math.floor(Math.random()*e(h).length)],t=Me[Math.floor(Math.random()*Me.length)];l(ie,o,!0),l(D,t,!0),l(i,new Set,!0),l(p,[],!0)}c.onComplete?.()}Xe(Y,{get randomMode(){return c.randomMode},generateExpectedNotes:pe,generateScoreProps:ye,validateNoteEvent:ke,isCompleted:Ae,onReset:we,onComplete:Ie,get initialNote(){return e(G)},description:F,exerciseType:"scale",get progressiveHints(){return c.progressiveHints},get prompt(){return e(Ne)},showTempoControl:!0,timingModeLabel:"Play scale on beat",children:t=>{var s=ot(),r=d(s);{var a=_=>{var b=tt(),N=d(b);N.__click=()=>l(ce,!e(ce));var ee=d(N);u(N);var U=n(N,2);{var K=M=>{var B=et(),H=n(d(B),2);je(H,21,()=>ne,Ue,(g,w)=>{var k=$e();let X;var L=d(k),y=n(L);{var Z=E=>{var le=Ye();q(E,le)};Q(y,E=>{e(h).includes(e(w))||E(Z)})}u(k),oe(E=>{X=Ve(k,1,"note-badge svelte-1l89l8c",null,X,E),de(L,`${e(w)??""} `)},[()=>({unlocked:e(h).includes(e(w))})]),q(g,k)}),u(H);var V=n(H,2),te=n(d(V));{var W=g=>{var w=Oe();oe(k=>de(w,`Next unlock at level ${k??""}`),[()=>Math.floor(e(h).length/1.5)*2+2]),q(g,w)};Q(te,g=>{e(h).length<ne.length&&g(W)})}u(V),u(B),q(M,B)};Q(U,M=>{e(ce)&&M(K)})}u(b),oe(()=>de(ee,`${e(h).length??""}/${ne.length??""} Root Notes Unlocked (Level ${e(A)??""})`)),q(_,b)};Q(r,_=>{c.randomMode&&_(a)})}var m=n(r,2);{var v=_=>{var b=lt(),N=d(b),ee=d(N),U=d(ee);Ke(U),U.__change=De,Te(),u(ee),u(N);var K=n(N,2),M=n(d(K),2);M.__change=Pe;var B=d(M);B.value=B.__value="right";var H=n(B);H.value=H.__value="left";var V=n(H);V.value=V.__value="both",u(M);var te;se(M),u(K);var W=n(K,2),g=n(d(W),2);g.__change=Re;var w=d(g);w.value=w.__value="Maj";var k=n(w);k.value=k.__value="Min",u(g);var X;se(g),u(W);var L=n(W,2),y=n(d(L),2);y.__change=Be;var Z=d(y);Z.value=Z.__value="1";var E=n(Z);E.value=E.__value="2";var le=n(E);le.value=le.__value="3",u(y);var _e;se(y),u(L);var ge=n(L,2),I=n(d(ge),2);I.__change=He;var ue=d(I);ue.value=ue.__value="up";var ve=n(ue);ve.value=ve.__value="down";var he=n(ve);he.value=he.__value="up-down",u(I);var me;se(I),u(ge),u(b),oe(()=>{te!==(te=e(C))&&(M.value=(M.__value=e(C))??"",ae(M,e(C))),X!==(X=e(D))&&(g.value=(g.__value=e(D))??"",ae(g,e(D))),_e!==(_e=e(R))&&(y.value=(y.__value=e(R))??"",ae(y,e(R))),me!==(me=e(S))&&(I.value=(I.__value=e(S))??"",ae(I,e(S)))}),We(U,()=>e(j),qe=>l(j,qe)),q(_,b)};Q(m,_=>{!c.randomMode&&!Ze.url.searchParams.get("unitId")&&_(v)})}u(s),q(t,s)},$$slots:{default:!0}}),Le()}Fe(["click","change"]);export{gt as component};
