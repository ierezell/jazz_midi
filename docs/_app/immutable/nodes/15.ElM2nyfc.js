import{f as P,a as _,t as ae,c as be}from"../chunks/CmtjIIgE.js";import{p as ye,U as N,V as ne,W as Pe,v as e,a as Ve,Z as R,X as we,c as p,f as S,s as n,t as b,Y as y,r as f}from"../chunks/ipsVM-65.js";import{d as Te,s as L}from"../chunks/Brx6x_Mu.js";import{e as Ee,b as Fe,i as Ne,a as le,s as ie}from"../chunks/CO8AMRA4.js";import{i as A}from"../chunks/D8W4ZUO4.js";import{p as Le}from"../chunks/CSIEbD0i.js";import{B as Ae,d as De,a as X}from"../chunks/n6RJpNS9.js";import{f as ce,M as D,N as x,D as M}from"../chunks/DTRnenjV.js";import{p as ve}from"../chunks/CGS6TK9b.js";var Ke=P('<div class="control-group svelte-1jk8q9u"><label for="inversion" class="svelte-1jk8q9u">Inversion:</label> <select id="inversion" class="svelte-1jk8q9u"><option class="svelte-1jk8q9u">Root</option><option class="svelte-1jk8q9u">1st</option><option class="svelte-1jk8q9u">2nd</option><option class="svelte-1jk8q9u">3rd</option></select></div> <div class="control-group svelte-1jk8q9u"><label for="voicing" class="svelte-1jk8q9u">Voicing:</label> <select id="voicing" class="svelte-1jk8q9u"><option class="svelte-1jk8q9u">Full Right Hand</option><option class="svelte-1jk8q9u">Full Left Hand</option><option class="svelte-1jk8q9u">1 & 7 Left / 3 & 5 Right</option><option class="svelte-1jk8q9u">1 & 5 Left / 3 & 7 Right</option></select></div>',1),Ue=P("<div> </div>"),$e=P('<div class="completion svelte-1jk8q9u">ðŸŽ‰ ii-V-I Completed!</div>'),Be=P('<!> <div class="progression-controls svelte-1jk8q9u"><!> <div class="chord-progress svelte-1jk8q9u"></div></div> <div class="exercise-status svelte-1jk8q9u"><div class="current-chord svelte-1jk8q9u"> </div> <!></div>',1),Ge=P('<div class="progression-exercise svelte-1jk8q9u"><!></div>');function Qe(ue,k){ye(k,!0);const de="Play the II-V-I progression as shown. Use the correct chords and voicings for each step.";let V=Le(k,"randomMode",3,!1);const fe=y(()=>ve.url.searchParams.get("key"));let l=N(0),h=N(ne(k.inversion??(V()?Math.floor(Math.random()*4):0))),I=N(ne(k.voicing??(V()?ce[Math.floor(Math.random()*ce.length)]:"full-right"))),pe=y(()=>e(fe)??k.rootKey??"C"),w=N(!1);function me(){T(),R(w,!1)}function T(){R(l,0)}function Y(t){const o=x[t+M]+2,a=x[t+M]+7,i=x[t+M],v=X(o,"min7",e(h)),C=X(a,"7",e(h)),q=X(i,"maj7",e(h));return[v,C,q][e(l)]}function ge(t){const o=Y(t);return[o.root,o.third,o.fifth,o.seventh].filter(a=>a!=null)}function _e(t,o,a,i){const v=E(t)[e(l)];if(a.includes(o.noteNumber)){const u=i.filter(U=>a.includes(U)).length,F=a.length;return u===F?e(l)<2?(setTimeout(()=>{we(l)},1e3),{isCorrect:!0,message:Z(),collected:!0,resetCollected:!1}):{isCorrect:!0,message:Z(),collected:!0,resetCollected:!1}:{isCorrect:!0,message:`Good! ${u}/${F} notes for ${v}`,collected:!0,resetCollected:!1}}const q=a.filter(u=>!i.includes(u)).map(u=>D[u].slice(0,-1)).join(", ");return{isCorrect:!1,message:`Wrong note. For ${v} expected: ${q}`,collected:!1,resetCollected:!0}}function he(t,o){if(o.length===0)return!1;const v=t.filter(C=>o.includes(C)).length===o.length&&e(l)===2;return v&&setTimeout(()=>{T()},2e3),v}function E(t="C"){const o=x[t+M]+2,a=x[t+M]+7,i=x[t+M];return[`${D[o].slice(0,-1)}m7`,`${D[a].slice(0,-1)}7`,`${D[i].slice(0,-1)}maj7`]}function Z(){return e(l)<2?`Great! Now play ${E()[e(l)+1]}`:"Perfect! Complete ii-V-I progression! ðŸŽµâœ¨"}function Ce(t){const o=t.target;R(h,parseInt(o.value),!0),T()}function je(t){const o=t.target;R(I,o.value,!0),T()}function ke(t){const o=Y(t);return{...De(o,e(I)),selectedNote:t}}var K=Ge(),qe=p(K);{const t=(a,i=Pe)=>{const v=y(()=>e(w)),C=y(()=>i().completed);var q=Be(),u=S(q);{var F=r=>{var c=ae();b(()=>L(c,R(w,!0))),_(r,c)},U=r=>{var c=be(),m=S(c);{var s=d=>{var g=ae();b(()=>L(g,R(w,!1))),_(d,g)};A(m,d=>{!e(C)&&e(v)&&d(s)},!0)}_(r,c)};A(u,r=>{e(C)&&!e(v)?r(F):r(U,!1)})}var $=n(u,2),z=p($);{var Re=r=>{var c=Ke(),m=S(c),s=n(p(m),2);s.__change=Ce;var d=p(s);d.value=d.__value=0;var g=n(d);g.value=g.__value=1;var G=n(g);G.value=G.__value=2;var ee=n(G);ee.value=ee.__value=3,f(s);var te;le(s),f(m);var oe=n(m,2),j=n(p(oe),2);j.__change=je;var H=p(j);H.value=H.__value="full-right";var W=n(H);W.value=W.__value="full-left";var O=n(W);O.value=O.__value="1735";var re=n(O);re.value=re.__value="1537",f(j);var se;le(j),f(oe),b(()=>{te!==(te=e(h))&&(s.value=(s.__value=e(h))??"",ie(s,e(h))),se!==(se=e(I))&&(j.value=(j.__value=e(I))??"",ie(j,e(I)))}),_(r,c)};A(z,r=>{!V()&&!ve.url.searchParams.get("unitId")&&r(Re)})}var J=n(z,2);Ee(J,21,()=>E(i().selectedNote),Ne,(r,c,m)=>{var s=Ue();let d;var g=p(s,!0);f(s),b(()=>{d=Fe(s,1,"chord-indicator svelte-1jk8q9u",null,d,{active:m===e(l),completed:m<e(l)}),L(g,e(c))}),_(r,s)}),f(J),f($);var Q=n($,2),B=p(Q),xe=p(B);f(B);var Me=n(B,2);{var Ie=r=>{var c=$e();_(r,c)};A(Me,r=>{i().completed&&r(Ie)})}f(Q),b(r=>L(xe,`Current: ${r??""} (${e(l)+1}/3)`),[()=>E(i().selectedNote)[e(l)]]),_(a,q)};let o=y(()=>k.onComplete??(()=>{}));Ae(qe,{get randomMode(){return V()},generateExpectedNotes:ge,generateScoreProps:ke,validateNoteEvent:_e,isCompleted:he,onReset:me,get onComplete(){return e(o)},get initialNote(){return e(pe)},description:de,exerciseType:"progression",children:t,$$slots:{default:!0}})}f(K),_(ue,K),Ve()}Te(["change"]);export{Qe as component};
