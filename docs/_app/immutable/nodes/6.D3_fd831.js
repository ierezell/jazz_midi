import{f as K,a as b,t as te,c as Me}from"../chunks/CFIxE8eA.js";import{p as Te,U as B,V as oe,W as He,k as e,X as h,a as Re,Z as x,f as F,s as a,c as m,r as _,t as P}from"../chunks/jpeKWS-T.js";import{d as Pe,s as S}from"../chunks/CMZx5vTi.js";import{e as Ee,i as Ne}from"../chunks/avTJGQda.js";import{i as W}from"../chunks/etsv1dl2.js";import{i as j,s as z}from"../chunks/CqnklocC.js";import{B as Ie,a as Ve,b as we,g as Ae}from"../chunks/anoD3tQK.js";import{e as ae,N as De,D as Le,b as ke}from"../chunks/CXrKfc7O.js";import{p as G}from"../chunks/N1SuJ8hO.js";var Be=K("<option> </option>"),Fe=K('<div class="control-group svelte-b6xay4"><label for="chord-type" class="svelte-b6xay4">Chord Type:</label> <select id="chord-type"></select></div> <div class="control-group svelte-b6xay4"><label for="inversion" class="svelte-b6xay4">Inversion:</label> <select id="inversion"><option>Root</option><option>1st</option><option>2nd</option><option>3rd</option></select></div> <div class="control-group svelte-b6xay4"><label for="voicing" class="svelte-b6xay4">Voicing:</label> <select id="voicing"><option>Full Right Hand</option><option>Full Left Hand</option><option>1 & 7 Left / 3 & 5 Right</option><option>1 & 5 Left / 3 & 7 Right</option><option>Rootless A (3-5-7-9)</option><option>Rootless B (7-9-3-5)</option></select></div>',1),Se=K('<!> <div class="controls svelte-b6xay4"><!></div>',1);function Ze(re,r){Te(r,!0);const ne="Play the notes of the displayed chord on your MIDI keyboard. Try to match the voicing and inversion shown.",se=h(()=>G.url.searchParams.get("root"));let U=["maj7","min7","7","dom7","half-dim7","dim7"],d=h(()=>G.url.searchParams.get("quality")??r.chordType??(r.randomMode?U[Math.floor(Math.random()*U.length)]:"maj7")),f=B(oe(r.inversion??(r.randomMode?Math.floor(Math.random()*4):0))),i=B(oe(r.voicing??(r.randomMode?ae[Math.floor(Math.random()*ae.length)]:"full-right"))),q=h(()=>e(se)??r.rootKey??"C"),H=B(!1);function le(o){const t=o+Le,n=De[t],c=Ve(n,e(d),e(f));return we(c,e(i))}function ie(o,t,n){const c=n.map(R=>R%12),s=t.noteNumber%12;if(c.includes(s)){if(n.includes(t.noteNumber))return{isCorrect:!0,message:"Correct chord tone!",collected:!0,resetCollected:!1};if(e(i).startsWith("rootless"))return{isCorrect:!0,message:"Correct chord tone (octave ignored)!",collected:!0,resetCollected:!1}}return{isCorrect:!1,message:"Not a chord tone. Try again!",collected:!1,resetCollected:!0}}function ce(o){const t=o.target;x(d,t.value)}function ve(o){const t=o.target;x(f,parseInt(t.value),!0)}function de(o){const t=o.target;x(i,t.value,!0)}function ue(o){try{const t=Ae(o,e(d),e(f),e(i));return console.debug("Generated score data:",{selectedNote:o,chordType:e(d),voicing:e(i),inversion:e(f),scoreData:t}),{leftHand:t.leftHand,rightHand:t.rightHand,selectedNote:o}}catch(t){return console.error("Error generating score data:",t),{selectedNote:"C",leftHand:[[]],rightHand:[["C4","E4","G4"]]}}}function _e(o,t){if(e(i).startsWith("rootless")){const n=new Set(o.map(s=>s%12)),c=new Set(t.map(s=>s%12));return n.size===c.size&&[...n].every(s=>c.has(s))}return o.length===t.length&&o.every(n=>t.includes(n))}function fe(){x(H,!1)}let pe=h(()=>`${e(q)} ${e(d)}`),ge=h(()=>r.prompt??e(pe));Ie(re,{get randomMode(){return r.randomMode},generateExpectedNotes:le,generateScoreProps:ue,validateNoteEvent:ie,isCompleted:_e,onReset:fe,get onComplete(){return r.onComplete},get initialNote(){return e(q)},description:ne,get progressiveHints(){return r.progressiveHints},get prompt(){return e(ge)},children:(t,n=He)=>{const c=h(()=>e(H)),s=h(()=>n().completed);var R=Se(),O=F(R);{var he=l=>{var u=te();P(()=>S(u,x(H,!0))),b(l,u)},me=l=>{var u=Me(),M=F(u);{var v=C=>{var y=te();P(()=>S(y,x(H,!1))),b(C,y)};W(M,C=>{!e(s)&&e(c)&&C(v)},!0)}b(l,u)};W(O,l=>{e(s)&&!e(c)?l(he):l(me,!1)})}var X=a(O,2),Ce=m(X);{var ye=l=>{var u=Fe(),M=F(u),v=a(m(M),2);v.__change=ce,Ee(v,21,()=>ke,Ne,(be,k)=>{var T=Be(),xe=m(T,!0);_(T);var ee={};P(()=>{S(xe,e(k)),ee!==(ee=e(k))&&(T.value=(T.__value=e(k))??"")}),b(be,T)}),_(v);var C;j(v),_(M);var y=a(M,2),p=a(m(y),2);p.__change=ve;var E=m(p);E.value=E.__value=0;var N=a(E);N.value=N.__value=1;var I=a(N);I.value=I.__value=2;var Z=a(I);Z.value=Z.__value=3,_(p);var J;j(p),_(y);var Q=a(y,2),g=a(m(Q),2);g.__change=de;var V=m(g);V.value=V.__value="full-right";var w=a(V);w.value=w.__value="full-left";var A=a(w);A.value=A.__value="1735";var D=a(A);D.value=D.__value="1537";var L=a(D);L.value=L.__value="rootless-a";var Y=a(L);Y.value=Y.__value="rootless-b",_(g);var $;j(g),_(Q),P(()=>{C!==(C=e(d))&&(v.value=(v.__value=e(d))??"",z(v,e(d))),J!==(J=e(f))&&(p.value=(p.__value=e(f))??"",z(p,e(f))),$!==($=e(i))&&(g.value=(g.__value=e(i))??"",z(g,e(i)))}),b(l,u)};W(Ce,l=>{!r.randomMode&&!G.url.searchParams.get("unitId")&&l(ye)})}_(X),b(t,R)},$$slots:{default:!0}}),Re()}Pe(["change"]);export{Ze as component};
