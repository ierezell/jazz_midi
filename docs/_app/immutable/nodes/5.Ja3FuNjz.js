import"../chunks/NZTpNUN0.js";import{p as ce,O as E,P as $,g as de,k as e,Q as ue,c as ve,R as a,f as W,a as A,s as z,b as _,S as D,d as T,r as h,T as Y,t as S,V as fe,W as pe}from"../chunks/DFYG1ZU2.js";import{d as me,s as V}from"../chunks/BgsxT_DW.js";import{i as B}from"../chunks/iFgn1dkZ.js";import{A as K,N as R,I as L,M as F,e as ge,i as _e}from"../chunks/Cxn_sF4j.js";import{i as he,r as xe,s as be}from"../chunks/DD47jCIl.js";import{b as ye}from"../chunks/DPC1RNvP.js";import{B as Me,c as J}from"../chunks/CcldRWvO.js";function Ne(x,s,b){const u=x.target;a(s,u.value,!0),a(b,new Set,!0)}function Ce(x,s,b){const u=x.target;a(s,u.checked,!0),a(b,new Set,!0)}var Ie=W('<option class="svelte-os8fbx"> </option>'),Te=W('<div class="control-group svelte-os8fbx"><label for="intervalType" class="svelte-os8fbx">Interval Type:</label> <select id="intervalType" class="svelte-os8fbx"></select></div> <div class="control-group svelte-os8fbx"><label class="svelte-os8fbx"><input type="checkbox" class="svelte-os8fbx"/> Right hand</label></div>',1),we=W('<!> <div class="controls svelte-os8fbx"><!></div>',1);function ze(x,s){ce(s,!0);const b="Play the interval shown on the staff using your MIDI keyboard. Listen and check your answer.";let u=s.randomMode,j=s.onComplete,U=s.intervalType,X=s.rightHandMode,Z=s.rootKey,v=E($(U??(u?K[Math.floor(Math.random()*K.length)]:"major3rd"))),y=E($(X??(u?Math.random()>.5:!0))),c=E($(new Set)),M=E(!1);function ee(){a(c,new Set,!0),a(M,!1)}de(()=>{e(M)&&j&&j()});function te(r){try{const t=e(y)?"3":"4",o=J(r,e(v),t),n=R[r+t],l=R[o+t];return console.debug(`Interval ${L[e(v)]} from ${r}${t} to ${o}${t}:`,`Root MIDI: ${n}, Expected MIDI: ${l}`),[n,l]}catch(t){console.error("Error generating expected note:",t);const o=R.C4,n=R.E4;return[o,n]}}function oe(r){try{const t=J(r,e(v),"4"),o=r+"4",n=F[t];let l=[],p=[];return e(y)?p=[[o,n]]:l=[[o,n]],{selectedNote:r,leftHand:l,rightHand:p}}catch(t){return console.error("Error generating score props:",t),{selectedNote:r,leftHand:[],rightHand:[["C4","E4"]]}}}function re(r,t,o,n){const[l,p]=o,m=L[e(v)];return o.includes(t.noteNumber)?(a(c,new Set([...e(c),t.noteNumber]),!0),e(c).size===2?{isCorrect:!0,message:`Perfect ${m}! ðŸŽµâœ¨`,collected:!0,resetCollected:!1}:{isCorrect:!0,message:`Good! ${t.noteNumber===l?"root":m} played (${e(c).size}/2)`,collected:!0,resetCollected:!1}):(a(c,new Set,!0),{isCorrect:!1,message:`Wrong! You played ${F[t.noteNumber]?.slice(0,-1)}. Play ${m} from ${r}`,collected:!1,resetCollected:!0})}function ae(r,t){const o=[...new Set(t)];return e(c).size===o.length}{const r=(o,n=ue)=>{const l=D(()=>e(M)),p=D(()=>n().completed);var m=we(),w=A(m);{var q=i=>{var f=Y();S(()=>V(f,a(M,!0))),_(i,f)},se=i=>{var f=fe(),N=A(f);{var d=g=>{var C=Y();S(()=>V(C,a(M,!1))),_(g,C)};B(N,g=>{!e(p)&&e(l)&&g(d)},!0)}_(i,f)};B(w,i=>{e(p)&&!e(l)?i(q):i(se,!1)})}var G=z(w,2),ne=T(G);{var le=i=>{var f=Te(),N=A(f),d=z(T(N),2);d.__change=[Ne,v,c],ge(d,21,()=>K,_e,(H,P)=>{var I=Ie(),ie=T(I,!0);h(I);var Q={};S(()=>{V(ie,L[e(P)]),Q!==(Q=e(P))&&(I.value=(I.__value=e(P))??"")}),_(H,I)}),h(d);var g;he(d),h(N);var C=z(N,2),O=T(C),k=T(O);xe(k),k.__change=[Ce,y,c],pe(),h(O),h(C),S(()=>{g!==(g=e(v))&&(d.value=(d.__value=e(v))??"",be(d,e(v)))}),ye(k,()=>e(y),H=>a(y,H)),_(i,f)};B(ne,i=>{u||i(le)})}h(G),_(o,m)};let t=D(()=>Z||"C");Me(x,{get randomMode(){return u},generateExpectedNotes:te,generateScoreProps:oe,validateNoteEvent:re,isCompleted:ae,onReset:ee,onComplete:()=>{},get initialNote(){return e(t)},description:b,children:r,$$slots:{default:!0}})}ve()}me(["change"]);export{ze as component};
