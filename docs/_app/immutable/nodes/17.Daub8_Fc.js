import{f as P,a as h,t as ae,c as be}from"../chunks/Bdvgn338.js";import{p as ye,U as F,V as ne,W as Pe,k as e,X as b,a as Ve,Z as q,Y as we,c as m,f as X,s as i,t as y,r as f}from"../chunks/ZtE6Gyvq.js";import{d as Te,s as N}from"../chunks/BnZ86L-c.js";import{e as Ee,i as Fe}from"../chunks/DWPsCs3Q.js";import{i as H}from"../chunks/CdTPX8-T.js";import{b as Ne,i as ie,s as le}from"../chunks/C9cudW0Q.js";import{p as He}from"../chunks/-nZJNBOr.js";import{B as Le,f as Ae,a as Y}from"../chunks/B5CATYx9.js";import{e as ce,M as L,N as x,D as M}from"../chunks/CXrKfc7O.js";import{p as ve}from"../chunks/_pvSvSmo.js";var De=P('<div class="control-group svelte-1jk8q9u"><label for="inversion" class="svelte-1jk8q9u">Inversion:</label> <select id="inversion" class="svelte-1jk8q9u"><option class="svelte-1jk8q9u">Root</option><option class="svelte-1jk8q9u">1st</option><option class="svelte-1jk8q9u">2nd</option><option class="svelte-1jk8q9u">3rd</option></select></div> <div class="control-group svelte-1jk8q9u"><label for="voicing" class="svelte-1jk8q9u">Voicing:</label> <select id="voicing" class="svelte-1jk8q9u"><option class="svelte-1jk8q9u">Full Right Hand</option><option class="svelte-1jk8q9u">Full Left Hand</option><option class="svelte-1jk8q9u">1 & 7 Left / 3 & 5 Right</option><option class="svelte-1jk8q9u">1 & 5 Left / 3 & 7 Right</option></select></div>',1),Ke=P("<div> </div>"),Ue=P('<div class="completion svelte-1jk8q9u">ðŸŽ‰ ii-V-I Completed!</div>'),Be=P('<!> <div class="progression-controls svelte-1jk8q9u"><!> <div class="chord-progress svelte-1jk8q9u"></div></div> <div class="exercise-status svelte-1jk8q9u"><div class="current-chord svelte-1jk8q9u"> </div> <!></div>',1),Ge=P('<div class="progression-exercise svelte-1jk8q9u"><!></div>');function et(ue,p){ye(p,!0);const de="Play the II-V-I progression as shown. Use the correct chords and voicings for each step.";let V=He(p,"randomMode",3,!1);const fe=b(()=>ve.url.searchParams.get("key"));let a=F(0),C=F(ne(p.inversion??(V()?Math.floor(Math.random()*4):0))),I=F(ne(p.voicing??(V()?ce[Math.floor(Math.random()*ce.length)]:"full-right"))),me=b(()=>e(fe)??p.rootKey??"C"),w=F(!1);function pe(){A(),q(w,!1)}function A(){q(a,0)}function Z(t){const o=x[t+M]+2,n=x[t+M]+7,l=x[t+M],v=Y(o,"min7",e(C)),j=Y(n,"7",e(C)),R=Y(l,"maj7",e(C));return[v,j,R][e(a)]}function ge(t){const o=Z(t);return[o.root,o.third,o.fifth,o.seventh].filter(n=>n!=null)}function _e(t,o,n,l){const v=T(t)[e(a)];if(n.includes(o.noteNumber)){const u=l.filter(K=>n.includes(K)).length,E=n.length;return u===E?e(a)<2?(setTimeout(()=>{we(a)},1e3),{isCorrect:!0,message:z(),collected:!0,resetCollected:!1}):{isCorrect:!0,message:z(),collected:!0,resetCollected:!1}:{isCorrect:!0,message:`Good! ${u}/${E} notes for ${v}`,collected:!0,resetCollected:!1}}const R=n.filter(u=>!l.includes(u)).map(u=>L[u].slice(0,-1)).join(", ");return{isCorrect:!1,message:`Wrong note. For ${v} expected: ${R}`,collected:!1,resetCollected:!0}}function he(t,o){if(o.length===0)return!1;const v=t.filter(j=>o.includes(j)).length===o.length&&e(a)===2;return v&&setTimeout(()=>{q(a,0)},1500),v}function T(t="C"){const o=x[t+M]+2,n=x[t+M]+7,l=x[t+M];return[`${L[o].slice(0,-1)}m7`,`${L[n].slice(0,-1)}7`,`${L[l].slice(0,-1)}maj7`]}function z(){return e(a)<2?`Great! Now play ${T()[e(a)+1]}`:"Perfect! Complete ii-V-I progression! ðŸŽµâœ¨"}function Ce(t){const o=t.target;q(C,parseInt(o.value),!0),A()}function je(t){const o=t.target;q(I,o.value,!0),A()}function ke(t){const o=Z(t);return{...Ae(o,e(I)),selectedNote:t}}var D=Ge(),qe=m(D);{const t=(n,l=Pe)=>{const v=b(()=>e(w)),j=b(()=>l().completed);var R=Be(),u=X(R);{var E=r=>{var c=ae();y(()=>N(c,q(w,!0))),h(r,c)},K=r=>{var c=be(),g=X(c);{var s=d=>{var _=ae();y(()=>N(_,q(w,!1))),h(d,_)};H(g,d=>{!e(j)&&e(v)&&d(s)},!0)}h(r,c)};H(u,r=>{e(j)&&!e(v)?r(E):r(K,!1)})}var U=i(u,2),J=m(U);{var Re=r=>{var c=De(),g=X(c),s=i(m(g),2);s.__change=Ce;var d=m(s);d.value=d.__value=0;var _=i(d);_.value=_.__value=1;var G=i(_);G.value=G.__value=2;var ee=i(G);ee.value=ee.__value=3,f(s);var te;ie(s),f(g);var oe=i(g,2),k=i(m(oe),2);k.__change=je;var W=m(k);W.value=W.__value="full-right";var O=i(W);O.value=O.__value="full-left";var S=i(O);S.value=S.__value="1735";var re=i(S);re.value=re.__value="1537",f(k);var se;ie(k),f(oe),y(()=>{te!==(te=e(C))&&(s.value=(s.__value=e(C))??"",le(s,e(C))),se!==(se=e(I))&&(k.value=(k.__value=e(I))??"",le(k,e(I)))}),h(r,c)};H(J,r=>{!V()&&!ve.url.searchParams.get("unitId")&&r(Re)})}var Q=i(J,2);Ee(Q,21,()=>T(l().selectedNote),Fe,(r,c,g)=>{var s=Ke();let d;var _=m(s,!0);f(s),y(()=>{d=Ne(s,1,"chord-indicator svelte-1jk8q9u",null,d,{active:g===e(a),completed:g<e(a)}),N(_,e(c))}),h(r,s)}),f(Q),f(U);var $=i(U,2),B=m($),xe=m(B);f(B);var Me=i(B,2);{var Ie=r=>{var c=Ue();h(r,c)};H(Me,r=>{l().completed&&r(Ie)})}f($),y(r=>N(xe,`Current: ${r??""} (${e(a)+1}/3)`),[()=>T(l().selectedNote)[e(a)]]),h(n,R)};let o=b(()=>p.onComplete??(()=>{}));Le(qe,{get randomMode(){return V()},generateExpectedNotes:ge,generateScoreProps:ke,validateNoteEvent:_e,isCompleted:he,onReset:pe,get onComplete(){return e(o)},get initialNote(){return e(me)},description:de,exerciseType:"progression",get progressiveHints(){return p.progressiveHints},get prompt(){return p.prompt},children:t,$$slots:{default:!0}})}f(D),h(ue,D),Ve()}Te(["change"]);export{et as component};
