import"../chunks/NZTpNUN0.js";import{p as ce,N as b,O as x,g as de,k as e,c as ue,P as ie,R,f as Y,a as A,s as w,b as E,Q as t,d as M,r as N,S as K,t as j,T as me,V as Q}from"../chunks/DPDCOiIW.js";import{d as ve,s as D}from"../chunks/ZRc7GTJ1.js";import{i as z}from"../chunks/CPFqVV7e.js";import{r as J,i as fe,s as ge}from"../chunks/abe3cog1.js";import{b as U}from"../chunks/DcVJ9ji5.js";import{S as he,N as _e,d as X,M as H}from"../chunks/Dh5yjYp3.js";import{B as pe}from"../chunks/DkJRdrwJ.js";function Me(f,a,c){const d=_e[f+(c?"3":"1")];return he[a].map(l=>d+l)}function Ne(f,a,c,n){const d=f.target;t(a,d.checked,!0),t(c,new Set,!0),t(n,[],!0)}function Se(f,a,c,n){const d=f.target;t(a,d.checked,!0),t(c,new Set,!0),t(n,[],!0)}function be(f,a,c,n){const d=f.target;t(a,d.value,!0),t(c,new Set,!0),t(n,[],!0)}var Ce=Y('<div class="control-group svelte-qe37du"><label class="svelte-qe37du"><input type="checkbox" class="svelte-qe37du"/> In order</label></div> <div class="control-group svelte-qe37du"><label class="svelte-qe37du"><input type="checkbox" class="svelte-qe37du"/> Right hand</label></div> <div class="control-group svelte-qe37du"><label for="scaleMode" class="svelte-qe37du">Scale mode:</label> <select id="scaleMode" class="svelte-qe37du"><option class="svelte-qe37du">Major</option><option class="svelte-qe37du">Minor</option></select></div>',1),qe=Y('<!> <div class="scale-controls svelte-qe37du"><!></div>',1);function Ae(f,a){ce(a,!0);let c=b(x(a.sequentialMode??(a.randomMode?Math.random()>.5:!0))),n=b(x(a.handMode??(a.randomMode?Math.random()>.5:!0))),d=b(x(a.scaleMode??(a.randomMode?X[Math.floor(Math.random()*X.length)]:"Maj"))),l=b(x(new Set)),i=b(x([])),C=b(!1);function Z(){t(l,new Set,!0),t(i,[],!0),t(C,!1)}de(()=>{e(C)&&a.onComplete&&a.onComplete()});function I(r){const o=Me(r,e(d),e(n)),s=e(n)?"3":"1";return console.debug(`Scale for ${r}${s}:`,o.map(u=>H[u])),o}function $(r){const s=I(r).map(m=>H[m]),u=e(n)?s.map(m=>[m]):[],g=e(n)?[]:s.map(m=>[m]);return{selectedNote:r,leftHand:g,rightHand:u}}function ee(r,o,s,u){return e(c)?te(o,s):ae(o,s)}function te(r,o,s){const u=e(i).length,g=o[u];if(r.noteNumber===g)t(i,[...e(i),r.noteNumber],!0),t(l,new Set([...e(l),r.noteNumber]),!0);else{const m=H[g]?.slice(0,-1)??String(g);return t(i,[],!0),t(l,new Set,!0),{isCorrect:!1,message:`Wrong note! Expected ${m} (note ${u+1})`,collected:!1,resetCollected:!0}}return e(i).length===o.length?{isCorrect:!0,message:"Perfect scale! ðŸŽµâœ¨",collected:!0,resetCollected:!1}:{isCorrect:!0,message:`Good! Note ${u+1}/${o.length}`,collected:!0,resetCollected:!1}}function ae(r,o,s){return o.includes(r.noteNumber)?(t(l,new Set([...e(l),r.noteNumber]),!0),e(l).size===o.length?{isCorrect:!0,message:"Perfect scale! ðŸŽµ",collected:e(l).has(r.noteNumber),resetCollected:!1}:{isCorrect:!0,message:`Good! ${e(l).size}/${o.length} notes`,collected:e(l).has(r.noteNumber),resetCollected:!1}):(t(l,new Set,!0),{isCorrect:!1,message:"Wrong note!",resetCollected:!0,collected:!1})}function oe(r,o){if(e(c))return e(i).length===o.length&&e(i).every((s,u)=>s===o[u]);{const s=[...new Set(o)];return e(l).size===s.length}}{const r=(s,u=ie)=>{var g=qe();const m=R(()=>e(C)),B=R(()=>u().completed);var G=A(g);{var re=v=>{var h=K();j(()=>D(h,t(C,!0))),E(v,h)},le=v=>{var h=me(),q=A(h);{var y=_=>{var S=K();j(()=>D(S,t(C,!1))),E(_,S)};z(q,_=>{!e(B)&&e(m)&&_(y)},!0)}E(v,h)};z(G,v=>{e(B)&&!e(m)?v(re):v(le,!1)})}var L=w(G,2),se=M(L);{var ne=v=>{var h=Ce(),q=A(h),y=M(q),_=M(y);J(_),_.__change=[Ne,c,l,i],Q(),N(y),N(q);var S=w(q,2),O=M(S),k=M(O);J(k),k.__change=[Se,n,l,i],Q(),N(O),N(S);var V=w(S,2),p=w(M(V),2);p.__change=[be,d,l,i];var T=M(p);T.value=T.__value="Maj";var W=w(T);W.value=W.__value="Min",N(p);var F;fe(p),N(V),j(()=>{F!==(F=e(d))&&(p.value=(p.__value=e(d))??"",ge(p,e(d)))}),U(_,()=>e(c),P=>t(c,P)),U(k,()=>e(n),P=>t(n,P)),E(v,h)};z(se,v=>{a.randomMode||v(ne)})}N(L),E(s,g)};let o=R(()=>a.rootKey||"C");pe(f,{get randomMode(){return a.randomMode},generateExpectedNotes:I,generateScoreProps:$,validateNoteEvent:ee,isCompleted:oe,onReset:Z,onComplete:()=>{},get initialNote(){return e(o)},children:r,$$slots:{default:!0}})}ue()}ve(["change"]);export{Ae as component};
