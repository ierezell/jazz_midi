import{f as Y,a as V}from"../chunks/CmtjIIgE.js";import{p as ce,U as N,V as y,n as ie,v as e,Z as o,W as ue,a as de,Y as S,c as m,r as _,f as fe,_ as ve,s as p,t as ge}from"../chunks/ipsVM-65.js";import{d as he}from"../chunks/Brx6x_Mu.js";import{i as me}from"../chunks/D8W4ZUO4.js";import{r as _e,a as D,s as F}from"../chunks/CO8AMRA4.js";import{b as pe}from"../chunks/C--765yI.js";import{S as Me,N as O,M as w,e as U}from"../chunks/DTRnenjV.js";import{B as be}from"../chunks/n6RJpNS9.js";import{p as E}from"../chunks/CGS6TK9b.js";function A(C,n,M){let f="right";typeof M=="boolean"?f=M?"right":"left":f=M;const b=Me[n],d=[];if(f==="left"||f==="both"){const a=O[C+"2"];d.push(...b.map(c=>a+c))}if(f==="right"||f==="both"){const a=O[C+"3"];d.push(...b.map(c=>a+c))}return f==="both"&&d.sort((a,c)=>a-c),d}var Se=Y('<div class="control-group svelte-1l89l8c"><label class="svelte-1l89l8c"><input type="checkbox" class="svelte-1l89l8c"/> In order</label></div> <div class="control-group svelte-1l89l8c"><label for="handMode" class="svelte-1l89l8c">Hand:</label> <select id="handMode" class="svelte-1l89l8c"><option class="svelte-1l89l8c">Right Hand</option><option class="svelte-1l89l8c">Left Hand</option><option class="svelte-1l89l8c">Both Hands</option></select></div> <div class="control-group svelte-1l89l8c"><label for="scaleMode" class="svelte-1l89l8c">Scale mode:</label> <select id="scaleMode" class="svelte-1l89l8c"><option class="svelte-1l89l8c">Major</option><option class="svelte-1l89l8c">Minor</option></select></div>',1),Ce=Y('<div class="scale-controls svelte-1l89l8c"><!></div>');function Re(C,n){ce(n,!0);const M="Play the scale shown, ascending and/or descending, using your MIDI keyboard. Try to follow the correct order.",f=S(()=>E.url.searchParams.get("root")),b=S(()=>E.url.searchParams.get("hand"));let d=N(y(n.sequentialMode??(n.randomMode?Math.random()>.5:!0))),a=N(y(n.handMode??(n.randomMode?Math.random()>.5?"right":"left":"right")));ie(()=>{e(b)&&o(a,e(b),!0)});let c=S(()=>E.url.searchParams.get("mode")??n.scaleMode??(n.randomMode?U[Math.floor(Math.random()*U.length)]:"Maj")),Z=S(()=>e(f)??n.rootKey??"C"),r=N(y(new Set)),i=N(y([]));function J(){o(r,new Set,!0),o(i,[],!0)}function Q(l){const t=A(l,e(c),e(a));return console.debug(`Scale for ${l} (${e(a)}):`,t.map(s=>w[s])),t}function X(l){let t=[],s=[];return(e(a)==="left"||e(a)==="both")&&(t=A(l,e(c),"left").map(u=>[w[u]])),(e(a)==="right"||e(a)==="both")&&(s=A(l,e(c),"right").map(u=>[w[u]])),{selectedNote:l,leftHand:t,rightHand:s}}function $(l,t,s,v){return e(d)?ee(t,s):te(t,s)}function ee(l,t,s){const v=e(i).length,u=t[v];if(l.noteNumber===u)o(i,[...e(i),l.noteNumber],!0),o(r,new Set([...e(r),l.noteNumber]),!0);else{const P=w[u]?.slice(0,-1)??String(u);return o(i,[],!0),o(r,new Set,!0),{isCorrect:!1,message:`Wrong note! Expected ${P} (note ${v+1})`,collected:!1,resetCollected:!0}}return e(i).length===t.length?{isCorrect:!0,message:"Perfect scale! ðŸŽµâœ¨",collected:!0,resetCollected:!1}:{isCorrect:!0,message:`Good! Note ${v+1}/${t.length}`,collected:!0,resetCollected:!1}}function te(l,t,s){return t.includes(l.noteNumber)?(o(r,new Set([...e(r),l.noteNumber]),!0),e(r).size===t.length?{isCorrect:!0,message:"Perfect scale! ðŸŽµ",collected:e(r).has(l.noteNumber),resetCollected:!1}:{isCorrect:!0,message:`Good! ${e(r).size}/${t.length} notes`,collected:e(r).has(l.noteNumber),resetCollected:!1}):(o(r,new Set,!0),{isCorrect:!1,message:"Wrong note!",resetCollected:!0,collected:!1})}function le(l,t){if(e(d))return e(i).length===t.length&&e(i).every((s,v)=>s===t[v]);{const s=[...new Set(t)];return e(r).size===s.length}}function oe(l){const t=l.target;o(d,t.checked,!0),o(r,new Set,!0),o(i,[],!0)}function ae(l){const t=l.target;o(a,t.value,!0),o(r,new Set,!0),o(i,[],!0)}function re(l){const t=l.target;o(c,t.value),o(r,new Set,!0),o(i,[],!0)}{const l=(s,v=ue)=>{var u=Ce(),P=m(u);{var se=x=>{var j=Se(),H=fe(j),z=m(H),q=m(z);_e(q),q.__change=oe,ve(),_(z),_(H);var I=p(H,2),g=p(m(I),2);g.__change=ae;var R=m(g);R.value=R.__value="right";var T=p(R);T.value=T.__value="left";var B=p(T);B.value=B.__value="both",_(g);var L;D(g),_(I);var W=p(I,2),h=p(m(W),2);h.__change=re;var k=m(h);k.value=k.__value="Maj";var G=p(k);G.value=G.__value="Min",_(h);var K;D(h),_(W),ge(()=>{L!==(L=e(a))&&(g.value=(g.__value=e(a))??"",F(g,e(a))),K!==(K=e(c))&&(h.value=(h.__value=e(c))??"",F(h,e(c)))}),pe(q,()=>e(d),ne=>o(d,ne)),V(x,j)};me(P,x=>{!n.randomMode&&!E.url.searchParams.get("unitId")&&x(se)})}_(u),V(s,u)};let t=S(()=>n.onComplete??(()=>{}));be(C,{get randomMode(){return n.randomMode},generateExpectedNotes:Q,generateScoreProps:X,validateNoteEvent:$,isCompleted:le,onReset:J,get onComplete(){return e(t)},get initialNote(){return e(Z)},description:M,exerciseType:"scale",children:l,$$slots:{default:!0}})}de()}he(["change"]);export{Re as component};
