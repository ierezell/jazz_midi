import"../chunks/NZTpNUN0.js";import{d as ye,o as Te,s as _}from"../chunks/DutP5Gvj.js";import{p as ke,z as c,A as X,f as T,a as we,d as n,s as g,t as Y,b as y,k as e,c as Ee,B as r,C as s,r as i,E as Z}from"../chunks/C7Lc0MXo.js";import{i as De}from"../chunks/DSSW3rDz.js";import{e as Pe,M as G,m as ee,i as Se,N as K,c as q}from"../chunks/KCvTrXcA.js";import{s as Ie}from"../chunks/9IstWcpU.js";import{M as Re}from"../chunks/xECcMkd1.js";import{B as Ve,m as N,a as A}from"../chunks/B0lqf9OI.js";import{u as je}from"../chunks/CTQRNL6p.js";var Be=T("<div> </div>"),ze=T('<div class="completion svelte-453sxh">ðŸŽ‰ ii-V-I Completed!</div>'),Ge=T('<div class="progression-controls svelte-453sxh"><div class="control-group svelte-453sxh"><button class="debug-btn svelte-453sxh"> </button> <button class="reset-btn svelte-453sxh">Reset</button></div> <div class="chord-progress svelte-453sxh"></div></div> <div class="exercise-status svelte-453sxh"><div class="current-chord svelte-453sxh"> </div> <div class="progress svelte-453sxh"> </div> <div class="mistakes svelte-453sxh"> </div> <!></div>',1),Ke=T('<div class="progression-exercise svelte-453sxh"><!></div>');function Xe(te,se){ke(se,!0);let a=c("C"),o=c(0),h=c(X([])),v=c(0),$=c(!1),f=c(!1),p=c(""),U=c(X(Date.now())),oe=s(()=>e(v)>=3),re=s(()=>e(v)>=6),k=s(()=>e(h).map(t=>t.noteNumber)),w=s(()=>K[e(a)+"4"]+2),E=s(()=>K[e(a)+"4"]+7),D=s(()=>K[e(a)+"4"]),ie=s(()=>q(e(w),"min7")),ae=s(()=>q(e(E),"7")),le=s(()=>q(e(D),"maj7")),ne=s(()=>[e(ie),e(ae),e(le)]),m=s(()=>[`${G[e(w)].slice(0,-1)}m7`,`${G[e(E)].slice(0,-1)}7`,`${G[e(D)].slice(0,-1)}maj7`]),x=s(()=>e(ne)[e(o)]),W=s(()=>[e(x).root,e(x).third,e(x).fifth,e(x).seventh].filter(t=>t!=null)),u=s(()=>e(W)),de=s(()=>{const t=e(o)===0?"min7":e(o)===1?"7":"maj7",d=e(o)===0?e(w):e(o)===1?e(E):e(D);return Re.Chord.createChordToneMapping(e(x),d,t,0)}),ce=s(()=>({selectedNote:e(a),midiNotes:e(k),noteEvents:e(h),debugMode:e(f),showNoteNames:e(oe),showKeyboard:e(re),feedbackMessage:e(p),errorCount:e(v),completed:e($)})),ve=s(()=>({notes:e(W).map(t=>ee(t)),highlightedNotes:e(k).map(t=>ee(t)),title:`${e(a)} ii-V-I: ${e(m)[e(o)]} (${e(o)+1}/3)`}));function ue(t){r(a,t,!0),P()}function F(){r(f,!e(f)),e(f)?N.enableDebugMode():N.disableDebugMode()}function P(){r(v,0),r(h,[],!0),r($,!1),r(o,0),r(p,""),r(U,Date.now(),!0),N.resetExercise()}function he(){if(e(o)<2)Z(o),r(p,`Great! Now play ${e(m)[e(o)]}`);else{r($,!0),r(p,`Perfect! Complete ${e(a)} ii-V-I progression! ðŸŽµâœ¨`),A.playSuccess();const t=(Date.now()-e(U))/1e3,d=Math.round(12/(12+e(v))*100);je.updateNoteProgress(e(a),"progression",void 0,!0,t,d)}}function pe(t){if(r(h,[t,...e(h).slice(0,9)],!0),t.type==="on")if(e(u).includes(t.noteNumber)){const d=e(h).filter(b=>b.type==="on").filter(b=>e(u).includes(b.noteNumber));d.length===e(u).length?he():r(p,`Good! ${d.length}/${e(u).length} notes for ${e(m)[e(o)]}`)}else Z(v),r(p,`Wrong note! Expected: ${e(m)[e(o)]}`),A.playError()}Te(()=>(N.connect(pe),A.initialize(),()=>{N.disconnect()}));var S=Ke(),me=n(S);{let t=s(()=>`${e(a)} ii-V-I Progression`),d=s(()=>({chordToneInfo:e(de),showChordTones:!0}));Ve(me,{get exerciseState(){return e(ce)},get exerciseTitle(){return e(t)},exerciseDescription:"Play each chord in sequence: ii7 - V7 - Imaj7",get expectedNotes(){return e(u)},get scoreProps(){return e(ve)},get keyboardProps(){return e(d)},onNoteSelect:ue,onDebugToggle:F,onReset:P,customControls:!0,children:(b,qe)=>{var H=Ge(),I=we(H),R=n(I),C=n(R);C.__click=F;var ge=n(C);i(C);var fe=g(C,2);fe.__click=P,i(R);var J=g(R,2);Pe(J,21,()=>e(m),Se,(l,z,O)=>{var M=Be();let Q;var Ce=n(M,!0);i(M),Y(Me=>{Q=Ie(M,1,"chord-indicator svelte-453sxh",null,Q,Me),_(Ce,e(z))},[()=>({active:O===e(o),completed:O<e(o)})]),y(l,M)}),i(J),i(I);var L=g(I,2),V=n(L),xe=n(V);i(V);var j=g(V,2),be=n(j);i(j);var B=g(j,2),_e=n(B);i(B);var Ne=g(B,2);{var $e=l=>{var z=ze();y(l,z)};De(Ne,l=>{e($)&&l($e)})}i(L),Y(l=>{_(ge,`${e(f)?"Disable":"Enable"} Debug Mode`),_(xe,`Current: ${e(m)[e(o)]??""} (${e(o)+1}/3)`),_(be,`Progress: ${l??""}%`),_(_e,`Mistakes: ${e(v)??""}`)},[()=>Math.round(e(k).filter(l=>e(u).includes(l)).length/e(u).length*100)]),y(b,H)},$$slots:{default:!0}})}i(S),y(te,S),Ee()}ye(["click"]);export{Xe as component};
