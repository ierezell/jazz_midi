import{f as V,a as h,t as ae,c as ye}from"../chunks/Bdvgn338.js";import{p as Pe,U as N,V as ne,W as Ve,k as e,X as y,a as be,Z as R,Y as we,c as m,f as X,s as n,t as P,r as f}from"../chunks/ZtE6Gyvq.js";import{d as Te,s as H}from"../chunks/BnZ86L-c.js";import{e as Ee,i as Fe}from"../chunks/BbjHMeAY.js";import{i as L}from"../chunks/CdTPX8-T.js";import{c as Ne,i as ie,s as le}from"../chunks/C2lzuMI8.js";import{p as He}from"../chunks/-nZJNBOr.js";import{B as Le,d as Ae,a as Y}from"../chunks/DBDa-pHI.js";import{e as ce,M as A,N as x,D as M}from"../chunks/CXrKfc7O.js";import{p as ve}from"../chunks/BYaj1R6p.js";var De=V('<div class="control-group svelte-1jk8q9u"><label for="inversion" class="svelte-1jk8q9u">Inversion:</label> <select id="inversion" class="svelte-1jk8q9u"><option class="svelte-1jk8q9u">Root</option><option class="svelte-1jk8q9u">1st</option><option class="svelte-1jk8q9u">2nd</option><option class="svelte-1jk8q9u">3rd</option></select></div> <div class="control-group svelte-1jk8q9u"><label for="voicing" class="svelte-1jk8q9u">Voicing:</label> <select id="voicing" class="svelte-1jk8q9u"><option class="svelte-1jk8q9u">Full Right Hand</option><option class="svelte-1jk8q9u">Full Left Hand</option><option class="svelte-1jk8q9u">1 & 7 Left / 3 & 5 Right</option><option class="svelte-1jk8q9u">1 & 5 Left / 3 & 7 Right</option></select></div>',1),Ke=V("<div> </div>"),Ue=V('<div class="completion svelte-1jk8q9u">ðŸŽ‰ ii-V-I Completed!</div>'),Be=V('<!> <div class="progression-controls svelte-1jk8q9u"><!> <div class="chord-progress svelte-1jk8q9u"></div></div> <div class="exercise-status svelte-1jk8q9u"><div class="current-chord svelte-1jk8q9u"> </div> <!></div>',1),Ge=V('<div class="progression-exercise svelte-1jk8q9u"><!></div>');function et(ue,p){Pe(p,!0);const de="Play the II-V-I progression as shown. Use the correct chords and voicings for each step.";let b=He(p,"randomMode",3,!1);const fe=y(()=>ve.url.searchParams.get("key"));let i=N(0),C=N(ne(p.inversion??(b()?Math.floor(Math.random()*4):0))),I=N(ne(p.voicing??(b()?ce[Math.floor(Math.random()*ce.length)]:"full-right"))),me=y(()=>e(fe)??p.rootKey??"C"),w=N(!1);function pe(){T(),R(w,!1)}function T(){R(i,0)}function Z(t){const o=x[t+M]+2,a=x[t+M]+7,l=x[t+M],v=Y(o,"min7",e(C)),j=Y(a,"7",e(C)),q=Y(l,"maj7",e(C));return[v,j,q][e(i)]}function ge(t){const o=Z(t);return[o.root,o.third,o.fifth,o.seventh].filter(a=>a!=null)}function _e(t,o,a,l){const v=E(t)[e(i)];if(a.includes(o.noteNumber)){const u=l.filter(K=>a.includes(K)).length,F=a.length;return u===F?e(i)<2?(setTimeout(()=>{we(i)},1e3),{isCorrect:!0,message:z(),collected:!0,resetCollected:!1}):{isCorrect:!0,message:z(),collected:!0,resetCollected:!1}:{isCorrect:!0,message:`Good! ${u}/${F} notes for ${v}`,collected:!0,resetCollected:!1}}const q=a.filter(u=>!l.includes(u)).map(u=>A[u].slice(0,-1)).join(", ");return{isCorrect:!1,message:`Wrong note. For ${v} expected: ${q}`,collected:!1,resetCollected:!0}}function he(t,o){if(o.length===0)return!1;const v=t.filter(j=>o.includes(j)).length===o.length&&e(i)===2;return v&&setTimeout(()=>{T()},2e3),v}function E(t="C"){const o=x[t+M]+2,a=x[t+M]+7,l=x[t+M];return[`${A[o].slice(0,-1)}m7`,`${A[a].slice(0,-1)}7`,`${A[l].slice(0,-1)}maj7`]}function z(){return e(i)<2?`Great! Now play ${E()[e(i)+1]}`:"Perfect! Complete ii-V-I progression! ðŸŽµâœ¨"}function Ce(t){const o=t.target;R(C,parseInt(o.value),!0),T()}function je(t){const o=t.target;R(I,o.value,!0),T()}function ke(t){const o=Z(t);return{...Ae(o,e(I)),selectedNote:t}}var D=Ge(),qe=m(D);{const t=(a,l=Ve)=>{const v=y(()=>e(w)),j=y(()=>l().completed);var q=Be(),u=X(q);{var F=r=>{var c=ae();P(()=>H(c,R(w,!0))),h(r,c)},K=r=>{var c=ye(),g=X(c);{var s=d=>{var _=ae();P(()=>H(_,R(w,!1))),h(d,_)};L(g,d=>{!e(j)&&e(v)&&d(s)},!0)}h(r,c)};L(u,r=>{e(j)&&!e(v)?r(F):r(K,!1)})}var U=n(u,2),J=m(U);{var Re=r=>{var c=De(),g=X(c),s=n(m(g),2);s.__change=Ce;var d=m(s);d.value=d.__value=0;var _=n(d);_.value=_.__value=1;var G=n(_);G.value=G.__value=2;var ee=n(G);ee.value=ee.__value=3,f(s);var te;ie(s),f(g);var oe=n(g,2),k=n(m(oe),2);k.__change=je;var W=m(k);W.value=W.__value="full-right";var O=n(W);O.value=O.__value="full-left";var S=n(O);S.value=S.__value="1735";var re=n(S);re.value=re.__value="1537",f(k);var se;ie(k),f(oe),P(()=>{te!==(te=e(C))&&(s.value=(s.__value=e(C))??"",le(s,e(C))),se!==(se=e(I))&&(k.value=(k.__value=e(I))??"",le(k,e(I)))}),h(r,c)};L(J,r=>{!b()&&!ve.url.searchParams.get("unitId")&&r(Re)})}var Q=n(J,2);Ee(Q,21,()=>E(l().selectedNote),Fe,(r,c,g)=>{var s=Ke();let d;var _=m(s,!0);f(s),P(()=>{d=Ne(s,1,"chord-indicator svelte-1jk8q9u",null,d,{active:g===e(i),completed:g<e(i)}),H(_,e(c))}),h(r,s)}),f(Q),f(U);var $=n(U,2),B=m($),xe=m(B);f(B);var Me=n(B,2);{var Ie=r=>{var c=Ue();h(r,c)};L(Me,r=>{l().completed&&r(Ie)})}f($),P(r=>H(xe,`Current: ${r??""} (${e(i)+1}/3)`),[()=>E(l().selectedNote)[e(i)]]),h(a,q)};let o=y(()=>p.onComplete??(()=>{}));Le(qe,{get randomMode(){return b()},generateExpectedNotes:ge,generateScoreProps:ke,validateNoteEvent:_e,isCompleted:he,onReset:pe,get onComplete(){return e(o)},get initialNote(){return e(me)},description:de,exerciseType:"progression",get progressiveHints(){return p.progressiveHints},get prompt(){return p.prompt},children:t,$$slots:{default:!0}})}f(D),h(ue,D),be()}Te(["change"]);export{et as component};
