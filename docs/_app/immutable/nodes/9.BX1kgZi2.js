import"../chunks/CWj6FrbW.js";import{d as Me,o as je,s as _}from"../chunks/DMAeUSXr.js";import{p as we,q as d,v as X,f as j,a as ye,d as n,s as g,t as Y,b as M,k as e,c as De,w as s,x as t,r as i,z as Z}from"../chunks/tdu9TRks.js";import{i as Ee}from"../chunks/ByAurAgR.js";import{e as Te,M as V,m as ee,i as Pe,N as q,c as z}from"../chunks/t8yZTVXO.js";import{s as Se}from"../chunks/tx2ohI1j.js";import{B as Ie,m as N,a as B}from"../chunks/CgVM9aVJ.js";import{u as Re}from"../chunks/DZz6v8Gc.js";import{c as Ve}from"../chunks/CoExbraD.js";var qe=j("<div> </div>"),ze=j('<div class="completion svelte-1k5fkj2">ðŸŽ‰ ii-V-I Completed!</div>'),Be=j('<div class="progression-controls svelte-1k5fkj2"><div class="control-group svelte-1k5fkj2"><button class="debug-btn svelte-1k5fkj2"> </button> <button class="reset-btn svelte-1k5fkj2">Reset</button></div> <div class="chord-progress svelte-1k5fkj2"></div></div> <div class="exercise-status svelte-1k5fkj2"><div class="current-chord svelte-1k5fkj2"> </div> <div class="progress svelte-1k5fkj2"> </div> <div class="mistakes svelte-1k5fkj2"> </div> <!></div>',1),Ge=j('<div class="progression-exercise svelte-1k5fkj2"><!></div>');function Xe(te,oe){we(oe,!0);let a=d("C"),r=d(0),u=d(X([])),c=d(0),x=d(!1),h=d(!1),p=d(""),G=d(X(Date.now())),se=t(()=>e(c)>=3),re=t(()=>e(c)>=6),w=t(()=>e(u).map(o=>o.noteNumber)),K=t(()=>q[e(a)+"4"]+2),W=t(()=>q[e(a)+"4"]+7),A=t(()=>q[e(a)+"4"]),ie=t(()=>z(e(K),"min7")),ae=t(()=>z(e(W),"7")),le=t(()=>z(e(A),"maj7")),ne=t(()=>[e(ie),e(ae),e(le)]),f=t(()=>[`${V[e(K)].slice(0,-1)}m7`,`${V[e(W)].slice(0,-1)}7`,`${V[e(A)].slice(0,-1)}maj7`]),k=t(()=>e(ne)[e(r)]),F=t(()=>[e(k).root,e(k).third,e(k).fifth,e(k).seventh].filter(o=>o!=null)),v=t(()=>e(F)),de=t(()=>Ve(e(k))),ce=t(()=>({selectedNote:e(a),midiNotes:e(w),noteEvents:e(u),debugMode:e(h),showNoteNames:e(se),showKeyboard:e(re),feedbackMessage:e(p),errorCount:e(c),completed:e(x)})),ve=t(()=>({notes:e(F).map(o=>ee(o)),highlightedNotes:e(w).map(o=>ee(o)),title:`${e(a)} ii-V-I: ${e(f)[e(r)]} (${e(r)+1}/3)`}));function ue(o){s(a,o,!0),y()}function H(){s(h,!e(h)),e(h)?N.enableDebugMode():N.disableDebugMode()}function y(){s(c,0),s(u,[],!0),s(x,!1),s(r,0),s(p,""),s(G,Date.now(),!0),N.resetExercise()}function pe(){if(e(r)<2)Z(r),s(p,`Great! Now play ${e(f)[e(r)]}`);else{s(x,!0),s(p,`Perfect! Complete ${e(a)} ii-V-I progression! ðŸŽµâœ¨`),B.playSuccess();const o=(Date.now()-e(G))/1e3,m=Math.round(12/(12+e(c))*100);Re.updateNoteProgress(e(a),"progression",void 0,!0,o,m)}}function fe(o){if(s(u,[o,...e(u).slice(0,9)],!0),o.type==="on")if(e(v).includes(o.noteNumber)){const m=e(u).filter(b=>b.type==="on").filter(b=>e(v).includes(b.noteNumber));m.length===e(v).length?pe():s(p,`Good! ${m.length}/${e(v).length} notes for ${e(f)[e(r)]}`)}else Z(c),s(p,`Wrong note! Expected: ${e(f)[e(r)]}`),B.playError()}je(()=>(N.connect(fe),B.initialize(),()=>{N.disconnect()}));var D=Ge(),me=n(D);{let o=t(()=>`${e(a)} ii-V-I Progression`),m=t(()=>({chordToneInfo:e(de),showChordTones:!0}));Ie(me,{get exerciseState(){return e(ce)},get exerciseTitle(){return e(o)},exerciseDescription:"Play each chord in sequence: ii7 - V7 - Imaj7",get expectedNotes(){return e(v)},get scoreProps(){return e(ve)},get keyboardProps(){return e(m)},onNoteSelect:ue,onDebugToggle:H,onReset:y,customControls:!0,children:(b,Ke)=>{var J=Be(),E=ye(J),T=n(E),$=n(T);$.__click=H;var ge=n($);i($);var he=g($,2);he.__click=y,i(T);var L=g(T,2);Te(L,21,()=>e(f),Pe,(l,R,Q)=>{var C=qe();let U;var $e=n(C,!0);i(C),Y(Ce=>{U=Se(C,1,"chord-indicator svelte-1k5fkj2",null,U,Ce),_($e,e(R))},[()=>({active:Q===e(r),completed:Q<e(r)})]),M(l,C)}),i(L),i(E);var O=g(E,2),P=n(O),ke=n(P);i(P);var S=g(P,2),be=n(S);i(S);var I=g(S,2),_e=n(I);i(I);var Ne=g(I,2);{var xe=l=>{var R=ze();M(l,R)};Ee(Ne,l=>{e(x)&&l(xe)})}i(O),Y(l=>{_(ge,`${e(h)?"Disable":"Enable"} Debug Mode`),_(ke,`Current: ${e(f)[e(r)]??""} (${e(r)+1}/3)`),_(be,`Progress: ${l??""}%`),_(_e,`Mistakes: ${e(c)??""}`)},[()=>Math.round(e(w).filter(l=>e(v).includes(l)).length/e(v).length*100)]),M(b,J)},$$slots:{default:!0}})}i(D),M(te,D),De()}Me(["click"]);export{Xe as component};
