import"../chunks/NZTpNUN0.js";import{p as ie,N as C,O as x,g as ue,k as e,c as me,P as fe,Q as T,f as $,a as A,s as y,b as E,R as t,d as N,r as S,S as Q,t as H,T as ve,V as J}from"../chunks/DekTh3_k.js";import{d as ge,s as U}from"../chunks/BEn0398A.js";import{i as j}from"../chunks/De59rqUo.js";import{r as X,i as he,s as _e}from"../chunks/9bBOD8_0.js";import{b as Y}from"../chunks/BqeKQDpR.js";import{S as pe,N as Me,d as Z,M as z}from"../chunks/BcYS4v02.js";import{B as Ne}from"../chunks/Bq00vTX4.js";function Se(f,a,v){const l=Me[f+(v?"3":"1")];return pe[a].map(h=>l+h)}function be(f,a,v,c){const l=f.target;t(a,l.checked,!0),t(v,new Set,!0),t(c,[],!0)}function Ce(f,a,v,c){const l=f.target;t(a,l.checked,!0),t(v,new Set,!0),t(c,[],!0)}function qe(f,a,v,c){const l=f.target;t(a,l.value,!0),t(v,new Set,!0),t(c,[],!0)}var we=$('<div class="control-group svelte-qe37du"><label class="svelte-qe37du"><input type="checkbox" class="svelte-qe37du"/> In order</label></div> <div class="control-group svelte-qe37du"><label class="svelte-qe37du"><input type="checkbox" class="svelte-qe37du"/> Right hand</label></div> <div class="control-group svelte-qe37du"><label for="scaleMode" class="svelte-qe37du">Scale mode:</label> <select id="scaleMode" class="svelte-qe37du"><option class="svelte-qe37du">Major</option><option class="svelte-qe37du">Minor</option></select></div>',1),xe=$('<!> <div class="scale-controls svelte-qe37du"><!></div>',1);function He(f,a){ie(a,!0);const v="Play the scale shown, ascending and/or descending, using your MIDI keyboard. Try to follow the correct order.";let c=C(x(a.sequentialMode??(a.randomMode?Math.random()>.5:!0))),l=C(x(a.rightHandMode??(a.randomMode?Math.random()>.5:!0))),h=C(x(a.scaleMode??(a.randomMode?Z[Math.floor(Math.random()*Z.length)]:"Maj"))),s=C(x(new Set)),i=C(x([])),q=C(!1);function ee(){t(s,new Set,!0),t(i,[],!0),t(q,!1)}ue(()=>{e(q)&&a.onComplete&&a.onComplete()});function B(r){const o=Se(r,e(h),e(l)),n=e(l)?"3":"1";return console.debug(`Scale for ${r}${n}:`,o.map(d=>z[d])),o}function te(r){const n=B(r).map(u=>z[u]),d=e(l)?n.map(u=>[u]):[],_=e(l)?[]:n.map(u=>[u]);return{selectedNote:r,leftHand:_,rightHand:d}}function ae(r,o,n,d){return e(c)?oe(o,n):re(o,n)}function oe(r,o,n){const d=e(i).length,_=o[d];if(r.noteNumber===_)t(i,[...e(i),r.noteNumber],!0),t(s,new Set([...e(s),r.noteNumber]),!0);else{const u=z[_]?.slice(0,-1)??String(_);return t(i,[],!0),t(s,new Set,!0),{isCorrect:!1,message:`Wrong note! Expected ${u} (note ${d+1})`,collected:!1,resetCollected:!0}}return e(i).length===o.length?{isCorrect:!0,message:"Perfect scale! ðŸŽµâœ¨",collected:!0,resetCollected:!1}:{isCorrect:!0,message:`Good! Note ${d+1}/${o.length}`,collected:!0,resetCollected:!1}}function re(r,o,n){return o.includes(r.noteNumber)?(t(s,new Set([...e(s),r.noteNumber]),!0),e(s).size===o.length?{isCorrect:!0,message:"Perfect scale! ðŸŽµ",collected:e(s).has(r.noteNumber),resetCollected:!1}:{isCorrect:!0,message:`Good! ${e(s).size}/${o.length} notes`,collected:e(s).has(r.noteNumber),resetCollected:!1}):(t(s,new Set,!0),{isCorrect:!1,message:"Wrong note!",resetCollected:!0,collected:!1})}function le(r,o){if(e(c))return e(i).length===o.length&&e(i).every((n,d)=>n===o[d]);{const n=[...new Set(o)];return e(s).size===n.length}}{const r=(d,_=fe)=>{var u=xe();const G=T(()=>e(q)),L=T(()=>_().completed);var O=A(u);{var se=m=>{var g=Q();H(()=>U(g,t(q,!0))),E(m,g)},ne=m=>{var g=ve(),w=A(g);{var k=p=>{var b=Q();H(()=>U(b,t(q,!1))),E(p,b)};j(w,p=>{!e(L)&&e(G)&&p(k)},!0)}E(m,g)};j(O,m=>{e(L)&&!e(G)?m(se):m(ne,!1)})}var V=y(O,2),ce=N(V);{var de=m=>{var g=we(),w=A(g),k=N(w),p=N(k);X(p),p.__change=[be,c,s,i],J(),S(k),S(w);var b=y(w,2),W=N(b),P=N(W);X(P),P.__change=[Ce,l,s,i],J(),S(W),S(b);var D=y(b,2),M=y(N(D),2);M.__change=[qe,h,s,i];var I=N(M);I.value=I.__value="Maj";var F=y(I);F.value=F.__value="Min",S(M);var K;he(M),S(D),H(()=>{K!==(K=e(h))&&(M.value=(M.__value=e(h))??"",_e(M,e(h)))}),Y(p,()=>e(c),R=>t(c,R)),Y(P,()=>e(l),R=>t(l,R)),E(m,g)};j(ce,m=>{a.randomMode||m(de)})}S(V),E(d,u)};let o=T(()=>a.onComplete??(()=>{})),n=T(()=>a.rootKey||"C");Ne(f,{get randomMode(){return a.randomMode},generateExpectedNotes:B,generateScoreProps:te,validateNoteEvent:ae,isCompleted:le,onReset:ee,get onComplete(){return e(o)},get initialNote(){return e(n)},description:v,children:r,$$slots:{default:!0}})}me()}ge(["change"]);export{He as component};
