import"../chunks/NZTpNUN0.js";import{p as ce,ao as b,Q as x,g as de,k as e,c as ue,ap as ie,aq as A,f as Y,a as P,s as w,b as E,R as t,d as M,r as N,ar as Q,t as j,as as me,at as V}from"../chunks/u8fP_b2Q.js";import{d as ve,s as D}from"../chunks/isL9873N.js";import{i as z}from"../chunks/Cj8lQ-n9.js";import{r as J,i as fe,s as ge}from"../chunks/CXakw2E1.js";import{b as U}from"../chunks/CoLbScs5.js";import{S as he,N as _e,d as X,M as H}from"../chunks/DmnNUe2y.js";import{B as pe}from"../chunks/CZxLfcpG.js";function Me(f,a,c){const d=_e[f+(c?"3":"1")];return he[a].map(s=>d+s)}function Ne(f,a,c,n){const d=f.target;t(a,d.checked,!0),t(c,new Set,!0),t(n,[],!0)}function Se(f,a,c,n){const d=f.target;t(a,d.checked,!0),t(c,new Set,!0),t(n,[],!0)}function be(f,a,c,n){const d=f.target;t(a,d.value,!0),t(c,new Set,!0),t(n,[],!0)}var Ce=Y('<div class="control-group svelte-qe37du"><label class="svelte-qe37du"><input type="checkbox" class="svelte-qe37du"/> In order</label></div> <div class="control-group svelte-qe37du"><label class="svelte-qe37du"><input type="checkbox" class="svelte-qe37du"/> Right hand</label></div> <div class="control-group svelte-qe37du"><label for="scaleMode" class="svelte-qe37du">Scale mode:</label> <select id="scaleMode" class="svelte-qe37du"><option class="svelte-qe37du">Major</option><option class="svelte-qe37du">Minor</option></select></div>',1),qe=Y('<!> <div class="scale-controls svelte-qe37du"><!></div>',1);function Pe(f,a){ce(a,!0);let c=b(x(a.sequentialMode??(a.randomMode?Math.random()>.5:!0))),n=b(x(a.handMode??(a.randomMode?Math.random()>.5:!0))),d=b(x(a.scaleMode??(a.randomMode?X[Math.floor(Math.random()*X.length)]:"Maj"))),s=b(x(new Set)),i=b(x([])),C=b(!1);function Z(){t(s,new Set,!0),t(i,[],!0),t(C,!1)}de(()=>{e(C)&&a.onComplete&&a.onComplete()});function I(r){const o=Me(r,e(d),e(n)),l=e(n)?"3":"1";return console.debug(`Scale for ${r}${l}:`,o.map(u=>H[u])),o}function $(r){const l=I(r).map(m=>H[m]),u=e(n)?l.map(m=>[m]):[],g=e(n)?[]:l.map(m=>[m]);return{selectedNote:r,leftHand:g,rightHand:u}}function ee(r,o,l,u){return e(c)?te(o,l):ae(o,l)}function te(r,o,l){const u=e(i).length,g=o[u];if(r.noteNumber===g)t(i,[...e(i),r.noteNumber],!0),t(s,new Set([...e(s),r.noteNumber]),!0);else{const m=H[g]?.slice(0,-1)??String(g);return t(i,[],!0),t(s,new Set,!0),{isCorrect:!1,message:`Wrong note! Expected ${m} (note ${u+1})`,collected:!1,resetCollected:!0}}return e(i).length===o.length?{isCorrect:!0,message:"Perfect scale! ðŸŽµâœ¨",collected:!0,resetCollected:!1}:{isCorrect:!0,message:`Good! Note ${u+1}/${o.length}`,collected:!0,resetCollected:!1}}function ae(r,o,l){return o.includes(r.noteNumber)?(t(s,new Set([...e(s),r.noteNumber]),!0),e(s).size===o.length?{isCorrect:!0,message:"Perfect scale! ðŸŽµ",collected:e(s).has(r.noteNumber),resetCollected:!1}:{isCorrect:!0,message:`Good! ${e(s).size}/${o.length} notes`,collected:e(s).has(r.noteNumber),resetCollected:!1}):(t(s,new Set,!0),{isCorrect:!1,message:"Wrong note!",resetCollected:!0,collected:!1})}function oe(r,o){if(e(c))return e(i).length===o.length&&e(i).every((l,u)=>l===o[u]);{const l=[...new Set(o)];return e(s).size===l.length}}{const r=(l,u=ie)=>{var g=qe();const m=A(()=>e(C)),B=A(()=>u().completed);var G=P(g);{var re=v=>{var h=Q();j(()=>D(h,t(C,!0))),E(v,h)},se=v=>{var h=me(),q=P(h);{var y=_=>{var S=Q();j(()=>D(S,t(C,!1))),E(_,S)};z(q,_=>{!e(B)&&e(m)&&_(y)},!0)}E(v,h)};z(G,v=>{e(B)&&!e(m)?v(re):v(se,!1)})}var L=w(G,2),le=M(L);{var ne=v=>{var h=Ce(),q=P(h),y=M(q),_=M(y);J(_),_.__change=[Ne,c,s,i],V(),N(y),N(q);var S=w(q,2),W=M(S),k=M(W);J(k),k.__change=[Se,n,s,i],V(),N(W),N(S);var F=w(S,2),p=w(M(F),2);p.__change=[be,d,s,i];var R=M(p);R.value=R.__value="Maj";var K=w(R);K.value=K.__value="Min",N(p);var O;fe(p),N(F),j(()=>{O!==(O=e(d))&&(p.value=(p.__value=e(d))??"",ge(p,e(d)))}),U(_,()=>e(c),T=>t(c,T)),U(k,()=>e(n),T=>t(n,T)),E(v,h)};z(le,v=>{a.randomMode||v(ne)})}N(L),E(l,g)};let o=A(()=>a.rootKey||"C");pe(f,{get randomMode(){return a.randomMode},generateExpectedNotes:I,generateScoreProps:$,validateNoteEvent:ee,isCompleted:oe,onReset:Z,onComplete:()=>{},get initialNote(){return e(o)},children:r,$$slots:{default:!0}})}ue()}ve(["change"]);export{Pe as component};
