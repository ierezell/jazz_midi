import{f as Y,a as x,t as te,c as Ne}from"../chunks/Dh1Z6ki8.js";import{p as Te,U as R,V as E,W as Re,k as e,a as Ae,Z as h,f as oe,s as r,Y as D,t as P,c as C,r as _}from"../chunks/DRD-yT8e.js";import{d as He,s as z}from"../chunks/Chq1SuiK.js";import{e as Ie,i as Ee}from"../chunks/CBGogYsa.js";import{i as O}from"../chunks/J_yv6X8T.js";import{i as U,s as q}from"../chunks/BsbaTnXO.js";import{B as De,a as Pe,b as Ve,g as we}from"../chunks/BV0_FfjC.js";import{A as V,e as ae,D as Be,N as Fe,b as Ge}from"../chunks/CXrKfc7O.js";import{p as K}from"../chunks/CyKTYWyr.js";var Le=Y("<option> </option>"),ke=Y('<div class="controls svelte-b6xay4"><div class="control-group svelte-b6xay4"><label for="chord-type" class="svelte-b6xay4">Chord Type</label> <select id="chord-type"></select></div> <div class="control-group svelte-b6xay4"><label for="inversion" class="svelte-b6xay4">Inversion</label> <select id="inversion"><option>Root</option><option>1st</option><option>2nd</option><option>3rd</option></select></div> <div class="control-group svelte-b6xay4"><label for="voicing" class="svelte-b6xay4">Voicing</label> <select id="voicing"><option>Full Right Hand</option><option>Full Left Hand</option><option>1 & 7 Left / 3 & 5 Right</option><option>1 & 5 Left / 3 & 7 Right</option><option>Rootless A (3-5-7-9)</option><option>Rootless B (7-9-3-5)</option></select></div></div>'),Se=Y("<!> <!>",1);function Je(re,a){Te(a,!0);const ne="Play the notes of the displayed chord on your MIDI keyboard. Try to match the voicing and inversion shown.";let A=["maj7","min7","7","dom7","half-dim7","dim7"],f=R(E(K.url.searchParams.get("root")??a.rootKey??(a.randomMode?V[Math.floor(Math.random()*V.length)]:"C"))),i=R(E(K.url.searchParams.get("quality")??a.chordType??(a.randomMode?A[Math.floor(Math.random()*A.length)]:"maj7"))),m=R(E(a.inversion??(a.randomMode?Math.floor(Math.random()*4):0))),c=R(E(a.voicing??(a.randomMode?ae[Math.floor(Math.random()*ae.length)]:"full-right"))),H=R(!1);function le(){const o=V[Math.floor(Math.random()*V.length)],t=A[Math.floor(Math.random()*A.length)],n=Math.floor(Math.random()*4);h(f,o,!0),h(i,t,!0),h(m,n,!0)}function se(){le(),a.onComplete?.()}function ie(o){const d=["C","C#","Db","D","D#","Eb","E","F","F#","Gb","G","G#","Ab","A","A#","Bb","B"].indexOf(e(f))>=10?"3":Be,l=e(f)+d,b=Fe[l],I=Pe(b,e(i),e(m));return Ve(I,e(c))}function ce(o,t,n){const d=n.map(b=>b%12),l=t.noteNumber%12;if(d.includes(l)){if(n.includes(t.noteNumber))return{isCorrect:!0,message:"Correct chord tone!",collected:!0,resetCollected:!1};if(e(c).startsWith("rootless"))return{isCorrect:!0,message:"Correct chord tone (octave ignored)!",collected:!0,resetCollected:!1}}return{isCorrect:!1,message:"Not a chord tone. Try again!",collected:!1,resetCollected:!0}}function de(o){const t=o.target;h(i,t.value,!0)}function ve(o){const t=o.target;h(m,parseInt(t.value),!0)}function ue(o){const t=o.target;h(c,t.value,!0)}function he(o){try{const t=we(e(f),e(i),e(m),e(c));return console.debug("Generated score data:",{currentRoot:e(f),chordType:e(i),voicing:e(c),inversion:e(m),scoreData:t}),{leftHand:t.leftHand,rightHand:t.rightHand,selectedNote:e(f)}}catch(t){return console.error("Error generating score data:",t),{selectedNote:"C",leftHand:[[]],rightHand:[["C4","E4","G4"]]}}}function fe(o,t){if(e(c).startsWith("rootless")){const n=new Set(o.map(l=>l%12)),d=new Set(t.map(l=>l%12));return n.size===d.size&&[...n].every(l=>d.has(l))}return o.length===t.length&&o.every(n=>t.includes(n))}function me(){h(H,!1)}let _e=D(()=>`${e(f)} ${e(i)}`),ge=D(()=>a.prompt??e(_e));De(re,{get randomMode(){return a.randomMode},generateExpectedNotes:ie,generateScoreProps:he,validateNoteEvent:ce,isCompleted:fe,onReset:me,onComplete:se,get initialNote(){return e(f)},description:ne,get progressiveHints(){return a.progressiveHints},get prompt(){return e(ge)},children:(t,n=Re)=>{const d=D(()=>e(H)),l=D(()=>n().completed);var b=Se(),I=oe(b);{var pe=s=>{var v=te();P(()=>z(v,h(H,!0))),x(s,v)},Ce=s=>{var v=Ne(),N=oe(v);{var u=y=>{var M=te();P(()=>z(M,h(H,!1))),x(y,M)};O(N,y=>{!e(l)&&e(d)&&y(u)},!0)}x(s,v)};O(I,s=>{e(l)&&!e(d)?s(pe):s(Ce,!1)})}var be=r(I,2);{var ye=s=>{var v=ke(),N=C(v),u=r(C(N),2);u.__change=de,Ie(u,21,()=>Ge,Ee,(Me,j)=>{var T=Le(),xe=C(T,!0);_(T);var ee={};P(()=>{z(xe,e(j)),ee!==(ee=e(j))&&(T.value=(T.__value=e(j))??"")}),x(Me,T)}),_(u);var y;U(u),_(N);var M=r(N,2),g=r(C(M),2);g.__change=ve;var w=C(g);w.value=w.__value=0;var B=r(w);B.value=B.__value=1;var F=r(B);F.value=F.__value=2;var Z=r(F);Z.value=Z.__value=3,_(g);var J;U(g),_(M);var Q=r(M,2),p=r(C(Q),2);p.__change=ue;var G=C(p);G.value=G.__value="full-right";var L=r(G);L.value=L.__value="full-left";var k=r(L);k.value=k.__value="1735";var S=r(k);S.value=S.__value="1537";var W=r(S);W.value=W.__value="rootless-a";var X=r(W);X.value=X.__value="rootless-b",_(p);var $;U(p),_(Q),_(v),P(()=>{y!==(y=e(i))&&(u.value=(u.__value=e(i))??"",q(u,e(i))),J!==(J=e(m))&&(g.value=(g.__value=e(m))??"",q(g,e(m))),$!==($=e(c))&&(p.value=(p.__value=e(c))??"",q(p,e(c)))}),x(s,v)};O(be,s=>{!a.randomMode&&!K.url.searchParams.get("unitId")&&s(ye)})}x(t,b)},$$slots:{default:!0}}),Ae()}He(["change"]);export{Je as component};
