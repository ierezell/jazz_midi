import{f as j,a as g,t as O,c as ue}from"../chunks/CX1yysGK.js";import{p as ve,J as w,K as k,d as fe,j as t,L as pe,a as me,M as a,f as P,s as $,N as A,c as y,r as _,t as E,O as ge}from"../chunks/Dpgs3mFS.js";import{d as _e,s as z}from"../chunks/dcQTQ1xv.js";import{e as he,i as xe}from"../chunks/D0omyc6-.js";import{i as D}from"../chunks/FFlPY-wq.js";import{i as be,r as Me,s as Ne}from"../chunks/gBQeIBP2.js";import{b as ye}from"../chunks/SMVfkwnP.js";import{A as K,N as T,I as L,M as W}from"../chunks/DgZpB3qr.js";import{B as Ce,c as Y}from"../chunks/CedzibQm.js";var Ie=j('<option class="svelte-os8fbx"> </option>'),we=j('<div class="control-group svelte-os8fbx"><label for="intervalType" class="svelte-os8fbx">Interval Type:</label> <select id="intervalType" class="svelte-os8fbx"></select></div> <div class="control-group svelte-os8fbx"><label class="svelte-os8fbx"><input type="checkbox" class="svelte-os8fbx"/> Right hand</label></div>',1),Ee=j('<!> <div class="controls svelte-os8fbx"><!></div>',1);function De(F,v){ve(v,!0);const Q="Play the interval shown on the staff using your MIDI keyboard. Listen and check your answer.";let C=v.randomMode,B=v.onComplete,U=v.intervalType,X=v.rightHandMode,Z=v.rootKey,d=w(k(U??(C?K[Math.floor(Math.random()*K.length)]:"major3rd"))),h=w(k(X??(C?Math.random()>.5:!0))),i=w(k(new Set)),x=w(!1);function ee(){a(i,new Set,!0),a(x,!1)}fe(()=>{t(x)&&B&&B()});function te(o){try{const e=t(h)?"3":"4",r=Y(o,t(d),e),s=T[o+e],n=T[r+e];return console.debug(`Interval ${L[t(d)]} from ${o}${e} to ${r}${e}:`,`Root MIDI: ${s}, Expected MIDI: ${n}`),[s,n]}catch(e){console.error("Error generating expected note:",e);const r=T.C4,s=T.E4;return[r,s]}}function oe(o){try{const e=Y(o,t(d),"4"),r=o+"4",s=W[e];let n=[],f=[];return t(h)?f=[[r,s]]:n=[[r,s]],{selectedNote:o,leftHand:n,rightHand:f}}catch(e){return console.error("Error generating score props:",e),{selectedNote:o,leftHand:[],rightHand:[["C4","E4"]]}}}function re(o,e,r,s){const[n,f]=r,p=L[t(d)];return r.includes(e.noteNumber)?(a(i,new Set([...t(i),e.noteNumber]),!0),t(i).size===2?{isCorrect:!0,message:`Perfect ${p}! ðŸŽµâœ¨`,collected:!0,resetCollected:!1}:{isCorrect:!0,message:`Good! ${e.noteNumber===n?"root":p} played (${t(i).size}/2)`,collected:!0,resetCollected:!1}):(a(i,new Set,!0),{isCorrect:!1,message:`Wrong! You played ${W[e.noteNumber]?.slice(0,-1)}. Play ${p} from ${o}`,collected:!1,resetCollected:!0})}function ae(o,e){const r=[...new Set(e)];return t(i).size===r.length}function se(o){const e=o.target;a(d,e.value,!0),a(i,new Set,!0)}function ne(o){const e=o.target;a(h,e.checked,!0),a(i,new Set,!0)}{const o=(r,s=pe)=>{const n=A(()=>t(x)),f=A(()=>s().completed);var p=Ee(),I=P(p);{var V=l=>{var u=O();E(()=>z(u,a(x,!0))),g(l,u)},le=l=>{var u=ue(),b=P(u);{var c=m=>{var M=O();E(()=>z(M,a(x,!1))),g(m,M)};D(b,m=>{!t(f)&&t(n)&&m(c)},!0)}g(l,u)};D(I,l=>{t(f)&&!t(n)?l(V):l(le,!1)})}var q=$(I,2),ie=y(q);{var ce=l=>{var u=we(),b=P(u),c=$(y(b),2);c.__change=se,he(c,21,()=>K,xe,(R,H)=>{var N=Ie(),de=y(N,!0);_(N);var J={};E(()=>{z(de,L[t(H)]),J!==(J=t(H))&&(N.value=(N.__value=t(H))??"")}),g(R,N)}),_(c);var m;be(c),_(b);var M=$(b,2),G=y(M),S=y(G);Me(S),S.__change=ne,ge(),_(G),_(M),E(()=>{m!==(m=t(d))&&(c.value=(c.__value=t(d))??"",Ne(c,t(d)))}),ye(S,()=>t(h),R=>a(h,R)),g(l,u)};D(ie,l=>{C||l(ce)})}_(q),g(r,p)};let e=A(()=>Z||"C");Ce(F,{get randomMode(){return C},generateExpectedNotes:te,generateScoreProps:oe,validateNoteEvent:re,isCompleted:ae,onReset:ee,onComplete:()=>{},get initialNote(){return t(e)},description:Q,children:o,$$slots:{default:!0}})}me()}_e(["change"]);export{De as component};
