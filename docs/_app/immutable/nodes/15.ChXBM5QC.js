import{f as X,a as V}from"../chunks/Bdvgn338.js";import{p as ce,U as C,V as b,W as ie,k as e,X as T,a as ue,Z as l,c as _,r as M,f as de,_ as fe,s as S,t as me}from"../chunks/ZtE6Gyvq.js";import{d as ve}from"../chunks/BnZ86L-c.js";import{i as ge}from"../chunks/CdTPX8-T.js";import{r as he,i as D,s as F}from"../chunks/DhWXMPZY.js";import{b as pe}from"../chunks/CVoLLLxN.js";import{p as _e}from"../chunks/-nZJNBOr.js";import{S as Me,N as O,A as q,M as U}from"../chunks/CXrKfc7O.js";import{B as Se}from"../chunks/BGuIuzZe.js";import{p as Ce}from"../chunks/BciydY-1.js";function be(w,s,N){let c="right";typeof N=="boolean"?c=N?"right":"left":c=N;const v=Me[s],i=[];if(c==="left"||c==="both"){const u=O[w+"2"];i.push(...v.map(g=>u+g))}if(c==="right"||c==="both"){const u=O[w+"3"];i.push(...v.map(g=>u+g))}return c==="both"&&i.sort((u,g)=>u-g),i}var Ne=X('<div class="control-group svelte-1l89l8c"><label class="svelte-1l89l8c"><input type="checkbox" class="svelte-1l89l8c"/> In order</label></div> <div class="control-group svelte-1l89l8c"><label for="handMode" class="svelte-1l89l8c">Hand:</label> <select id="handMode" class="svelte-1l89l8c"><option class="svelte-1l89l8c">Right Hand</option><option class="svelte-1l89l8c">Left Hand</option><option class="svelte-1l89l8c">Both Hands</option></select></div> <div class="control-group svelte-1l89l8c"><label for="scaleMode" class="svelte-1l89l8c">Scale mode:</label> <select id="scaleMode" class="svelte-1l89l8c"><option class="svelte-1l89l8c">Major</option><option class="svelte-1l89l8c">Minor</option></select></div>',1),ye=X('<div class="scale-controls svelte-1l89l8c"><!></div>');function Ie(w,s){ce(s,!0);const N="Play the scale shown, ascending and/or descending, using your MIDI keyboard. Try to follow the correct order.";let c=_e(s,"strictMode",3,!0),v=C(b(s.sequentialMode??!1)),i=C(b(s.handMode??"right")),u=C(b(s.scaleMode??"Maj")),g=C(b(s.rootKey??(s.randomMode?q[Math.floor(Math.random()*q.length)]:"C"))),E=T(()=>s.rootKey??e(g)),d=C(b([])),a=C(b(new Set)),Z=T(()=>`${e(E)} ${e(u)==="Maj"?"Major":"Minor"} Scale`),J=T(()=>s.prompt??e(Z));function Q(){l(d,[],!0),l(a,new Set,!0)}function Y(o,t,n,r){return e(v)?ee(t,n):te(t,n)}function A(o){return be(e(E),e(u),e(i))}function $(o){const n=A().map(r=>U[r]);return{selectedNote:e(E),leftHand:e(i)==="left"||e(i)==="both"?[n]:[],rightHand:e(i)==="right"||e(i)==="both"?[n]:[]}}function ee(o,t,n){const r=e(d).length,f=t[r];if(c()?o.noteNumber===f:o.noteNumber%12===f%12)l(d,[...e(d),o.noteNumber],!0),l(a,new Set([...e(a),o.noteNumber]),!0);else{const m=U[f]?.slice(0,-1)??String(f);return l(d,[],!0),l(a,new Set,!0),{isCorrect:!1,message:`Wrong note! Expected ${m} ${c()?"":"(any octave)"}`,collected:!1,resetCollected:!0}}return e(d).length===t.length?{isCorrect:!0,message:"Perfect scale! ðŸŽµâœ¨",collected:!0,resetCollected:!1}:{isCorrect:!0,message:`Good! Note ${r+1}/${t.length}`,collected:!0,resetCollected:!1}}function te(o,t,n){const r=t.map(m=>m%12),f=o.noteNumber%12;if(c()?t.includes(o.noteNumber):r.includes(f)){l(a,new Set([...e(a),o.noteNumber]),!0);let m=!1;if(c())m=e(a).size===t.length;else{const x=new Set([...e(a)].map(H=>H%12)),y=new Set(r);m=x.size===y.size}return m?{isCorrect:!0,message:"Perfect scale! ðŸŽµ",collected:!0,resetCollected:!1}:{isCorrect:!0,message:`Good! ${e(a).size}/${t.length} notes`,collected:!0,resetCollected:!1}}else return l(a,new Set,!0),{isCorrect:!1,message:"Wrong note!",resetCollected:!0,collected:!1}}function le(o,t){if(e(v))return e(d).length===t.length&&e(d).every((n,r)=>c()?n===t[r]:n%12===t[r]%12);if(c()){const n=[...new Set(t)];return e(a).size===n.length}else{const n=new Set([...e(a)].map(f=>f%12)),r=new Set(t.map(f=>f%12));return n.size===r.size}}function oe(o){const t=o.target;l(v,t.checked,!0),l(a,new Set,!0),l(d,[],!0)}function re(o){const t=o.target;l(i,t.value,!0),l(a,new Set,!0),l(d,[],!0)}function se(o){const t=o.target;l(u,t.value,!0),l(a,new Set,!0),l(d,[],!0)}function ae(){if(s.randomMode){const o=q[Math.floor(Math.random()*q.length)],t=Math.random()>.5?"Maj":"Min";l(g,o,!0),l(u,t,!0),l(a,new Set,!0),l(d,[],!0)}s.onComplete?.()}Se(w,{get randomMode(){return s.randomMode},generateExpectedNotes:A,generateScoreProps:$,validateNoteEvent:Y,isCompleted:le,onReset:Q,onComplete:ae,get initialNote(){return e(E)},description:N,exerciseType:"scale",get progressiveHints(){return s.progressiveHints},get prompt(){return e(J)},children:(t,n=ie)=>{var r=ye(),f=_(r);{var P=m=>{var x=Ne(),y=de(x),H=_(y),z=_(H);he(z),z.__change=oe,fe(),M(H),M(y);var R=S(y,2),h=S(_(R),2);h.__change=re;var j=_(h);j.value=j.__value="right";var k=S(j);k.value=k.__value="left";var K=S(k);K.value=K.__value="both",M(h);var B;D(h),M(R);var L=S(R,2),p=S(_(L),2);p.__change=se;var I=_(p);I.value=I.__value="Maj";var W=S(I);W.value=W.__value="Min",M(p);var G;D(p),M(L),me(()=>{B!==(B=e(i))&&(h.value=(h.__value=e(i))??"",F(h,e(i))),G!==(G=e(u))&&(p.value=(p.__value=e(u))??"",F(p,e(u)))}),pe(z,()=>e(v),ne=>l(v,ne)),V(m,x)};ge(f,m=>{!s.randomMode&&!Ce.url.searchParams.get("unitId")&&m(P)})}M(r),V(t,r)},$$slots:{default:!0}}),ue()}ve(["change"]);export{Ie as component};
