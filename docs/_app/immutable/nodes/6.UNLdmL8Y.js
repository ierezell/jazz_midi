import{f as K,a as g,t as G,c as ue}from"../chunks/BHFmxDGj.js";import{p as ve,U as w,V as k,n as fe,v as t,W as pe,a as me,X as a,f as P,s as $,Y as A,c as N,r as _,t as E,Z as ge}from"../chunks/D-WvxLPx.js";import{d as _e,s as z}from"../chunks/y4LLdheI.js";import{e as he,i as xe}from"../chunks/DiVgXp1T.js";import{i as D}from"../chunks/DD9bTvrE.js";import{i as be,r as ye,a as Me}from"../chunks/C_BxDK4Q.js";import{b as Ne}from"../chunks/DdwD3CYA.js";import{A as V,N as T,I as B,M as U}from"../chunks/DgZpB3qr.js";import{B as Ce,c as X}from"../chunks/CpJS4eQ0.js";var Ie=K('<option class="svelte-os8fbx"> </option>'),we=K('<div class="control-group svelte-os8fbx"><label for="intervalType" class="svelte-os8fbx">Interval Type:</label> <select id="intervalType" class="svelte-os8fbx"></select></div> <div class="control-group svelte-os8fbx"><label class="svelte-os8fbx"><input type="checkbox" class="svelte-os8fbx"/> Right hand</label></div>',1),Ee=K('<!> <div class="controls svelte-os8fbx"><!></div>',1);function De(Z,v){ve(v,!0);const F="Play the interval shown on the staff using your MIDI keyboard. Listen and check your answer.";let C=v.randomMode,L=v.onComplete,J=v.intervalType,O=v.rightHandMode,Q=v.rootKey,d=w(k(J??(C?V[Math.floor(Math.random()*V.length)]:"major3rd"))),h=w(k(O??(C?Math.random()>.5:!0))),i=w(k(new Set)),x=w(!1);function ee(){a(i,new Set,!0),a(x,!1)}fe(()=>{t(x)&&L&&L()});function te(o){try{const e=t(h)?"3":"4",r=X(o,t(d),e),s=T[o+e],n=T[r+e];return console.debug(`Interval ${B[t(d)]} from ${o}${e} to ${r}${e}:`,`Root MIDI: ${s}, Expected MIDI: ${n}`),[s,n]}catch(e){console.error("Error generating expected note:",e);const r=T.C4,s=T.E4;return[r,s]}}function oe(o){try{const e=X(o,t(d),"4"),r=o+"4",s=U[e];let n=[],f=[];return t(h)?f=[[r,s]]:n=[[r,s]],{selectedNote:o,leftHand:n,rightHand:f}}catch(e){return console.error("Error generating score props:",e),{selectedNote:o,leftHand:[],rightHand:[["C4","E4"]]}}}function re(o,e,r,s){const[n,f]=r,p=B[t(d)];return r.includes(e.noteNumber)?(a(i,new Set([...t(i),e.noteNumber]),!0),t(i).size===2?{isCorrect:!0,message:`Perfect ${p}! ðŸŽµâœ¨`,collected:!0,resetCollected:!1}:{isCorrect:!0,message:`Good! ${e.noteNumber===n?"root":p} played (${t(i).size}/2)`,collected:!0,resetCollected:!1}):(a(i,new Set,!0),{isCorrect:!1,message:`Wrong! You played ${U[e.noteNumber]?.slice(0,-1)}. Play ${p} from ${o}`,collected:!1,resetCollected:!0})}function ae(o,e){const r=[...new Set(e)];return t(i).size===r.length}function se(o){const e=o.target;a(d,e.value,!0),a(i,new Set,!0)}function ne(o){const e=o.target;a(h,e.checked,!0),a(i,new Set,!0)}{const o=(r,s=pe)=>{const n=A(()=>t(x)),f=A(()=>s().completed);var p=Ee(),I=P(p);{var W=l=>{var u=G();E(()=>z(u,a(x,!0))),g(l,u)},le=l=>{var u=ue(),b=P(u);{var c=m=>{var y=G();E(()=>z(y,a(x,!1))),g(m,y)};D(b,m=>{!t(f)&&t(n)&&m(c)},!0)}g(l,u)};D(I,l=>{t(f)&&!t(n)?l(W):l(le,!1)})}var Y=$(I,2),ie=N(Y);{var ce=l=>{var u=we(),b=P(u),c=$(N(b),2);c.__change=se,he(c,21,()=>V,xe,(R,H)=>{var M=Ie(),de=N(M,!0);_(M);var q={};E(()=>{z(de,B[t(H)]),q!==(q=t(H))&&(M.value=(M.__value=t(H))??"")}),g(R,M)}),_(c);var m;be(c),_(b);var y=$(b,2),j=N(y),S=N(j);ye(S),S.__change=ne,ge(),_(j),_(y),E(()=>{m!==(m=t(d))&&(c.value=(c.__value=t(d))??"",Me(c,t(d)))}),Ne(S,()=>t(h),R=>a(h,R)),g(l,u)};D(ie,l=>{C||l(ce)})}_(Y),g(r,p)};let e=A(()=>Q||"C");Ce(Z,{get randomMode(){return C},generateExpectedNotes:te,generateScoreProps:oe,validateNoteEvent:re,isCompleted:ae,onReset:ee,onComplete:()=>{},get initialNote(){return t(e)},description:F,children:o,$$slots:{default:!0}})}me()}_e(["change"]);export{De as component};
