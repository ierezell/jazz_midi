import{f as F,a as G}from"../chunks/BHFmxDGj.js";import{p as oe,U as p,V as _,W as re,v as t,a as ae,X as r,Y as k,c as f,r as v,f as le,Z as K,s as M,t as se}from"../chunks/D-WvxLPx.js";import{d as ne}from"../chunks/y4LLdheI.js";import{i as ce}from"../chunks/DD9bTvrE.js";import{r as L,i as ie,a as de}from"../chunks/C_BxDK4Q.js";import{b as V}from"../chunks/DdwD3CYA.js";import{S as ue,N as me,M as T,d as D}from"../chunks/DgZpB3qr.js";import{B as ge}from"../chunks/CpJS4eQ0.js";import{p as q}from"../chunks/BpP5SezP.js";function fe(N,n,S){const u=me[N+(S?"3":"1")];return ue[n].map(i=>u+i)}var ve=F('<div class="control-group svelte-1l89l8c"><label class="svelte-1l89l8c"><input type="checkbox" class="svelte-1l89l8c"/> In order</label></div> <div class="control-group svelte-1l89l8c"><label class="svelte-1l89l8c"><input type="checkbox" class="svelte-1l89l8c"/> Right hand</label></div> <div class="control-group svelte-1l89l8c"><label for="scaleMode" class="svelte-1l89l8c">Scale mode:</label> <select id="scaleMode" class="svelte-1l89l8c"><option class="svelte-1l89l8c">Major</option><option class="svelte-1l89l8c">Minor</option></select></div>',1),he=F('<div class="scale-controls svelte-1l89l8c"><!></div>');function xe(N,n){oe(n,!0);const S="Play the scale shown, ascending and/or descending, using your MIDI keyboard. Try to follow the correct order.",I=k(()=>q.url.searchParams.get("root"));let u=p(_(n.sequentialMode??(n.randomMode?Math.random()>.5:!0))),i=p(_(n.rightHandMode??(n.randomMode?Math.random()>.5:!0))),h=k(()=>q.url.searchParams.get("mode")??n.scaleMode??(n.randomMode?D[Math.floor(Math.random()*D.length)]:"Maj")),O=k(()=>t(I)??n.rootKey??"C"),a=p(_(new Set)),c=p(_([]));function U(){r(a,new Set,!0),r(c,[],!0)}function R(o){const e=fe(o,t(h),t(i)),l=t(i)?"3":"1";return console.debug(`Scale for ${o}${l}:`,e.map(s=>T[s])),e}function X(o){const l=R(o).map(d=>T[d]),s=t(i)?l.map(d=>[d]):[],m=t(i)?[]:l.map(d=>[d]);return{selectedNote:o,leftHand:m,rightHand:s}}function Y(o,e,l,s){return t(u)?Z(e,l):J(e,l)}function Z(o,e,l){const s=t(c).length,m=e[s];if(o.noteNumber===m)r(c,[...t(c),o.noteNumber],!0),r(a,new Set([...t(a),o.noteNumber]),!0);else{const d=T[m]?.slice(0,-1)??String(m);return r(c,[],!0),r(a,new Set,!0),{isCorrect:!1,message:`Wrong note! Expected ${d} (note ${s+1})`,collected:!1,resetCollected:!0}}return t(c).length===e.length?{isCorrect:!0,message:"Perfect scale! ðŸŽµâœ¨",collected:!0,resetCollected:!1}:{isCorrect:!0,message:`Good! Note ${s+1}/${e.length}`,collected:!0,resetCollected:!1}}function J(o,e,l){return e.includes(o.noteNumber)?(r(a,new Set([...t(a),o.noteNumber]),!0),t(a).size===e.length?{isCorrect:!0,message:"Perfect scale! ðŸŽµ",collected:t(a).has(o.noteNumber),resetCollected:!1}:{isCorrect:!0,message:`Good! ${t(a).size}/${e.length} notes`,collected:t(a).has(o.noteNumber),resetCollected:!1}):(r(a,new Set,!0),{isCorrect:!1,message:"Wrong note!",resetCollected:!0,collected:!1})}function Q(o,e){if(t(u))return t(c).length===e.length&&t(c).every((l,s)=>l===e[s]);{const l=[...new Set(e)];return t(a).size===l.length}}function $(o){const e=o.target;r(u,e.checked,!0),r(a,new Set,!0),r(c,[],!0)}function ee(o){const e=o.target;r(i,e.checked,!0),r(a,new Set,!0),r(c,[],!0)}function te(o){const e=o.target;r(h,e.value),r(a,new Set,!0),r(c,[],!0)}ge(N,{get randomMode(){return n.randomMode},generateExpectedNotes:R,generateScoreProps:X,validateNoteEvent:Y,isCompleted:Q,onReset:U,get onComplete(){return n.onComplete},get initialNote(){return t(O)},description:S,exerciseType:"scale",children:(e,l=re)=>{var s=he(),m=f(s);{var d=b=>{var A=ve(),C=le(A),H=f(C),y=f(H);L(y),y.__change=$,K(),v(H),v(C);var w=M(C,2),j=f(w),x=f(j);L(x),x.__change=ee,K(),v(j),v(w);var z=M(w,2),g=M(f(z),2);g.__change=te;var E=f(g);E.value=E.__value="Maj";var W=M(E);W.value=W.__value="Min",v(g);var B;ie(g),v(z),se(()=>{B!==(B=t(h))&&(g.value=(g.__value=t(h))??"",de(g,t(h)))}),V(y,()=>t(u),P=>r(u,P)),V(x,()=>t(i),P=>r(i,P)),G(b,A)};ce(m,b=>{!n.randomMode&&!q.url.searchParams.get("unitId")&&b(d)})}v(s),G(e,s)},$$slots:{default:!0}}),ae()}ne(["change"]);export{xe as component};
