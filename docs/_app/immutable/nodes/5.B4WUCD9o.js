import"../chunks/NZTpNUN0.js";import{p as ie,N as E,O as P,g as ce,k as e,c as de,P as ue,f as L,a as $,s as z,b as _,R as a,Q as A,d as T,r as h,S as Y,t as S,T as ve,V as pe}from"../chunks/DekTh3_k.js";import{d as fe,s as D}from"../chunks/BEn0398A.js";import{i as V}from"../chunks/De59rqUo.js";import{b as B,I as K,M as me,N as q,e as ge,i as _e}from"../chunks/BcYS4v02.js";import{i as he,r as xe,s as Ne}from"../chunks/9bBOD8_0.js";import{b as ye}from"../chunks/BqeKQDpR.js";import{B as Me,a as F}from"../chunks/Bq00vTX4.js";function be(x,n,N){const u=x.target;a(n,u.value,!0),a(N,new Set,!0)}function Ce(x,n,N){const u=x.target;a(n,u.checked,!0),a(N,new Set,!0)}var Ie=L('<option class="svelte-qr0cx"> </option>'),Te=L('<div class="control-group svelte-qr0cx"><label for="intervalType" class="svelte-qr0cx">Interval Type:</label> <select id="intervalType" class="svelte-qr0cx"></select></div> <div class="control-group svelte-qr0cx"><label class="svelte-qr0cx"><input type="checkbox" class="svelte-qr0cx"/> Right hand</label></div>',1),we=L('<!> <div class="controls svelte-qr0cx"><!></div>',1);function ze(x,n){ie(n,!0);const N="Play the interval shown on the staff using your MIDI keyboard. Listen and check your answer.";let u=n.randomMode,j=n.onComplete,J=n.intervalType,U=n.rightHandMode,X=n.rootKey,v=E(P(J??(u?B[Math.floor(Math.random()*B.length)]:"major3rd"))),y=E(P(U??(u?Math.random()>.5:!0))),c=E(P(new Set)),M=E(!1);function Z(){a(c,new Set,!0),a(M,!1)}ce(()=>{e(M)&&j&&j()});function ee(o){try{const t=e(y)?"3":"4",r=F(o,e(v),t),s=q[o+t],l=q[r+t];return console.debug(`Interval ${K[e(v)]} from ${o}${t} to ${r}${t}:`,`Root MIDI: ${s}, Expected MIDI: ${l}`),[s,l]}catch(t){console.error("Error generating expected note:",t);const r=q.C4,s=q.E4;return[r,s]}}function te(o){try{const t=F(o,e(v),"4"),r=o+"4",s=t+"4";let l=[],f=[];return e(y)?f=[[r,s]]:l=[[r,s]],{selectedNote:o,leftHand:l,rightHand:f}}catch(t){return console.error("Error generating score props:",t),{selectedNote:o,leftHand:[],rightHand:[["C4","E4"]]}}}function re(o,t,r,s){const[l,f]=r,m=K[e(v)];return r.includes(t.noteNumber)?(a(c,new Set([...e(c),t.noteNumber]),!0),e(c).size===2?{isCorrect:!0,message:`Perfect ${m}! ðŸŽµâœ¨`,collected:!0,resetCollected:!1}:{isCorrect:!0,message:`Good! ${t.noteNumber===l?"root":m} played (${e(c).size}/2)`,collected:!0,resetCollected:!1}):(a(c,new Set,!0),{isCorrect:!1,message:`Wrong! You played ${me[t.noteNumber]?.slice(0,-1)}. Play ${m} from ${o}`,collected:!1,resetCollected:!0})}function oe(o,t){const r=[...new Set(t)];return e(c).size===r.length}{const o=(r,s=ue)=>{var l=we();const f=A(()=>e(M)),m=A(()=>s().completed);var w=$(l);{var G=i=>{var p=Y();S(()=>D(p,a(M,!0))),_(i,p)},ae=i=>{var p=ve(),b=$(p);{var d=g=>{var C=Y();S(()=>D(C,a(M,!1))),_(g,C)};V(b,g=>{!e(m)&&e(f)&&g(d)},!0)}_(i,p)};V(w,i=>{e(m)&&!e(f)?i(G):i(ae,!1)})}var O=z(w,2),ne=T(O);{var se=i=>{var p=Te(),b=$(p),d=z(T(b),2);d.__change=[be,v,c],ge(d,21,()=>B,_e,(k,H)=>{var I=Ie(),le=T(I,!0);h(I);var W={};S(()=>{D(le,K[e(H)]),W!==(W=e(H))&&(I.value=(I.__value=e(H))??"")}),_(k,I)}),h(d);var g;he(d),h(b);var C=z(b,2),Q=T(C),R=T(Q);xe(R),R.__change=[Ce,y,c],pe(),h(Q),h(C),S(()=>{g!==(g=e(v))&&(d.value=(d.__value=e(v))??"",Ne(d,e(v)))}),ye(R,()=>e(y),k=>a(y,k)),_(i,p)};V(ne,i=>{u||i(se)})}h(O),_(r,l)};let t=A(()=>X||"C");Me(x,{get randomMode(){return u},generateExpectedNotes:ee,generateScoreProps:te,validateNoteEvent:re,isCompleted:oe,onReset:Z,onComplete:()=>{},get initialNote(){return e(t)},description:N,children:o,$$slots:{default:!0}})}de()}fe(["change"]);export{ze as component};
