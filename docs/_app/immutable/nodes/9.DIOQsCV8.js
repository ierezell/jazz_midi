import{f as K,a as g,t as X,c as fe}from"../chunks/Dd8hKrah.js";import{p as ve,U as w,V as P,g as pe,k as e,W as me,X as E,a as ge,Z as a,f as z,s as A,c as N,r as _,t as T,_ as _e}from"../chunks/DFyylC6V.js";import{d as he,s as D}from"../chunks/DmHNaigj.js";import{e as xe,i as be}from"../chunks/CFkAzgcL.js";import{i as V}from"../chunks/B0w1lo-d.js";import{i as ye,r as Me,s as Ne}from"../chunks/DI7-7HPV.js";import{b as Ce}from"../chunks/CX2CDPdy.js";import{a as B,N as S,I as R,M as Y}from"../chunks/CXrKfc7O.js";import{B as Ie,c as Z}from"../chunks/Cfo6fIsG.js";var we=K('<option class="svelte-os8fbx"> </option>'),Ee=K('<div class="control-group svelte-os8fbx"><label for="intervalType" class="svelte-os8fbx">Interval Type:</label> <select id="intervalType" class="svelte-os8fbx"></select></div> <div class="control-group svelte-os8fbx"><label class="svelte-os8fbx"><input type="checkbox" class="svelte-os8fbx"/> Right hand</label></div>',1),Te=K('<!> <div class="controls svelte-os8fbx"><!></div>',1);function Ve(F,f){ve(f,!0);const J="Play the interval shown on the staff using your MIDI keyboard. Listen and check your answer.";let C=f.randomMode,L=f.onComplete,O=f.intervalType,Q=f.rightHandMode,W=f.rootKey,i=w(P(O??(C?B[Math.floor(Math.random()*B.length)]:"major3rd"))),h=w(P(Q??(C?Math.random()>.5:!0))),c=w(P(new Set)),x=w(!1);function ee(){a(c,new Set,!0),a(x,!1)}pe(()=>{e(x)&&L&&L()});function te(o){try{const t=e(h)?"3":"4",r=Z(o,e(i),t),s=S[o+t],n=S[r+t];return console.debug(`Interval ${R[e(i)]} from ${o}${t} to ${r}${t}:`,`Root MIDI: ${s}, Expected MIDI: ${n}`),[s,n]}catch(t){console.error("Error generating expected note:",t);const r=S.C4,s=S.E4;return[r,s]}}function oe(o){try{const t=Z(o,e(i),"4"),r=o+"4",s=Y[t];let n=[],v=[];return e(h)?v=[[r,s]]:n=[[r,s]],{selectedNote:o,leftHand:n,rightHand:v}}catch(t){return console.error("Error generating score props:",t),{selectedNote:o,leftHand:[],rightHand:[["C4","E4"]]}}}function re(o,t,r,s){const[n,v]=r,p=R[e(i)];return r.includes(t.noteNumber)?(a(c,new Set([...e(c),t.noteNumber]),!0),e(c).size===2?{isCorrect:!0,message:`Perfect ${p}! ðŸŽµâœ¨`,collected:!0,resetCollected:!1}:{isCorrect:!0,message:`Good! ${t.noteNumber===n?"root":p} played (${e(c).size}/2)`,collected:!0,resetCollected:!1}):(a(c,new Set,!0),{isCorrect:!1,message:`Wrong! You played ${Y[t.noteNumber]?.slice(0,-1)}. Play ${p} from ${o}`,collected:!1,resetCollected:!0})}function ae(o,t){const r=[...new Set(t)];return e(c).size===r.length}function se(o){const t=o.target;a(i,t.value,!0),a(c,new Set,!0)}function ne(o){const t=o.target;a(h,t.checked,!0),a(c,new Set,!0)}let le=E(()=>`${R[e(i)]} from ${W||"C"}`);{const o=(r,s=me)=>{const n=E(()=>e(x)),v=E(()=>s().completed);var p=Te(),I=z(p);{var j=l=>{var u=X();T(()=>D(u,a(x,!0))),g(l,u)},ie=l=>{var u=fe(),b=z(u);{var d=m=>{var y=X();T(()=>D(y,a(x,!1))),g(m,y)};V(b,m=>{!e(v)&&e(n)&&m(d)},!0)}g(l,u)};V(I,l=>{e(v)&&!e(n)?l(j):l(ie,!1)})}var q=A(I,2),ce=N(q);{var de=l=>{var u=Ee(),b=z(u),d=A(N(b),2);d.__change=se,xe(d,21,()=>B,be,(H,$)=>{var M=we(),ue=N(M,!0);_(M);var U={};T(()=>{D(ue,R[e($)]),U!==(U=e($))&&(M.value=(M.__value=e($))??"")}),g(H,M)}),_(d);var m;ye(d),_(b);var y=A(b,2),G=N(y),k=N(G);Me(k),k.__change=ne,_e(),_(G),_(y),T(()=>{m!==(m=e(i))&&(d.value=(d.__value=e(i))??"",Ne(d,e(i)))}),Ce(k,()=>e(h),H=>a(h,H)),g(l,u)};V(ce,l=>{C||l(de)})}_(q),g(r,p)};let t=E(()=>W||"C");Ie(F,{get randomMode(){return C},generateExpectedNotes:te,generateScoreProps:oe,validateNoteEvent:re,isCompleted:ae,onReset:ee,onComplete:()=>{},get initialNote(){return e(t)},description:J,get prompt(){return e(le)},children:o,$$slots:{default:!0}})}ge()}he(["change"]);export{Ve as component};
