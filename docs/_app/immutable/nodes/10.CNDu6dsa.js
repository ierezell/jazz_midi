import{f as W,a as z}from"../chunks/CX1yysGK.js";import{p as te,J as _,K as p,L as le,j as t,a as oe,M as o,N as L,c as m,r as f,f as re,O as B,s as M,t as ae}from"../chunks/Dpgs3mFS.js";import{d as ne}from"../chunks/dcQTQ1xv.js";import{i as se}from"../chunks/FFlPY-wq.js";import{r as G,i as ce,s as ie}from"../chunks/gBQeIBP2.js";import{b as K}from"../chunks/SMVfkwnP.js";import{S as de,N as ue,d as O,M as T}from"../chunks/DgZpB3qr.js";import{B as ge}from"../chunks/CedzibQm.js";function me(N,n,S){const d=ue[N+(S?"3":"1")];return de[n].map(u=>d+u)}var fe=W('<div class="control-group svelte-1l89l8c"><label class="svelte-1l89l8c"><input type="checkbox" class="svelte-1l89l8c"/> In order</label></div> <div class="control-group svelte-1l89l8c"><label class="svelte-1l89l8c"><input type="checkbox" class="svelte-1l89l8c"/> Right hand</label></div> <div class="control-group svelte-1l89l8c"><label for="scaleMode" class="svelte-1l89l8c">Scale mode:</label> <select id="scaleMode" class="svelte-1l89l8c"><option class="svelte-1l89l8c">Major</option><option class="svelte-1l89l8c">Minor</option></select></div>',1),ve=W('<div class="scale-controls svelte-1l89l8c"><!></div>');function ye(N,n){te(n,!0);const S="Play the scale shown, ascending and/or descending, using your MIDI keyboard. Try to follow the correct order.";let v=_(p(n.sequentialMode??(n.randomMode?Math.random()>.5:!0))),d=_(p(n.rightHandMode??(n.randomMode?Math.random()>.5:!0))),u=_(p(n.scaleMode??(n.randomMode?O[Math.floor(Math.random()*O.length)]:"Maj"))),r=_(p(new Set)),c=_(p([]));function D(){o(r,new Set,!0),o(c,[],!0)}function q(l){const e=me(l,t(u),t(d)),a=t(d)?"3":"1";return console.debug(`Scale for ${l}${a}:`,e.map(s=>T[s])),e}function F(l){const a=q(l).map(i=>T[i]),s=t(d)?a.map(i=>[i]):[],h=t(d)?[]:a.map(i=>[i]);return{selectedNote:l,leftHand:h,rightHand:s}}function J(l,e,a,s){return t(v)?V(e,a):Q(e,a)}function V(l,e,a){const s=t(c).length,h=e[s];if(l.noteNumber===h)o(c,[...t(c),l.noteNumber],!0),o(r,new Set([...t(r),l.noteNumber]),!0);else{const i=T[h]?.slice(0,-1)??String(h);return o(c,[],!0),o(r,new Set,!0),{isCorrect:!1,message:`Wrong note! Expected ${i} (note ${s+1})`,collected:!1,resetCollected:!0}}return t(c).length===e.length?{isCorrect:!0,message:"Perfect scale! ðŸŽµâœ¨",collected:!0,resetCollected:!1}:{isCorrect:!0,message:`Good! Note ${s+1}/${e.length}`,collected:!0,resetCollected:!1}}function Q(l,e,a){return e.includes(l.noteNumber)?(o(r,new Set([...t(r),l.noteNumber]),!0),t(r).size===e.length?{isCorrect:!0,message:"Perfect scale! ðŸŽµ",collected:t(r).has(l.noteNumber),resetCollected:!1}:{isCorrect:!0,message:`Good! ${t(r).size}/${e.length} notes`,collected:t(r).has(l.noteNumber),resetCollected:!1}):(o(r,new Set,!0),{isCorrect:!1,message:"Wrong note!",resetCollected:!0,collected:!1})}function U(l,e){if(t(v))return t(c).length===e.length&&t(c).every((a,s)=>a===e[s]);{const a=[...new Set(e)];return t(r).size===a.length}}function X(l){const e=l.target;o(v,e.checked,!0),o(r,new Set,!0),o(c,[],!0)}function Y(l){const e=l.target;o(d,e.checked,!0),o(r,new Set,!0),o(c,[],!0)}function Z(l){const e=l.target;o(u,e.value,!0),o(r,new Set,!0),o(c,[],!0)}{const l=(s,h=le)=>{var i=ve(),$=m(i);{var ee=b=>{var I=fe(),C=re(I),P=m(C),y=m(P);G(y),y.__change=X,B(),f(P),f(C);var w=M(C,2),j=m(w),x=m(j);G(x),x.__change=Y,B(),f(j),f(w);var A=M(w,2),g=M(m(A),2);g.__change=Z;var E=m(g);E.value=E.__value="Maj";var H=M(E);H.value=H.__value="Min",f(g);var R;ce(g),f(A),ae(()=>{R!==(R=t(u))&&(g.value=(g.__value=t(u))??"",ie(g,t(u)))}),K(y,()=>t(v),k=>o(v,k)),K(x,()=>t(d),k=>o(d,k)),z(b,I)};se($,b=>{n.randomMode||b(ee)})}f(i),z(s,i)};let e=L(()=>n.onComplete??(()=>{})),a=L(()=>n.rootKey||"C");ge(N,{get randomMode(){return n.randomMode},generateExpectedNotes:q,generateScoreProps:F,validateNoteEvent:J,isCompleted:U,onReset:D,get onComplete(){return t(e)},get initialNote(){return t(a)},description:S,exerciseType:"scale",children:l,$$slots:{default:!0}})}oe()}ne(["change"]);export{ye as component};
