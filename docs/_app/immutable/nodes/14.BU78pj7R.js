import{f as Z,a as D}from"../chunks/CFIxE8eA.js";import{p as ue,U as N,V as y,g as de,k as e,X as h,Z as r,W as fe,a as ge,c as p,r as _,f as ve,_ as me,s as M,t as he}from"../chunks/jpeKWS-T.js";import{d as pe}from"../chunks/CMZx5vTi.js";import{i as _e}from"../chunks/etsv1dl2.js";import{r as Me,i as F,s as O}from"../chunks/CqnklocC.js";import{b as be}from"../chunks/BPsD12mz.js";import{S as Se,N as U,M as w,d as X}from"../chunks/CXrKfc7O.js";import{B as Ce}from"../chunks/anoD3tQK.js";import{p as P}from"../chunks/N1SuJ8hO.js";function j(C,a,b){let f="right";typeof b=="boolean"?f=b?"right":"left":f=b;const S=Se[a],d=[];if(f==="left"||f==="both"){const o=U[C+"2"];d.push(...S.map(i=>o+i))}if(f==="right"||f==="both"){const o=U[C+"3"];d.push(...S.map(i=>o+i))}return f==="both"&&d.sort((o,i)=>o-i),d}var Ne=Z('<div class="control-group svelte-1l89l8c"><label class="svelte-1l89l8c"><input type="checkbox" class="svelte-1l89l8c"/> In order</label></div> <div class="control-group svelte-1l89l8c"><label for="handMode" class="svelte-1l89l8c">Hand:</label> <select id="handMode" class="svelte-1l89l8c"><option class="svelte-1l89l8c">Right Hand</option><option class="svelte-1l89l8c">Left Hand</option><option class="svelte-1l89l8c">Both Hands</option></select></div> <div class="control-group svelte-1l89l8c"><label for="scaleMode" class="svelte-1l89l8c">Scale mode:</label> <select id="scaleMode" class="svelte-1l89l8c"><option class="svelte-1l89l8c">Major</option><option class="svelte-1l89l8c">Minor</option></select></div>',1),ye=Z('<div class="scale-controls svelte-1l89l8c"><!></div>');function Te(C,a){ue(a,!0);const b="Play the scale shown, ascending and/or descending, using your MIDI keyboard. Try to follow the correct order.",f=h(()=>P.url.searchParams.get("root")),S=h(()=>P.url.searchParams.get("hand"));let d=N(y(a.sequentialMode??(a.randomMode?Math.random()>.5:!0))),o=N(y(a.handMode??(a.randomMode?Math.random()>.5?"right":"left":"right")));de(()=>{e(S)&&r(o,e(S),!0)});let i=h(()=>P.url.searchParams.get("mode")??a.scaleMode??(a.randomMode?X[Math.floor(Math.random()*X.length)]:"Maj")),A=h(()=>e(f)??a.rootKey??"C"),s=N(y(new Set)),c=N(y([]));function J(){r(s,new Set,!0),r(c,[],!0)}function Q(l){const t=j(l,e(i),e(o));return console.debug(`Scale for ${l} (${e(o)}):`,t.map(n=>w[n])),t}function Y(l){let t=[],n=[];return(e(o)==="left"||e(o)==="both")&&(t=j(l,e(i),"left").map(u=>[w[u]])),(e(o)==="right"||e(o)==="both")&&(n=j(l,e(i),"right").map(u=>[w[u]])),{selectedNote:l,leftHand:t,rightHand:n}}function $(l,t,n,g){return e(d)?ee(t,n):te(t,n)}function ee(l,t,n){const g=e(c).length,u=t[g];if(l.noteNumber===u)r(c,[...e(c),l.noteNumber],!0),r(s,new Set([...e(s),l.noteNumber]),!0);else{const H=w[u]?.slice(0,-1)??String(u);return r(c,[],!0),r(s,new Set,!0),{isCorrect:!1,message:`Wrong note! Expected ${H} (note ${g+1})`,collected:!1,resetCollected:!0}}return e(c).length===t.length?{isCorrect:!0,message:"Perfect scale! ðŸŽµâœ¨",collected:!0,resetCollected:!1}:{isCorrect:!0,message:`Good! Note ${g+1}/${t.length}`,collected:!0,resetCollected:!1}}function te(l,t,n){return t.includes(l.noteNumber)?(r(s,new Set([...e(s),l.noteNumber]),!0),e(s).size===t.length?{isCorrect:!0,message:"Perfect scale! ðŸŽµ",collected:e(s).has(l.noteNumber),resetCollected:!1}:{isCorrect:!0,message:`Good! ${e(s).size}/${t.length} notes`,collected:e(s).has(l.noteNumber),resetCollected:!1}):(r(s,new Set,!0),{isCorrect:!1,message:"Wrong note!",resetCollected:!0,collected:!1})}function le(l,t){if(e(d))return e(c).length===t.length&&e(c).every((n,g)=>n===t[g]);{const n=[...new Set(t)];return e(s).size===n.length}}function re(l){const t=l.target;r(d,t.checked,!0),r(s,new Set,!0),r(c,[],!0)}function oe(l){const t=l.target;r(o,t.value,!0),r(s,new Set,!0),r(c,[],!0)}function ae(l){const t=l.target;r(i,t.value),r(s,new Set,!0),r(c,[],!0)}let se=h(()=>`${e(A)} ${e(i)==="Maj"?"Major":"Minor"} Scale`),ne=h(()=>a.prompt??e(se));{const l=(n,g=fe)=>{var u=ye(),H=p(u);{var ie=E=>{var z=Ne(),x=ve(z),B=p(x),k=p(B);Me(k),k.__change=re,me(),_(B),_(x);var q=M(x,2),v=M(p(q),2);v.__change=oe;var I=p(v);I.value=I.__value="right";var R=M(I);R.value=R.__value="left";var L=M(R);L.value=L.__value="both",_(v);var W;F(v),_(q);var G=M(q,2),m=M(p(G),2);m.__change=ae;var T=p(m);T.value=T.__value="Maj";var K=M(T);K.value=K.__value="Min",_(m);var V;F(m),_(G),he(()=>{W!==(W=e(o))&&(v.value=(v.__value=e(o))??"",O(v,e(o))),V!==(V=e(i))&&(m.value=(m.__value=e(i))??"",O(m,e(i)))}),be(k,()=>e(d),ce=>r(d,ce)),D(E,z)};_e(H,E=>{!a.randomMode&&!P.url.searchParams.get("unitId")&&E(ie)})}_(u),D(n,u)};let t=h(()=>a.onComplete??(()=>{}));Ce(C,{get randomMode(){return a.randomMode},generateExpectedNotes:Q,generateScoreProps:Y,validateNoteEvent:$,isCompleted:le,onReset:J,get onComplete(){return e(t)},get initialNote(){return e(A)},description:b,exerciseType:"scale",get progressiveHints(){return a.progressiveHints},get prompt(){return e(ne)},children:l,$$slots:{default:!0}})}ge()}pe(["change"]);export{Te as component};
