import{z as ee,b as Ne,aR as ve,F as G,i as E,A as Ie,I as $e,v as te,a6 as Le,J as Oe,K as xe,L as oe,D as R,G as q,C as Re,aM as Fe,ax as ce,d as H,R as z,T as ze,aQ as Ke,a1 as fe,aK as ge,aS as me,aT as ye,aU as _e,O as Se,Q as qe,aV as je,aW as Q,ar as re,aX as He,B as Je,aY as Be,aZ as Ve,aJ as We,P as J,a_ as be,e as W,ai as Ye,a$ as Ge,b0 as Qe,l as Xe,j as Ze,b1 as Ue,b2 as et,b3 as tt,b4 as st,b5 as rt,b6 as at,b7 as it,b8 as nt,b9 as ot,a0 as ct,E as ft,ba as lt,an as ut,bb as dt,aE as Ae,ab as pt,W as L,u as ht,bc as vt,bd as gt}from"./ipsVM-65.js";import{b as mt,c as yt,d as _t,n as St,e as bt,f as At}from"./Brx6x_Mu.js";function Ht(t,e){return e}function wt(t,e,s){for(var r=[],a=e.length,i=0;i<a;i++)Be(e[i].e,r,!0);Ve(r,()=>{var n=r.length===0&&s!==null;if(n){var c=s,o=c.parentNode;We(o),o.append(c),t.items.clear(),N(t,e[0].prev,e[a-1].next)}for(var u=0;u<a;u++){var l=e[u];n||(t.items.delete(l.k),N(t,l.prev,l.next)),J(l.e,!n)}t.first===e[0]&&(t.first=e[0].prev)})}function Jt(t,e,s,r,a,i=null){var n=t,c=new Map,o=null,u=(e&ve)!==0,l=(e&ye)!==0,g=(e&_e)!==0;if(u){var f=t;n=E?G(Ie(f)):f.appendChild(ee())}E&&$e();var h=null,_=Le(()=>{var m=s();return me(m)?m:m==null?[]:ge(m)}),v,d=!0;function p(){Tt(C,v,n,e,r),h!==null&&(v.length===0?(h.fragment?(n.before(h.fragment),h.fragment=null):Se(h.effect),w.first=h.effect):qe(h.effect,()=>{h=null}))}var w=Ne(()=>{v=te(_);var m=v.length;let P=!1;if(E){var y=Oe(n)===xe;y!==(m===0)&&(n=oe(),G(n),R(!1),P=!0)}for(var S=new Set,A=H,T=null,M=ze(),k=0;k<m;k+=1){E&&q.nodeType===Re&&q.data===Fe&&(n=q,P=!0,R(!1));var $=v[k],K=r($,k),D=d?null:c.get(K);D?(l&&ce(D.v,$),g?ce(D.i,k):D.i=k,M&&A.skipped_effects.delete(D.e)):(D=Mt(d?n:null,T,$,K,k,a,e,s),d&&(D.o=!0,T===null?o=D:T.next=D,T=D),c.set(K,D)),S.add(K)}if(m===0&&i&&!h)if(d)h={fragment:null,effect:z(()=>i(n))};else{var ie=document.createDocumentFragment(),ne=ee();ie.append(ne),h={fragment:ie,effect:z(()=>i(ne))}}if(E&&m>0&&G(oe()),!d)if(M){for(const[Pe,De]of c)S.has(Pe)||A.skipped_effects.add(De.e);A.oncommit(p),A.ondiscard(()=>{})}else p();P&&R(!0),te(_)}),C={effect:w,items:c,first:o};d=!1,E&&(n=q)}function Tt(t,e,s,r,a){var i=(r&He)!==0,n=e.length,c=t.items,o=t.first,u,l=null,g,f=[],h=[],_,v,d,p;if(i)for(p=0;p<n;p+=1)_=e[p],v=a(_,p),d=c.get(v),d.o&&(d.a?.measure(),(g??=new Set).add(d));for(p=0;p<n;p+=1){if(_=e[p],v=a(_,p),d=c.get(v),t.first??=d,!d.o){d.o=!0;var w=l?l.next:o;N(t,l,d),N(t,d,w),X(d,w,s),l=d,f=[],h=[],o=l.next;continue}if((d.e.f&Q)!==0&&(Se(d.e),i&&(d.a?.unfix(),(g??=new Set).delete(d))),d!==o){if(u!==void 0&&u.has(d)){if(f.length<h.length){var C=h[0],m;l=C.prev;var P=f[0],y=f[f.length-1];for(m=0;m<f.length;m+=1)X(f[m],C,s);for(m=0;m<h.length;m+=1)u.delete(h[m]);N(t,P.prev,y.next),N(t,l,P),N(t,y,C),o=C,l=y,p-=1,f=[],h=[]}else u.delete(d),X(d,o,s),N(t,d.prev,d.next),N(t,d,l===null?t.first:l.next),N(t,l,d),l=d;continue}for(f=[],h=[];o!==null&&o.k!==v;)(o.e.f&Q)===0&&(u??=new Set).add(o),h.push(o),o=o.next;if(o===null)continue;d=o}f.push(d),l=d,o=d.next}let S=c.size>n;if(o!==null||u!==void 0){for(var A=u===void 0?[]:ge(u);o!==null;)(o.e.f&Q)===0&&A.push(o),o=o.next;var T=A.length;if(S=c.size-T>n,T>0){var M=(r&ve)!==0&&n===0?s:null;if(i){for(p=0;p<T;p+=1)A[p].a?.measure();for(p=0;p<T;p+=1)A[p].a?.fix()}wt(t,A,M)}}if(S)for(const k of c.values())k.o||(N(t,l,k),l=k);t.effect.last=l&&l.e,i&&re(()=>{if(g!==void 0)for(d of g)d.a?.apply()})}function Mt(t,e,s,r,a,i,n,c){var o=(n&ye)!==0,u=(n&je)===0,l=o?u?Ke(s,!1,!1):fe(s):s,g=(n&_e)===0?a:fe(a),f={i:g,v:l,k:r,a:null,e:null,o:!1,prev:e,next:null};try{if(t===null){var h=document.createDocumentFragment();h.append(t=ee())}return f.e=z(()=>i(t,l,g,c)),e!==null&&(e.next=f),f}finally{}}function X(t,e,s){for(var r=t.next?t.next.e.nodes_start:s,a=e?e.e.nodes_start:s,i=t.e.nodes_start;i!==null&&i!==r;){var n=Je(i);a.before(i),i=n}}function N(t,e,s){e===null?(t.first=s,t.effect.first=s&&s.e):(e.e.next&&(e.e.next.prev=null),e.next=s,e.e.next=s&&s.e),s!==null&&(s.e.prev&&(s.e.prev.next=null),s.prev=e,s.e.prev=e&&e.e)}function Ct(t,e){var s=void 0,r;be(()=>{s!==(s=e())&&(r&&(J(r),r=null),s&&(r=z(()=>{W(()=>s(t))})))})}function we(t){var e,s,r="";if(typeof t=="string"||typeof t=="number")r+=t;else if(typeof t=="object")if(Array.isArray(t)){var a=t.length;for(e=0;e<a;e++)t[e]&&(s=we(t[e]))&&(r&&(r+=" "),r+=s)}else for(s in t)t[s]&&(r&&(r+=" "),r+=s);return r}function Et(){for(var t,e,s=0,r="",a=arguments.length;s<a;s++)(t=arguments[s])&&(e=we(t))&&(r&&(r+=" "),r+=e);return r}function kt(t){return typeof t=="object"?Et(t):t??""}const le=[...` 	
\r\fÂ \v\uFEFF`];function Pt(t,e,s){var r=t==null?"":""+t;if(e&&(r=r?r+" "+e:e),s){for(var a in s)if(s[a])r=r?r+" "+a:a;else if(r.length)for(var i=a.length,n=0;(n=r.indexOf(a,n))>=0;){var c=n+i;(n===0||le.includes(r[n-1]))&&(c===r.length||le.includes(r[c]))?r=(n===0?"":r.substring(0,n))+r.substring(c+1):n=c}}return r===""?null:r}function ue(t,e=!1){var s=e?" !important;":";",r="";for(var a in t){var i=t[a];i!=null&&i!==""&&(r+=" "+a+": "+i+s)}return r}function Z(t){return t[0]!=="-"||t[1]!=="-"?t.toLowerCase():t}function Dt(t,e){if(e){var s="",r,a;if(Array.isArray(e)?(r=e[0],a=e[1]):r=e,t){t=String(t).replaceAll(/\s*\/\*.*?\*\/\s*/g,"").trim();var i=!1,n=0,c=!1,o=[];r&&o.push(...Object.keys(r).map(Z)),a&&o.push(...Object.keys(a).map(Z));var u=0,l=-1;const v=t.length;for(var g=0;g<v;g++){var f=t[g];if(c?f==="/"&&t[g-1]==="*"&&(c=!1):i?i===f&&(i=!1):f==="/"&&t[g+1]==="*"?c=!0:f==='"'||f==="'"?i=f:f==="("?n++:f===")"&&n--,!c&&i===!1&&n===0){if(f===":"&&l===-1)l=g;else if(f===";"||g===v-1){if(l!==-1){var h=Z(t.substring(u,l).trim());if(!o.includes(h)){f!==";"&&g++;var _=t.substring(u,g).trim();s+=" "+_+";"}}u=g+1,l=-1}}}}return r&&(s+=ue(r)),a&&(s+=ue(a,!0)),s=s.trim(),s===""?null:s}return t==null?null:String(t)}function Nt(t,e,s,r,a,i){var n=t.__className;if(E||n!==s||n===void 0){var c=Pt(s,r,i);(!E||c!==t.getAttribute("class"))&&(c==null?t.removeAttribute("class"):e?t.className=c:t.setAttribute("class",c)),t.__className=s}else if(i&&a!==i)for(var o in i){var u=!!i[o];(a==null||u!==!!a[o])&&t.classList.toggle(o,u)}return i}function U(t,e={},s,r){for(var a in s){var i=s[a];e[a]!==i&&(s[a]==null?t.style.removeProperty(a):t.style.setProperty(a,i,r))}}function It(t,e,s,r){var a=t.__style;if(E||a!==e){var i=Dt(e,r);(!E||i!==t.getAttribute("style"))&&(i==null?t.removeAttribute("style"):t.style.cssText=i),t.__style=e}else r&&(Array.isArray(r)?(U(t,s?.[0],r[0]),U(t,s?.[1],r[1],"important")):U(t,s,r));return r}function B(t,e,s=!1){if(t.multiple){if(e==null)return;if(!me(e))return Ge();for(var r of t.options)r.selected=e.includes(F(r));return}for(r of t.options){var a=F(r);if(Qe(a,e)){r.selected=!0;return}}(!s||e!==void 0)&&(t.selectedIndex=-1)}function Te(t){var e=new MutationObserver(()=>{B(t,t.__value)});e.observe(t,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),Ye(()=>{e.disconnect()})}function Bt(t,e,s=e){var r=new WeakSet,a=!0;Xe(t,"change",i=>{var n=i?"[selected]":":checked",c;if(t.multiple)c=[].map.call(t.querySelectorAll(n),F);else{var o=t.querySelector(n)??t.querySelector("option:not([disabled])");c=o&&F(o)}s(c),H!==null&&r.add(H)}),W(()=>{var i=e();if(t===document.activeElement){var n=Ze??H;if(r.has(n))return}if(B(t,i,a),a&&i===void 0){var c=t.querySelector(":checked");c!==null&&(i=F(c),s(i))}t.__value=i,a=!1}),Te(t)}function F(t){return"__value"in t?t.__value:t.value}const O=Symbol("class"),x=Symbol("style"),Me=Symbol("is custom element"),Ce=Symbol("is html");function $t(t){if(E){var e=!1,s=()=>{if(!e){if(e=!0,t.hasAttribute("value")){var r=t.value;V(t,"value",null),t.value=r}if(t.hasAttribute("checked")){var a=t.checked;V(t,"checked",null),t.checked=a}}};t.__on_r=s,re(s),rt()}}function Vt(t,e){var s=Y(t);s.value===(s.value=e??void 0)||t.value===e&&(e!==0||t.nodeName!=="PROGRESS")||(t.value=e??"")}function Wt(t,e){var s=Y(t);s.checked!==(s.checked=e??void 0)&&(t.checked=e)}function Lt(t,e){e?t.hasAttribute("selected")||t.setAttribute("selected",""):t.removeAttribute("selected")}function V(t,e,s,r){var a=Y(t);E&&(a[e]=t.getAttribute(e),e==="src"||e==="srcset"||e==="href"&&t.nodeName==="LINK")||a[e]!==(a[e]=s)&&(e==="loading"&&(t[nt]=s),s==null?t.removeAttribute(e):typeof s!="string"&&Ee(t).includes(e)?t[e]=s:t.setAttribute(e,s))}function Ot(t,e,s,r,a=!1,i=!1){if(E&&a&&t.tagName==="INPUT"){var n=t,c=n.type==="checkbox"?"defaultChecked":"defaultValue";c in s||$t(n)}var o=Y(t),u=o[Me],l=!o[Ce];let g=E&&u;g&&R(!1);var f=e||{},h=t.tagName==="OPTION";for(var _ in e)_ in s||(s[_]=null);s.class?s.class=kt(s.class):(r||s[O])&&(s.class=null),s[x]&&(s.style??=null);var v=Ee(t);for(const y in s){let S=s[y];if(h&&y==="value"&&S==null){t.value=t.__value="",f[y]=S;continue}if(y==="class"){var d=t.namespaceURI==="http://www.w3.org/1999/xhtml";Nt(t,d,S,r,e?.[O],s[O]),f[y]=S,f[O]=s[O];continue}if(y==="style"){It(t,S,e?.[x],s[x]),f[y]=S,f[x]=s[x];continue}var p=f[y];if(!(S===p&&!(S===void 0&&t.hasAttribute(y)))){f[y]=S;var w=y[0]+y[1];if(w!=="$$")if(w==="on"){const A={},T="$$"+y;let M=y.slice(2);var C=bt(M);if(mt(M)&&(M=M.slice(0,-7),A.capture=!0),!C&&p){if(S!=null)continue;t.removeEventListener(M,f[T],A),f[T]=null}if(S!=null)if(C)t[`__${M}`]=S,_t([M]);else{let k=function($){f[y].call(this,$)};f[T]=yt(M,t,k,A)}else C&&(t[`__${M}`]=void 0)}else if(y==="style")V(t,y,S);else if(y==="autofocus")tt(t,!!S);else if(!u&&(y==="__value"||y==="value"&&S!=null))t.value=t.__value=S;else if(y==="selected"&&h)Lt(t,S);else{var m=y;l||(m=St(m));var P=m==="defaultValue"||m==="defaultChecked";if(S==null&&!u&&!P)if(o[y]=null,m==="value"||m==="checked"){let A=t;const T=e===void 0;if(m==="value"){let M=A.defaultValue;A.removeAttribute(m),A.defaultValue=M,A.value=A.__value=T?M:null}else{let M=A.defaultChecked;A.removeAttribute(m),A.defaultChecked=M,A.checked=T?M:!1}}else t.removeAttribute(y);else P||v.includes(m)&&(u||typeof S!="string")?(t[m]=S,m in o&&(o[m]=st)):typeof S!="function"&&V(t,m,S)}}}return g&&R(!0),f}function Yt(t,e,s=[],r=[],a=[],i,n=!1,c=!1){Ue(a,s,r,o=>{var u=void 0,l={},g=t.nodeName==="SELECT",f=!1;if(be(()=>{var _=e(...o.map(te)),v=Ot(t,u,_,i,n,c);f&&g&&"value"in _&&B(t,_.value);for(let p of Object.getOwnPropertySymbols(l))_[p]||J(l[p]);for(let p of Object.getOwnPropertySymbols(_)){var d=_[p];p.description===et&&(!u||d!==u[p])&&(l[p]&&J(l[p]),l[p]=z(()=>Ct(t,()=>d))),v[p]=d}u=v}),g){var h=t;W(()=>{B(h,u.value,!0),Te(h)})}f=!0})}function Y(t){return t.__attributes??={[Me]:t.nodeName.includes("-"),[Ce]:t.namespaceURI===at}}var de=new Map;function Ee(t){var e=t.getAttribute("is")||t.nodeName,s=de.get(e);if(s)return s;de.set(e,s=[]);for(var r,a=t,i=Element.prototype;i!==a;){r=ot(a);for(var n in r)r[n].set&&s.push(n);a=it(a)}return s}const xt=()=>performance.now(),I={tick:t=>requestAnimationFrame(t),now:()=>xt(),tasks:new Set};function ke(){const t=I.now();I.tasks.forEach(e=>{e.c(t)||(I.tasks.delete(e),e.f())}),I.tasks.size!==0&&I.tick(ke)}function Rt(t){let e;return I.tasks.size===0&&I.tick(ke),{promise:new Promise(s=>{I.tasks.add(e={c:t,f:s})}),abort(){I.tasks.delete(e)}}}function j(t,e){Ae(()=>{t.dispatchEvent(new CustomEvent(e))})}function Ft(t){if(t==="float")return"cssFloat";if(t==="offset")return"cssOffset";if(t.startsWith("--"))return t;const e=t.split("-");return e.length===1?e[0]:e[0]+e.slice(1).map(s=>s[0].toUpperCase()+s.slice(1)).join("")}function pe(t){const e={},s=t.split(";");for(const r of s){const[a,i]=r.split(":");if(!a||i===void 0)break;const n=Ft(a.trim());e[n]=i.trim()}return e}const zt=t=>t;function Gt(t,e,s,r){var a=(t&vt)!==0,i=(t&gt)!==0,n=a&&i,c=(t&dt)!==0,o=n?"both":a?"in":"out",u,l=e.inert,g=e.style.overflow,f,h;function _(){return Ae(()=>u??=s()(e,r?.()??{},{direction:o}))}var v={is_global:c,in(){if(e.inert=l,!a){h?.abort(),h?.reset?.();return}i||f?.abort(),j(e,"introstart"),f=se(e,_(),h,1,()=>{j(e,"introend"),f?.abort(),f=u=void 0,e.style.overflow=g})},out(C){if(!i){C?.(),u=void 0;return}e.inert=!0,j(e,"outrostart"),h=se(e,_(),f,0,()=>{j(e,"outroend"),C?.()})},stop:()=>{f?.abort(),h?.abort()}},d=ct;if((d.transitions??=[]).push(v),a&&At){var p=c;if(!p){for(var w=d.parent;w&&(w.f&ft)!==0;)for(;(w=w.parent)&&(w.f&lt)===0;);p=!w||(w.f&ut)!==0}p&&W(()=>{ht(()=>v.in())})}}function se(t,e,s,r,a){var i=r===1;if(pt(e)){var n,c=!1;return re(()=>{if(!c){var d=e({direction:i?"in":"out"});n=se(t,d,s,r,a)}}),{abort:()=>{c=!0,n?.abort()},deactivate:()=>n.deactivate(),reset:()=>n.reset(),t:()=>n.t()}}if(s?.deactivate(),!e?.duration)return a(),{abort:L,deactivate:L,reset:L,t:()=>r};const{delay:o=0,css:u,tick:l,easing:g=zt}=e;var f=[];if(i&&s===void 0&&(l&&l(0,1),u)){var h=pe(u(0,1));f.push(h,h)}var _=()=>1-r,v=t.animate(f,{duration:o,fill:"forwards"});return v.onfinish=()=>{v.cancel();var d=s?.t()??1-r;s?.abort();var p=r-d,w=e.duration*Math.abs(p),C=[];if(w>0){var m=!1;if(u)for(var P=Math.ceil(w/16.666666666666668),y=0;y<=P;y+=1){var S=d+p*g(y/P),A=pe(u(S,1-S));C.push(A),m||=A.overflow==="hidden"}m&&(t.style.overflow="hidden"),_=()=>{var T=v.currentTime;return d+p*g(T/w)},l&&Rt(()=>{if(v.playState!=="running")return!1;var T=_();return l(T,1-T),!0})}v=t.animate(C,{duration:w,fill:"forwards"}),v.onfinish=()=>{_=()=>r,l?.(r,1-r),a()}},{abort:()=>{v&&(v.cancel(),v.effect=null,v.onfinish=L)},deactivate:()=>{a=L},reset:()=>{r===0&&l?.(1,0)},t:()=>_()}}class b{static instance;static hasLocalStorage(){try{if(typeof globalThis>"u")return!1;const e=globalThis.localStorage;return!!e&&typeof e.getItem=="function"&&typeof e.setItem=="function"&&typeof e.removeItem=="function"}catch{return!1}}static _memoryStorage=null;static _storageResolved=!1;static _usingRealLocalStorage=!1;static getStorage(){try{const e=globalThis.localStorage;if(e&&typeof e.getItem=="function"&&typeof e.setItem=="function"&&typeof e.removeItem=="function")return b._storageResolved||(b._usingRealLocalStorage=!0,b._storageResolved=!0,console.info("UserStatsService: using real localStorage")),e;!b._storageResolved&&e&&(b._usingRealLocalStorage=!1,b._storageResolved=!0,console.warn("UserStatsService: localStorage object detected but missing expected methods â€” using in-memory fallback"))}catch{b._storageResolved||(b._usingRealLocalStorage=!1,b._storageResolved=!0,console.info("UserStatsService: accessing localStorage threw an error â€” using in-memory fallback"))}return b._memoryStorage||(b._memoryStorage=new Map),b._storageResolved||(b._usingRealLocalStorage=!1,b._storageResolved=!0,typeof window<"u"&&console.info("UserStatsService: no localStorage available â€” using in-memory fallback")),{getItem(e){return b._memoryStorage.has(e)?b._memoryStorage.get(e):null},setItem(e,s){b._memoryStorage.set(e,s)},removeItem(e){b._memoryStorage.delete(e)}}}storageKey="jazz-midi-user-stats";profileKey="jazz-midi-user-profile";listeners=[];profile;statistics;constructor(){this.profile=this.loadProfile(),this.statistics=this.loadStatistics()}static getInstance(){return b.instance||(b.instance=new b),b.instance}getProfile(){return{...this.profile}}updateProfile(e){this.profile={...this.profile,...e,lastActivity:new Date},this.saveProfile()}getStatistics(){return{...this.statistics}}recordExerciseResult(e){this.updateOverallStats(e),this.updateTypeStats(e),this.updateMastery(e),this.updateStreak(e),this.updateDailyPractice(e),this.checkAchievements(),this.profile.lastActivity=new Date,this.profile.experiencePoints+=this.calculateExperiencePoints(e),this.profile.level=this.calculateLevel(this.profile.experiencePoints),this.saveStatistics(),this.saveProfile(),this.notifyListeners()}getChordMastery(e,s){return this.statistics.masteredChords.find(r=>r.root===e&&r.chordType===s)||null}getScaleMastery(e,s){return this.statistics.masteredScales.find(r=>r.root===e&&r.scaleType===s)||null}getProgressionMastery(e,s){return this.statistics.masteredProgressions.find(r=>r.key===e&&r.progressionType===s)||null}getAchievements(){return this.getDefaultAchievements().map(e=>{const s=this.calculateAchievementProgress(e);return{...e,progress:s,unlockedAt:s>=100?this.profile.lastActivity:void 0}})}startSession(){b.getStorage().setItem("jazz-midi-session-start",Date.now().toString())}endSession(){const e=b.getStorage(),s=e.getItem("jazz-midi-session-start");if(s){const r=(Date.now()-parseInt(s))/6e4;this.recordSession(r),e.removeItem("jazz-midi-session-start")}}exportData(){return JSON.stringify({profile:this.profile,statistics:this.statistics,exportDate:new Date,version:"1.0"},null,2)}importData(e){try{const s=JSON.parse(e);if(s.profile&&s.statistics)return this.profile={...this.profile,...s.profile},this.statistics={...this.statistics,...s.statistics},this.saveProfile(),this.saveStatistics(),this.notifyListeners(),!0}catch(s){console.error("Failed to import user data:",s)}return!1}subscribe(e){return this.listeners.push(e),()=>{const s=this.listeners.indexOf(e);s>-1&&this.listeners.splice(s,1)}}loadProfile(){try{const s=b.getStorage().getItem(this.profileKey);if(s){const r=JSON.parse(s);return{...r,createdAt:new Date(r.createdAt),lastActivity:new Date(r.lastActivity)}}}catch(e){console.warn("Failed to load user profile:",e)}return this.createDefaultProfile()}loadStatistics(){try{const s=b.getStorage().getItem(this.storageKey);if(s){const r=JSON.parse(s);return{...r,masteredChords:r.masteredChords?.map(a=>({...a,lastPracticed:new Date(a.lastPracticed)}))||[],masteredScales:r.masteredScales?.map(a=>({...a,lastPracticed:new Date(a.lastPracticed)}))||[],masteredProgressions:r.masteredProgressions?.map(a=>({...a,lastPracticed:new Date(a.lastPracticed)}))||[],recentSessions:r.recentSessions?.map(a=>({...a,date:new Date(a.date)}))||[]}}}catch(e){console.warn("Failed to load user statistics:",e)}return this.createDefaultStatistics()}createDefaultProfile(){return{id:crypto.randomUUID(),name:"Jazz Student",createdAt:new Date,lastActivity:new Date,totalPracticeTime:0,level:1,experiencePoints:0}}createDefaultStatistics(){return{totalExercises:0,completedExercises:0,averageAccuracy:0,averageScore:0,totalPracticeTime:0,currentStreak:0,longestStreak:0,noteProgress:new Map,missedNotes:new Map,missedChords:new Map,practiceCalendar:new Map,chordStats:this.createDefaultTypeStats(),scaleStats:this.createDefaultTypeStats(),progressionStats:this.createDefaultTypeStats(),partitionStats:this.createDefaultTypeStats(),rhythmStats:this.createDefaultTypeStats(),masteredChords:[],masteredScales:[],masteredProgressions:[],recentSessions:[],improvementTrend:0}}createDefaultTypeStats(){return{attempted:0,completed:0,averageAccuracy:0,averageScore:0,bestScore:0,totalTime:0,masteryLevel:"beginner"}}updateOverallStats(e){this.statistics.totalExercises++,e.success&&this.statistics.completedExercises++;const s=this.statistics.totalExercises;this.statistics.averageAccuracy=(this.statistics.averageAccuracy*(s-1)+e.accuracy)/s,this.statistics.averageScore=(this.statistics.averageScore*(s-1)+e.score)/s,this.statistics.totalPracticeTime+=e.timeElapsed/(1e3*60)}updateTypeStats(e){const s=this.getTypeStats(e.exerciseType);s.attempted++,e.success&&s.completed++;const r=s.attempted;s.averageAccuracy=(s.averageAccuracy*(r-1)+e.accuracy)/r,s.averageScore=(s.averageScore*(r-1)+e.score)/r,s.bestScore=Math.max(s.bestScore,e.score),s.totalTime+=e.timeElapsed/(1e3*60),s.masteryLevel=this.calculateMasteryLevel(s)}updateMastery(e){}updateStreak(e){e.success&&e.accuracy>=80?(this.statistics.currentStreak++,this.statistics.longestStreak=Math.max(this.statistics.longestStreak,this.statistics.currentStreak)):this.statistics.currentStreak=0}getTypeStats(e){switch(e){case"chord":return this.statistics.chordStats;case"scale":return this.statistics.scaleStats;case"progression":return this.statistics.progressionStats;case"partition":return this.statistics.partitionStats;case"rhythm":return this.statistics.rhythmStats;default:throw new Error(`Unknown exercise type: ${e}`)}}calculateMasteryLevel(e){return e.averageScore>=90&&e.attempted>=100?"expert":e.averageScore>=80&&e.attempted>=50?"advanced":e.averageScore>=70&&e.attempted>=20?"intermediate":"beginner"}calculateExperiencePoints(e){let s=e.score;return e.success&&(s+=10),e.accuracy>=100&&(s+=20),e.mistakes===0&&(s+=15),s}calculateLevel(e){return Math.floor(e/1e3)+1}recordSession(e){const s={date:new Date,duration:e,exercisesCompleted:0,averageScore:0,topCategory:"chords",improvements:[]};this.statistics.recentSessions.unshift(s),this.statistics.recentSessions.length>10&&this.statistics.recentSessions.pop()}getDefaultAchievements(){return[{id:"first-chord",name:"First Chord",description:"Complete your first chord exercise",icon:"ðŸŽµ",progress:0,requirements:[{type:"exercise_count",target:1,current:0}]},{id:"chord-master",name:"Chord Master",description:"Complete 100 chord exercises",icon:"ðŸŽ¼",progress:0,requirements:[{type:"exercise_count",target:100,current:0}]},{id:"perfect-accuracy",name:"Perfect Performance",description:"Achieve 100% accuracy in an exercise",icon:"â­",progress:0,requirements:[{type:"accuracy",target:100,current:0}]},{id:"practice-streak",name:"Practice Makes Perfect",description:"Maintain a 7-day practice streak",icon:"ðŸ”¥",progress:0,requirements:[{type:"streak",target:7,current:0}]}]}calculateAchievementProgress(e){switch(e.id){case"first-chord":return this.statistics.chordStats.completed>0?100:0;case"chord-master":return Math.min(100,this.statistics.chordStats.completed/100*100);case"perfect-accuracy":return this.statistics.averageAccuracy>=100?100:0;case"practice-streak":return Math.min(100,this.statistics.currentStreak/7*100);default:return 0}}checkAchievements(){}updateNoteProgress(e,s,r,a,i,n){const c=this.generateProgressKey(e,s,r);let o=this.statistics.noteProgress.get(c);o||(o={note:e,exerciseType:s,chordType:r,attempts:0,successes:0,averageAccuracy:0,bestTime:1/0,lastPracticed:new Date,masteryLevel:"beginner"}),o.attempts++,a&&o.successes++,o.averageAccuracy=(o.averageAccuracy*(o.attempts-1)+n)/o.attempts,i<o.bestTime&&(o.bestTime=i),o.lastPracticed=new Date;const u=o.successes/o.attempts;u>=.95&&o.averageAccuracy>=95?o.masteryLevel="mastered":u>=.8&&o.averageAccuracy>=80?o.masteryLevel="advanced":u>=.6&&o.averageAccuracy>=60?o.masteryLevel="intermediate":o.masteryLevel="beginner",this.statistics.noteProgress.set(c,o),this.saveStatistics()}getNoteProgress(e,s,r){const a=this.generateProgressKey(e,s,r);return this.statistics.noteProgress.get(a)}getProgressByType(e){return Array.from(this.statistics.noteProgress.values()).filter(s=>s.exerciseType===e)}generateProgressKey(e,s,r){return r?`${e}-${s}-${r}`:`${e}-${s}`}saveProfile(){try{b.getStorage().setItem(this.profileKey,JSON.stringify(this.profile))}catch(e){console.warn("Failed to save user profile:",e)}}saveStatistics(){try{b.getStorage().setItem(this.storageKey,JSON.stringify(this.statistics))}catch(e){console.warn("Failed to save user statistics:",e)}}notifyListeners(){this.listeners.forEach(e=>{try{e(this.statistics)}catch(s){console.error("Error in stats listener:",s)}})}trackMissedNote(e,s){const r=this.statistics.missedNotes.get(e);r?(r.count++,r.lastMissed=new Date):this.statistics.missedNotes.set(e,{count:1,lastMissed:new Date,exerciseType:s}),this.saveStatistics()}trackMissedChord(e,s){const r=this.statistics.missedChords.get(e);r?(r.count++,r.lastMissed=new Date):this.statistics.missedChords.set(e,{count:1,lastMissed:new Date,exerciseType:s}),this.saveStatistics()}getMostMissedNotes(e=12){return this.statistics.missedNotes instanceof Map||(this.statistics.missedNotes=new Map),Array.from(this.statistics.missedNotes.entries()).map(([s,r])=>({note:s,count:r.count,lastMissed:r.lastMissed})).sort((s,r)=>r.count-s.count).slice(0,e)}getMostMissedChords(e=5){return this.statistics.missedChords instanceof Map||(this.statistics.missedChords=new Map),Array.from(this.statistics.missedChords.entries()).map(([s,r])=>({chord:s,count:r.count,lastMissed:r.lastMissed,exerciseType:r.exerciseType})).sort((s,r)=>r.count-s.count).slice(0,e)}getWeaknessRecommendations(){const e=[],s=this.getMostMissedNotes(3),r=this.getMostMissedChords(3);return s.forEach(({note:a})=>{const i=a.replace(/[0-9]/g,"");e.push({weakness:`Note: ${a}`,recommendedExercise:`${i} Major Scale`,path:`/exercises/scales?root=${i}&mode=Maj`})}),r.forEach(({chord:a})=>{e.push({weakness:`Chord: ${a}`,recommendedExercise:`${a} Practice`,path:"/exercises/chords?root=C&quality=maj7"})}),e.slice(0,5)}updateDailyPractice(e){const r=new Date().toISOString().split("T")[0],a=this.statistics.practiceCalendar.get(r);a?(a.exercisesCompleted++,a.practiceTime+=e.timeElapsed/(1e3*60)):this.statistics.practiceCalendar.set(r,{date:r,exercisesCompleted:1,practiceTime:e.timeElapsed/(1e3*60)})}getPracticeCalendar(e=84){const s=[],r=new Date;this.statistics.practiceCalendar instanceof Map||(this.statistics.practiceCalendar=new Map);for(let a=e-1;a>=0;a--){const i=new Date(r);i.setDate(i.getDate()-a);const n=i.toISOString().split("T")[0],c=this.statistics.practiceCalendar.get(n);c?s.push(c):s.push({date:n,exercisesCompleted:0,practiceTime:0})}return s}getPracticeStreak(){const e=new Date;let s=0,r=0,a=0;const i=e.toISOString().split("T")[0];this.statistics.practiceCalendar.has(i);for(let n=0;n<365;n++){const c=new Date(e);c.setDate(c.getDate()-n);const o=c.toISOString().split("T")[0];if(this.statistics.practiceCalendar.has(o)){if(n===0||a>0)a++,s===0&&(s=a);else break;r=Math.max(r,a)}else{if(n===0)continue;a>0&&(r=Math.max(r,a),a=0)}}return{current:s,longest:Math.max(r,this.statistics.longestStreak)}}}const Qt=b.getInstance(),Kt=t=>t;function ae(t){const e=t-1;return e*e*e+1}function he(t){const e=typeof t=="string"&&t.match(/^\s*(-?[\d.]+)([^\s]*)\s*$/);return e?[parseFloat(e[1]),e[2]||"px"]:[t,"px"]}function Xt(t,{delay:e=0,duration:s=400,easing:r=Kt}={}){const a=+getComputedStyle(t).opacity;return{delay:e,duration:s,easing:r,css:i=>`opacity: ${i*a}`}}function Zt(t,{delay:e=0,duration:s=400,easing:r=ae,x:a=0,y:i=0,opacity:n=0}={}){const c=getComputedStyle(t),o=+c.opacity,u=c.transform==="none"?"":c.transform,l=o*(1-n),[g,f]=he(a),[h,_]=he(i);return{delay:e,duration:s,easing:r,css:(v,d)=>`
			transform: ${u} translate(${(1-v)*g}${f}, ${(1-v)*h}${_});
			opacity: ${o-l*d}`}}function Ut(t,{delay:e=0,duration:s=400,easing:r=ae,axis:a="y"}={}){const i=getComputedStyle(t),n=+i.opacity,c=a==="y"?"height":"width",o=parseFloat(i[c]),u=a==="y"?["top","bottom"]:["left","right"],l=u.map(p=>`${p[0].toUpperCase()}${p.slice(1)}`),g=parseFloat(i[`padding${l[0]}`]),f=parseFloat(i[`padding${l[1]}`]),h=parseFloat(i[`margin${l[0]}`]),_=parseFloat(i[`margin${l[1]}`]),v=parseFloat(i[`border${l[0]}Width`]),d=parseFloat(i[`border${l[1]}Width`]);return{delay:e,duration:s,easing:r,css:p=>`overflow: hidden;opacity: ${Math.min(p*20,1)*n};${c}: ${p*o}px;padding-${u[0]}: ${p*g}px;padding-${u[1]}: ${p*f}px;margin-${u[0]}: ${p*h}px;margin-${u[1]}: ${p*_}px;border-${u[0]}-width: ${p*v}px;border-${u[1]}-width: ${p*d}px;min-${c}: 0`}}function es(t,{delay:e=0,duration:s=400,easing:r=ae,start:a=0,opacity:i=0}={}){const n=getComputedStyle(t),c=+n.opacity,o=n.transform==="none"?"":n.transform,u=1-a,l=c*(1-i);return{delay:e,duration:s,easing:r,css:(g,f)=>`
			transform: ${o} scale(${1-u*f});
			opacity: ${c-l*f}
		`}}export{O as C,Te as a,Nt as b,V as c,Zt as d,Jt as e,Xt as f,Yt as g,It as h,Ht as i,Wt as j,Vt as k,kt as l,Ut as m,Bt as n,es as o,$t as r,B as s,Gt as t,Qt as u};
