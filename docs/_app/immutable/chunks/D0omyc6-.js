import{y as H,z as ae,aI as X,E as O,w,A as ie,ab as ce,j as _,V as ne,ad as oe,ae as le,af as B,D as z,F as C,C as fe,aJ as ue,aK as V,o as ge,a8 as $,aa as he,aL as de,W as Y,aM as G,al as pe,aN as Z,aO as U,a5 as ee,a7 as ve,aP as me,aQ as K,as as ye,aR as Se,B as Ae,aS as Pe,aT as De,aU as Te,a6 as be}from"./Dpgs3mFS.js";function Me(s,e){return e}function we(s,e,t){for(var r=[],i=e.length,n=0;n<i;n++)Pe(e[n].e,r,!0);De(r,()=>{var c=r.length===0&&t!==null;if(c){var l=t,a=l.parentNode;Te(a),a.append(l),s.items.clear(),P(s,e[0].prev,e[i-1].next)}for(var h=0;h<i;h++){var f=e[h];c||(s.items.delete(f.k),P(s,f.prev,f.next)),be(f.e,!c)}s.first===e[0]&&(s.first=e[0].prev)})}function Re(s,e,t,r,i,n=null){var c=s,l=new Map,a=null,h=(e&X)!==0,f=(e&Z)!==0,v=(e&U)!==0;if(h){var g=s;c=w?O(ie(g)):g.appendChild(H())}w&&ce();var d=null,T=ne(()=>{var m=t();return pe(m)?m:m==null?[]:G(m)}),y,o=!0;function p(){Ee(E,y,c,e,r),d!==null&&(y.length===0?(d.fragment?(c.before(d.fragment),d.fragment=null):ee(d.effect),x.first=d.effect):ve(d.effect,()=>{d=null}))}var x=ae(()=>{y=_(T);var m=y.length;let I=!1;if(w){var L=oe(c)===le;L!==(m===0)&&(c=B(),O(c),z(!1),I=!0)}for(var k=new Set,D=ge,b=null,M=he(),S=0;S<m;S+=1){w&&C.nodeType===fe&&C.data===ue&&(c=C,I=!0,z(!1));var N=y[S],R=r(N,S),A=o?null:l.get(R);A?(f&&V(A.v,N),v?V(A.i,S):A.i=S,M&&D.skipped_effects.delete(A.e)):(A=Ie(o?c:null,b,N,R,S,i,e,t),o&&(A.o=!0,b===null?a=A:b.next=A,b=A),l.set(R,A)),k.add(R)}if(m===0&&n&&!d)if(o)d={fragment:null,effect:$(()=>n(c))};else{var q=document.createDocumentFragment(),j=H();q.append(j),d={fragment:q,effect:$(()=>n(j))}}if(w&&m>0&&O(B()),!o)if(M){for(const[re,se]of l)k.has(re)||D.skipped_effects.add(se.e);D.oncommit(p),D.ondiscard(()=>{})}else p();I&&z(!0),_(T)}),E={effect:x,items:l,first:a};o=!1,w&&(c=C)}function Ee(s,e,t,r,i){var n=(r&Se)!==0,c=e.length,l=s.items,a=s.first,h,f=null,v,g=[],d=[],T,y,o,p;if(n)for(p=0;p<c;p+=1)T=e[p],y=i(T,p),o=l.get(y),o.o&&(o.a?.measure(),(v??=new Set).add(o));for(p=0;p<c;p+=1){if(T=e[p],y=i(T,p),o=l.get(y),s.first??=o,!o.o){o.o=!0;var x=f?f.next:a;P(s,f,o),P(s,o,x),F(o,x,t),f=o,g=[],d=[],a=f.next;continue}if((o.e.f&K)!==0&&(ee(o.e),n&&(o.a?.unfix(),(v??=new Set).delete(o))),o!==a){if(h!==void 0&&h.has(o)){if(g.length<d.length){var E=d[0],m;f=E.prev;var I=g[0],L=g[g.length-1];for(m=0;m<g.length;m+=1)F(g[m],E,t);for(m=0;m<d.length;m+=1)h.delete(d[m]);P(s,I.prev,L.next),P(s,f,I),P(s,L,E),a=E,f=L,p-=1,g=[],d=[]}else h.delete(o),F(o,a,t),P(s,o.prev,o.next),P(s,o,f===null?s.first:f.next),P(s,f,o),f=o;continue}for(g=[],d=[];a!==null&&a.k!==y;)(a.e.f&K)===0&&(h??=new Set).add(a),d.push(a),a=a.next;if(a===null)continue;o=a}g.push(o),f=o,a=o.next}let k=l.size>c;if(a!==null||h!==void 0){for(var D=h===void 0?[]:G(h);a!==null;)(a.e.f&K)===0&&D.push(a),a=a.next;var b=D.length;if(k=l.size-b>c,b>0){var M=(r&X)!==0&&c===0?t:null;if(n){for(p=0;p<b;p+=1)D[p].a?.measure();for(p=0;p<b;p+=1)D[p].a?.fix()}we(s,D,M)}}if(k)for(const S of l.values())S.o||(P(s,f,S),f=S);s.effect.last=f&&f.e,n&&ye(()=>{if(v!==void 0)for(o of v)o.a?.apply()})}function Ie(s,e,t,r,i,n,c,l){var a=(c&Z)!==0,h=(c&me)===0,f=a?h?de(t,!1,!1):Y(t):t,v=(c&U)===0?i:Y(i),g={i:v,v:f,k:r,a:null,e:null,o:!1,prev:e,next:null};try{if(s===null){var d=document.createDocumentFragment();d.append(s=H())}return g.e=$(()=>n(s,f,v,l)),e!==null&&(e.next=g),g}finally{}}function F(s,e,t){for(var r=s.next?s.next.e.nodes_start:t,i=e?e.e.nodes_start:t,n=s.e.nodes_start;n!==null&&n!==r;){var c=Ae(n);i.before(n),n=c}}function P(s,e,t){e===null?(s.first=t,s.effect.first=t&&t.e):(e.e.next&&(e.e.next.prev=null),e.next=t,e.e.next=t&&t.e),t!==null&&(t.e.prev&&(t.e.prev.next=null),t.prev=e,t.e.prev=e&&e.e)}function te(s){var e,t,r="";if(typeof s=="string"||typeof s=="number")r+=s;else if(typeof s=="object")if(Array.isArray(s)){var i=s.length;for(e=0;e<i;e++)s[e]&&(t=te(s[e]))&&(r&&(r+=" "),r+=t)}else for(t in s)s[t]&&(r&&(r+=" "),r+=t);return r}function xe(){for(var s,e,t=0,r="",i=arguments.length;t<i;t++)(s=arguments[t])&&(e=te(s))&&(r&&(r+=" "),r+=e);return r}function Ce(s){return typeof s=="object"?xe(s):s??""}const Q=[...` 	
\r\fÂ \v\uFEFF`];function Le(s,e,t){var r=s==null?"":""+s;if(e&&(r=r?r+" "+e:e),t){for(var i in t)if(t[i])r=r?r+" "+i:i;else if(r.length)for(var n=i.length,c=0;(c=r.indexOf(i,c))>=0;){var l=c+n;(c===0||Q.includes(r[c-1]))&&(l===r.length||Q.includes(r[l]))?r=(c===0?"":r.substring(0,c))+r.substring(l+1):c=l}}return r===""?null:r}function W(s,e=!1){var t=e?" !important;":";",r="";for(var i in s){var n=s[i];n!=null&&n!==""&&(r+=" "+i+": "+n+t)}return r}function J(s){return s[0]!=="-"||s[1]!=="-"?s.toLowerCase():s}function Ne(s,e){if(e){var t="",r,i;if(Array.isArray(e)?(r=e[0],i=e[1]):r=e,s){s=String(s).replaceAll(/\s*\/\*.*?\*\/\s*/g,"").trim();var n=!1,c=0,l=!1,a=[];r&&a.push(...Object.keys(r).map(J)),i&&a.push(...Object.keys(i).map(J));var h=0,f=-1;const y=s.length;for(var v=0;v<y;v++){var g=s[v];if(l?g==="/"&&s[v-1]==="*"&&(l=!1):n?n===g&&(n=!1):g==="/"&&s[v+1]==="*"?l=!0:g==='"'||g==="'"?n=g:g==="("?c++:g===")"&&c--,!l&&n===!1&&c===0){if(g===":"&&f===-1)f=v;else if(g===";"||v===y-1){if(f!==-1){var d=J(s.substring(h,f).trim());if(!a.includes(d)){g!==";"&&v++;var T=s.substring(h,v).trim();t+=" "+T+";"}}h=v+1,f=-1}}}}return r&&(t+=W(r)),i&&(t+=W(i,!0)),t=t.trim(),t===""?null:t}return s==null?null:String(s)}function Oe(s,e,t,r,i,n){var c=s.__className;if(w||c!==t||c===void 0){var l=Le(t,r,n);(!w||l!==s.getAttribute("class"))&&(l==null?s.removeAttribute("class"):e?s.className=l:s.setAttribute("class",l)),s.__className=t}else if(n&&i!==n)for(var a in n){var h=!!n[a];(i==null||h!==!!i[a])&&s.classList.toggle(a,h)}return n}class u{static instance;static hasLocalStorage(){try{if(typeof globalThis>"u")return!1;const e=globalThis.localStorage;return!!e&&typeof e.getItem=="function"&&typeof e.setItem=="function"&&typeof e.removeItem=="function"}catch{return!1}}static _memoryStorage=null;static _storageResolved=!1;static _usingRealLocalStorage=!1;static getStorage(){try{const e=globalThis.localStorage;if(e&&typeof e.getItem=="function"&&typeof e.setItem=="function"&&typeof e.removeItem=="function")return u._storageResolved||(u._usingRealLocalStorage=!0,u._storageResolved=!0,console.info("UserStatsService: using real localStorage")),e;!u._storageResolved&&e&&(u._usingRealLocalStorage=!1,u._storageResolved=!0,console.warn("UserStatsService: localStorage object detected but missing expected methods â€” using in-memory fallback"))}catch{u._storageResolved||(u._usingRealLocalStorage=!1,u._storageResolved=!0,console.info("UserStatsService: accessing localStorage threw an error â€” using in-memory fallback"))}return u._memoryStorage||(u._memoryStorage=new Map),u._storageResolved||(u._usingRealLocalStorage=!1,u._storageResolved=!0,typeof window<"u"&&console.info("UserStatsService: no localStorage available â€” using in-memory fallback")),{getItem(e){return u._memoryStorage.has(e)?u._memoryStorage.get(e):null},setItem(e,t){u._memoryStorage.set(e,t)},removeItem(e){u._memoryStorage.delete(e)}}}storageKey="jazz-midi-user-stats";profileKey="jazz-midi-user-profile";listeners=[];profile;statistics;constructor(){this.profile=this.loadProfile(),this.statistics=this.loadStatistics()}static getInstance(){return u.instance||(u.instance=new u),u.instance}getProfile(){return{...this.profile}}updateProfile(e){this.profile={...this.profile,...e,lastActivity:new Date},this.saveProfile()}getStatistics(){return{...this.statistics}}recordExerciseResult(e){this.updateOverallStats(e),this.updateTypeStats(e),this.updateMastery(e),this.updateStreak(e),this.checkAchievements(),this.profile.lastActivity=new Date,this.profile.experiencePoints+=this.calculateExperiencePoints(e),this.profile.level=this.calculateLevel(this.profile.experiencePoints),this.saveStatistics(),this.saveProfile(),this.notifyListeners()}getChordMastery(e,t){return this.statistics.masteredChords.find(r=>r.root===e&&r.chordType===t)||null}getScaleMastery(e,t){return this.statistics.masteredScales.find(r=>r.root===e&&r.scaleType===t)||null}getProgressionMastery(e,t){return this.statistics.masteredProgressions.find(r=>r.key===e&&r.progressionType===t)||null}getAchievements(){return this.getDefaultAchievements().map(e=>{const t=this.calculateAchievementProgress(e);return{...e,progress:t,unlockedAt:t>=100?this.profile.lastActivity:void 0}})}startSession(){u.getStorage().setItem("jazz-midi-session-start",Date.now().toString())}endSession(){const e=u.getStorage(),t=e.getItem("jazz-midi-session-start");if(t){const r=(Date.now()-parseInt(t))/6e4;this.recordSession(r),e.removeItem("jazz-midi-session-start")}}exportData(){return JSON.stringify({profile:this.profile,statistics:this.statistics,exportDate:new Date,version:"1.0"},null,2)}importData(e){try{const t=JSON.parse(e);if(t.profile&&t.statistics)return this.profile={...this.profile,...t.profile},this.statistics={...this.statistics,...t.statistics},this.saveProfile(),this.saveStatistics(),this.notifyListeners(),!0}catch(t){console.error("Failed to import user data:",t)}return!1}subscribe(e){return this.listeners.push(e),()=>{const t=this.listeners.indexOf(e);t>-1&&this.listeners.splice(t,1)}}loadProfile(){try{const t=u.getStorage().getItem(this.profileKey);if(t){const r=JSON.parse(t);return{...r,createdAt:new Date(r.createdAt),lastActivity:new Date(r.lastActivity)}}}catch(e){console.warn("Failed to load user profile:",e)}return this.createDefaultProfile()}loadStatistics(){try{const t=u.getStorage().getItem(this.storageKey);if(t){const r=JSON.parse(t);return{...r,masteredChords:r.masteredChords?.map(i=>({...i,lastPracticed:new Date(i.lastPracticed)}))||[],masteredScales:r.masteredScales?.map(i=>({...i,lastPracticed:new Date(i.lastPracticed)}))||[],masteredProgressions:r.masteredProgressions?.map(i=>({...i,lastPracticed:new Date(i.lastPracticed)}))||[],recentSessions:r.recentSessions?.map(i=>({...i,date:new Date(i.date)}))||[]}}}catch(e){console.warn("Failed to load user statistics:",e)}return this.createDefaultStatistics()}createDefaultProfile(){return{id:crypto.randomUUID(),name:"Jazz Student",createdAt:new Date,lastActivity:new Date,totalPracticeTime:0,level:1,experiencePoints:0}}createDefaultStatistics(){return{totalExercises:0,completedExercises:0,averageAccuracy:0,averageScore:0,totalPracticeTime:0,currentStreak:0,longestStreak:0,noteProgress:new Map,chordStats:this.createDefaultTypeStats(),scaleStats:this.createDefaultTypeStats(),progressionStats:this.createDefaultTypeStats(),partitionStats:this.createDefaultTypeStats(),rhythmStats:this.createDefaultTypeStats(),masteredChords:[],masteredScales:[],masteredProgressions:[],recentSessions:[],improvementTrend:0}}createDefaultTypeStats(){return{attempted:0,completed:0,averageAccuracy:0,averageScore:0,bestScore:0,totalTime:0,masteryLevel:"beginner"}}updateOverallStats(e){this.statistics.totalExercises++,e.success&&this.statistics.completedExercises++;const t=this.statistics.totalExercises;this.statistics.averageAccuracy=(this.statistics.averageAccuracy*(t-1)+e.accuracy)/t,this.statistics.averageScore=(this.statistics.averageScore*(t-1)+e.score)/t,this.statistics.totalPracticeTime+=e.timeElapsed/(1e3*60)}updateTypeStats(e){const t=this.getTypeStats(e.exerciseType);t.attempted++,e.success&&t.completed++;const r=t.attempted;t.averageAccuracy=(t.averageAccuracy*(r-1)+e.accuracy)/r,t.averageScore=(t.averageScore*(r-1)+e.score)/r,t.bestScore=Math.max(t.bestScore,e.score),t.totalTime+=e.timeElapsed/(1e3*60),t.masteryLevel=this.calculateMasteryLevel(t)}updateMastery(e){}updateStreak(e){e.success&&e.accuracy>=80?(this.statistics.currentStreak++,this.statistics.longestStreak=Math.max(this.statistics.longestStreak,this.statistics.currentStreak)):this.statistics.currentStreak=0}getTypeStats(e){switch(e){case"chord":return this.statistics.chordStats;case"scale":return this.statistics.scaleStats;case"progression":return this.statistics.progressionStats;case"partition":return this.statistics.partitionStats;case"rhythm":return this.statistics.rhythmStats;default:throw new Error(`Unknown exercise type: ${e}`)}}calculateMasteryLevel(e){return e.averageScore>=90&&e.attempted>=100?"expert":e.averageScore>=80&&e.attempted>=50?"advanced":e.averageScore>=70&&e.attempted>=20?"intermediate":"beginner"}calculateExperiencePoints(e){let t=e.score;return e.success&&(t+=10),e.accuracy>=100&&(t+=20),e.mistakes===0&&(t+=15),t}calculateLevel(e){return Math.floor(e/1e3)+1}recordSession(e){const t={date:new Date,duration:e,exercisesCompleted:0,averageScore:0,topCategory:"chords",improvements:[]};this.statistics.recentSessions.unshift(t),this.statistics.recentSessions.length>10&&this.statistics.recentSessions.pop()}getDefaultAchievements(){return[{id:"first-chord",name:"First Chord",description:"Complete your first chord exercise",icon:"ðŸŽµ",progress:0,requirements:[{type:"exercise_count",target:1,current:0}]},{id:"chord-master",name:"Chord Master",description:"Complete 100 chord exercises",icon:"ðŸŽ¼",progress:0,requirements:[{type:"exercise_count",target:100,current:0}]},{id:"perfect-accuracy",name:"Perfect Performance",description:"Achieve 100% accuracy in an exercise",icon:"â­",progress:0,requirements:[{type:"accuracy",target:100,current:0}]},{id:"practice-streak",name:"Practice Makes Perfect",description:"Maintain a 7-day practice streak",icon:"ðŸ”¥",progress:0,requirements:[{type:"streak",target:7,current:0}]}]}calculateAchievementProgress(e){switch(e.id){case"first-chord":return this.statistics.chordStats.completed>0?100:0;case"chord-master":return Math.min(100,this.statistics.chordStats.completed/100*100);case"perfect-accuracy":return this.statistics.averageAccuracy>=100?100:0;case"practice-streak":return Math.min(100,this.statistics.currentStreak/7*100);default:return 0}}checkAchievements(){}updateNoteProgress(e,t,r,i,n,c){const l=this.generateProgressKey(e,t,r);let a=this.statistics.noteProgress.get(l);a||(a={note:e,exerciseType:t,chordType:r,attempts:0,successes:0,averageAccuracy:0,bestTime:1/0,lastPracticed:new Date,masteryLevel:"beginner"}),a.attempts++,i&&a.successes++,a.averageAccuracy=(a.averageAccuracy*(a.attempts-1)+c)/a.attempts,n<a.bestTime&&(a.bestTime=n),a.lastPracticed=new Date;const h=a.successes/a.attempts;h>=.95&&a.averageAccuracy>=95?a.masteryLevel="mastered":h>=.8&&a.averageAccuracy>=80?a.masteryLevel="advanced":h>=.6&&a.averageAccuracy>=60?a.masteryLevel="intermediate":a.masteryLevel="beginner",this.statistics.noteProgress.set(l,a),this.saveStatistics()}getNoteProgress(e,t,r){const i=this.generateProgressKey(e,t,r);return this.statistics.noteProgress.get(i)}getProgressByType(e){return Array.from(this.statistics.noteProgress.values()).filter(t=>t.exerciseType===e)}generateProgressKey(e,t,r){return r?`${e}-${t}-${r}`:`${e}-${t}`}saveProfile(){try{u.getStorage().setItem(this.profileKey,JSON.stringify(this.profile))}catch(e){console.warn("Failed to save user profile:",e)}}saveStatistics(){try{u.getStorage().setItem(this.storageKey,JSON.stringify(this.statistics))}catch(e){console.warn("Failed to save user statistics:",e)}}notifyListeners(){this.listeners.forEach(e=>{try{e(this.statistics)}catch(t){console.error("Error in stats listener:",t)}})}}const ze=u.getInstance();export{Ce as c,Re as e,Me as i,Oe as s,Ne as t,ze as u};
