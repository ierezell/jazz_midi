import{a_ as Q,P as q,R as X,e as F,w as C,aC as ft,aq as lt,a$ as ut,b0 as dt,o as pt,x as j,y as ht,b1 as gt,k as vt,b2 as mt,D as B,b3 as yt,b4 as St,av as U,b5 as bt,b6 as _t,b7 as wt,b8 as At,b9 as Pt,a0 as kt,E as Tt,ba as Mt,aj as Ct,bb as Dt,aR as tt,ab as $t,W as $,h as Nt,bc as It,bd as Et}from"./CPN3W99e.js";import{b as Lt,c as Ot,d as Rt,n as Ft,e as xt,f as jt}from"./Cf1jdkyt.js";function zt(e,t){var s=void 0,r;Q(()=>{s!==(s=t())&&(r&&(q(r),r=null),s&&(r=X(()=>{F(()=>s(e))})))})}function et(e){var t,s,r="";if(typeof e=="string"||typeof e=="number")r+=e;else if(typeof e=="object")if(Array.isArray(e)){var a=e.length;for(t=0;t<a;t++)e[t]&&(s=et(e[t]))&&(r&&(r+=" "),r+=s)}else for(s in e)e[s]&&(r&&(r+=" "),r+=s);return r}function Kt(){for(var e,t,s=0,r="",a=arguments.length;s<a;s++)(e=arguments[s])&&(t=et(e))&&(r&&(r+=" "),r+=t);return r}function qt(e){return typeof e=="object"?Kt(e):e??""}const V=[...` 	
\r\fÂ \v\uFEFF`];function Jt(e,t,s){var r=e==null?"":""+e;if(t&&(r=r?r+" "+t:t),s){for(var a in s)if(s[a])r=r?r+" "+a:a;else if(r.length)for(var i=a.length,o=0;(o=r.indexOf(a,o))>=0;){var n=o+i;(o===0||V.includes(r[o-1]))&&(n===r.length||V.includes(r[n]))?r=(o===0?"":r.substring(0,o))+r.substring(n+1):o=n}}return r===""?null:r}function G(e,t=!1){var s=t?" !important;":";",r="";for(var a in e){var i=e[a];i!=null&&i!==""&&(r+=" "+a+": "+i+s)}return r}function z(e){return e[0]!=="-"||e[1]!=="-"?e.toLowerCase():e}function Wt(e,t){if(t){var s="",r,a;if(Array.isArray(t)?(r=t[0],a=t[1]):r=t,e){e=String(e).replaceAll(/\s*\/\*.*?\*\/\s*/g,"").trim();var i=!1,o=0,n=!1,c=[];r&&c.push(...Object.keys(r).map(z)),a&&c.push(...Object.keys(a).map(z));var l=0,u=-1;const v=e.length;for(var g=0;g<v;g++){var f=e[g];if(n?f==="/"&&e[g-1]==="*"&&(n=!1):i?i===f&&(i=!1):f==="/"&&e[g+1]==="*"?n=!0:f==='"'||f==="'"?i=f:f==="("?o++:f===")"&&o--,!n&&i===!1&&o===0){if(f===":"&&u===-1)u=g;else if(f===";"||g===v-1){if(u!==-1){var S=z(e.substring(l,u).trim());if(!c.includes(S)){f!==";"&&g++;var y=e.substring(l,g).trim();s+=" "+y+";"}}l=g+1,u=-1}}}}return r&&(s+=G(r)),a&&(s+=G(a,!0)),s=s.trim(),s===""?null:s}return e==null?null:String(e)}function Bt(e,t,s,r,a,i){var o=e.__className;if(C||o!==s||o===void 0){var n=Jt(s,r,i);(!C||n!==e.getAttribute("class"))&&(n==null?e.removeAttribute("class"):t?e.className=n:e.setAttribute("class",n)),e.__className=s}else if(i&&a!==i)for(var c in i){var l=!!i[c];(a==null||l!==!!a[c])&&e.classList.toggle(c,l)}return i}function K(e,t={},s,r){for(var a in s){var i=s[a];t[a]!==i&&(s[a]==null?e.style.removeProperty(a):e.style.setProperty(a,i,r))}}function Vt(e,t,s,r){var a=e.__style;if(C||a!==t){var i=Wt(t,r);(!C||i!==e.getAttribute("style"))&&(i==null?e.removeAttribute("style"):e.style.cssText=i),e.__style=t}else r&&(Array.isArray(r)?(K(e,s?.[0],r[0]),K(e,s?.[1],r[1],"important")):K(e,s,r));return r}function O(e,t,s=!1){if(e.multiple){if(t==null)return;if(!lt(t))return ut();for(var r of e.options)r.selected=t.includes(E(r));return}for(r of e.options){var a=E(r);if(dt(a,t)){r.selected=!0;return}}(!s||t!==void 0)&&(e.selectedIndex=-1)}function st(e){var t=new MutationObserver(()=>{O(e,e.__value)});t.observe(e,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),ft(()=>{t.disconnect()})}function re(e,t,s=t){var r=new WeakSet,a=!0;pt(e,"change",i=>{var o=i?"[selected]":":checked",n;if(e.multiple)n=[].map.call(e.querySelectorAll(o),E);else{var c=e.querySelector(o)??e.querySelector("option:not([disabled])");n=c&&E(c)}s(n),j!==null&&r.add(j)}),F(()=>{var i=t();if(e===document.activeElement){var o=ht??j;if(r.has(o))return}if(O(e,i,a),a&&i===void 0){var n=e.querySelector(":checked");n!==null&&(i=E(n),s(i))}e.__value=i,a=!1}),st(e)}function E(e){return"__value"in e?e.__value:e.value}const N=Symbol("class"),I=Symbol("style"),rt=Symbol("is custom element"),at=Symbol("is html");function Gt(e){if(C){var t=!1,s=()=>{if(!t){if(t=!0,e.hasAttribute("value")){var r=e.value;R(e,"value",null),e.value=r}if(e.hasAttribute("checked")){var a=e.checked;R(e,"checked",null),e.checked=a}}};e.__on_r=s,U(s),bt()}}function ae(e,t){var s=x(e);s.value===(s.value=t??void 0)||e.value===t&&(t!==0||e.nodeName!=="PROGRESS")||(e.value=t??"")}function ie(e,t){var s=x(e);s.checked!==(s.checked=t??void 0)&&(e.checked=t)}function Ht(e,t){t?e.hasAttribute("selected")||e.setAttribute("selected",""):e.removeAttribute("selected")}function R(e,t,s,r){var a=x(e);C&&(a[t]=e.getAttribute(t),t==="src"||t==="srcset"||t==="href"&&e.nodeName==="LINK")||a[t]!==(a[t]=s)&&(t==="loading"&&(e[At]=s),s==null?e.removeAttribute(t):typeof s!="string"&&it(e).includes(t)?e[t]=s:e.setAttribute(t,s))}function Yt(e,t,s,r,a=!1,i=!1){if(C&&a&&e.tagName==="INPUT"){var o=e,n=o.type==="checkbox"?"defaultChecked":"defaultValue";n in s||Gt(o)}var c=x(e),l=c[rt],u=!c[at];let g=C&&l;g&&B(!1);var f=t||{},S=e.tagName==="OPTION";for(var y in t)y in s||(s[y]=null);s.class?s.class=qt(s.class):(r||s[N])&&(s.class=null),s[I]&&(s.style??=null);var v=it(e);for(const h in s){let m=s[h];if(S&&h==="value"&&m==null){e.value=e.__value="",f[h]=m;continue}if(h==="class"){var b=e.namespaceURI==="http://www.w3.org/1999/xhtml";Bt(e,b,m,r,t?.[N],s[N]),f[h]=m,f[N]=s[N];continue}if(h==="style"){Vt(e,m,t?.[I],s[I]),f[h]=m,f[I]=s[I];continue}var d=f[h];if(!(m===d&&!(m===void 0&&e.hasAttribute(h)))){f[h]=m;var A=h[0]+h[1];if(A!=="$$")if(A==="on"){const w={},k="$$"+h;let P=h.slice(2);var T=xt(P);if(Lt(P)&&(P=P.slice(0,-7),w.capture=!0),!T&&d){if(m!=null)continue;e.removeEventListener(P,f[k],w),f[k]=null}if(m!=null)if(T)e[`__${P}`]=m,Rt([P]);else{let ct=function(nt){f[h].call(this,nt)};f[k]=Ot(P,e,ct,w)}else T&&(e[`__${P}`]=void 0)}else if(h==="style")R(e,h,m);else if(h==="autofocus")yt(e,!!m);else if(!l&&(h==="__value"||h==="value"&&m!=null))e.value=e.__value=m;else if(h==="selected"&&S)Ht(e,m);else{var _=h;u||(_=Ft(_));var D=_==="defaultValue"||_==="defaultChecked";if(m==null&&!l&&!D)if(c[h]=null,_==="value"||_==="checked"){let w=e;const k=t===void 0;if(_==="value"){let P=w.defaultValue;w.removeAttribute(_),w.defaultValue=P,w.value=w.__value=k?P:null}else{let P=w.defaultChecked;w.removeAttribute(_),w.defaultChecked=P,w.checked=k?P:!1}}else e.removeAttribute(h);else D||v.includes(_)&&(l||typeof m!="string")?(e[_]=m,_ in c&&(c[_]=St)):typeof m!="function"&&R(e,_,m)}}}return g&&B(!0),f}function oe(e,t,s=[],r=[],a=[],i,o=!1,n=!1){gt(a,s,r,c=>{var l=void 0,u={},g=e.nodeName==="SELECT",f=!1;if(Q(()=>{var y=t(...c.map(vt)),v=Yt(e,l,y,i,o,n);f&&g&&"value"in y&&O(e,y.value);for(let d of Object.getOwnPropertySymbols(u))y[d]||q(u[d]);for(let d of Object.getOwnPropertySymbols(y)){var b=y[d];d.description===mt&&(!l||b!==l[d])&&(u[d]&&q(u[d]),u[d]=X(()=>zt(e,()=>b))),v[d]=b}l=v}),g){var S=e;F(()=>{O(S,l.value,!0),st(S)})}f=!0})}function x(e){return e.__attributes??={[rt]:e.nodeName.includes("-"),[at]:e.namespaceURI===_t}}var H=new Map;function it(e){var t=e.getAttribute("is")||e.nodeName,s=H.get(t);if(s)return s;H.set(t,s=[]);for(var r,a=e,i=Element.prototype;i!==a;){r=Pt(a);for(var o in r)r[o].set&&s.push(o);a=wt(a)}return s}const Zt=()=>performance.now(),M={tick:e=>requestAnimationFrame(e),now:()=>Zt(),tasks:new Set};function ot(){const e=M.now();M.tasks.forEach(t=>{t.c(e)||(M.tasks.delete(t),t.f())}),M.tasks.size!==0&&M.tick(ot)}function Qt(e){let t;return M.tasks.size===0&&M.tick(ot),{promise:new Promise(s=>{M.tasks.add(t={c:e,f:s})}),abort(){M.tasks.delete(t)}}}function L(e,t){tt(()=>{e.dispatchEvent(new CustomEvent(t))})}function Xt(e){if(e==="float")return"cssFloat";if(e==="offset")return"cssOffset";if(e.startsWith("--"))return e;const t=e.split("-");return t.length===1?t[0]:t[0]+t.slice(1).map(s=>s[0].toUpperCase()+s.slice(1)).join("")}function Y(e){const t={},s=e.split(";");for(const r of s){const[a,i]=r.split(":");if(!a||i===void 0)break;const o=Xt(a.trim());t[o]=i.trim()}return t}const Ut=e=>e;function ce(e,t,s,r){var a=(e&It)!==0,i=(e&Et)!==0,o=a&&i,n=(e&Dt)!==0,c=o?"both":a?"in":"out",l,u=t.inert,g=t.style.overflow,f,S;function y(){return tt(()=>l??=s()(t,r?.()??{},{direction:c}))}var v={is_global:n,in(){if(t.inert=u,!a){S?.abort(),S?.reset?.();return}i||f?.abort(),L(t,"introstart"),f=J(t,y(),S,1,()=>{L(t,"introend"),f?.abort(),f=l=void 0,t.style.overflow=g})},out(T){if(!i){T?.(),l=void 0;return}t.inert=!0,L(t,"outrostart"),S=J(t,y(),f,0,()=>{L(t,"outroend"),T?.()})},stop:()=>{f?.abort(),S?.abort()}},b=kt;if((b.transitions??=[]).push(v),a&&jt){var d=n;if(!d){for(var A=b.parent;A&&(A.f&Tt)!==0;)for(;(A=A.parent)&&(A.f&Mt)===0;);d=!A||(A.f&Ct)!==0}d&&F(()=>{Nt(()=>v.in())})}}function J(e,t,s,r,a){var i=r===1;if($t(t)){var o,n=!1;return U(()=>{if(!n){var b=t({direction:i?"in":"out"});o=J(e,b,s,r,a)}}),{abort:()=>{n=!0,o?.abort()},deactivate:()=>o.deactivate(),reset:()=>o.reset(),t:()=>o.t()}}if(s?.deactivate(),!t?.duration)return a(),{abort:$,deactivate:$,reset:$,t:()=>r};const{delay:c=0,css:l,tick:u,easing:g=Ut}=t;var f=[];if(i&&s===void 0&&(u&&u(0,1),l)){var S=Y(l(0,1));f.push(S,S)}var y=()=>1-r,v=e.animate(f,{duration:c,fill:"forwards"});return v.onfinish=()=>{v.cancel();var b=s?.t()??1-r;s?.abort();var d=r-b,A=t.duration*Math.abs(d),T=[];if(A>0){var _=!1;if(l)for(var D=Math.ceil(A/16.666666666666668),h=0;h<=D;h+=1){var m=b+d*g(h/D),w=Y(l(m,1-m));T.push(w),_||=w.overflow==="hidden"}_&&(e.style.overflow="hidden"),y=()=>{var k=v.currentTime;return b+d*g(k/A)},u&&Qt(()=>{if(v.playState!=="running")return!1;var k=y();return u(k,1-k),!0})}v=e.animate(T,{duration:A,fill:"forwards"}),v.onfinish=()=>{y=()=>r,u?.(r,1-r),a()}},{abort:()=>{v&&(v.cancel(),v.effect=null,v.onfinish=$)},deactivate:()=>{a=$},reset:()=>{r===0&&u?.(1,0)},t:()=>y()}}class p{static instance;static hasLocalStorage(){try{if(typeof globalThis>"u")return!1;const t=globalThis.localStorage;return!!t&&typeof t.getItem=="function"&&typeof t.setItem=="function"&&typeof t.removeItem=="function"}catch{return!1}}static _memoryStorage=null;static _storageResolved=!1;static _usingRealLocalStorage=!1;static getStorage(){try{const t=globalThis.localStorage;if(t&&typeof t.getItem=="function"&&typeof t.setItem=="function"&&typeof t.removeItem=="function")return p._storageResolved||(p._usingRealLocalStorage=!0,p._storageResolved=!0,console.info("UserStatsService: using real localStorage")),t;!p._storageResolved&&t&&(p._usingRealLocalStorage=!1,p._storageResolved=!0,console.warn("UserStatsService: localStorage object detected but missing expected methods â€” using in-memory fallback"))}catch{p._storageResolved||(p._usingRealLocalStorage=!1,p._storageResolved=!0,console.info("UserStatsService: accessing localStorage threw an error â€” using in-memory fallback"))}return p._memoryStorage||(p._memoryStorage=new Map),p._storageResolved||(p._usingRealLocalStorage=!1,p._storageResolved=!0,typeof window<"u"&&console.info("UserStatsService: no localStorage available â€” using in-memory fallback")),{getItem(t){return p._memoryStorage.has(t)?p._memoryStorage.get(t):null},setItem(t,s){p._memoryStorage.set(t,s)},removeItem(t){p._memoryStorage.delete(t)}}}storageKey="jazz-midi-user-stats";profileKey="jazz-midi-user-profile";listeners=[];profile;statistics;constructor(){this.profile=this.loadProfile(),this.statistics=this.loadStatistics()}static getInstance(){return p.instance||(p.instance=new p),p.instance}getProfile(){return{...this.profile}}updateProfile(t){this.profile={...this.profile,...t,lastActivity:new Date},this.saveProfile()}createProfile(t){this.profile={...this.createDefaultProfile(),id:crypto.randomUUID(),name:t,createdAt:new Date,lastActivity:new Date},this.saveProfile(),this.statistics=this.createDefaultStatistics(),this.saveStatistics(),this.notifyListeners()}getStatistics(){return{...this.statistics}}recordExerciseResult(t){this.updateOverallStats(t),this.updateTypeStats(t),this.updateMastery(t),this.updateStreak(t),this.updateDailyPractice(t),this.checkAchievements(),this.profile.lastActivity=new Date,this.profile.experiencePoints+=this.calculateExperiencePoints(t),this.profile.level=this.calculateLevel(this.profile.experiencePoints),this.saveStatistics(),this.saveProfile(),this.notifyListeners()}getChordMastery(t,s){return this.statistics.masteredChords.find(r=>r.root===t&&r.chordType===s)||null}getScaleMastery(t,s){return this.statistics.masteredScales.find(r=>r.root===t&&r.scaleType===s)||null}getProgressionMastery(t,s){return this.statistics.masteredProgressions.find(r=>r.key===t&&r.progressionType===s)||null}getAchievements(){return this.getDefaultAchievements().map(t=>{const s=this.calculateAchievementProgress(t);return{...t,progress:s,unlockedAt:s>=100?this.profile.lastActivity:void 0}})}startSession(){p.getStorage().setItem("jazz-midi-session-start",Date.now().toString())}endSession(){const t=p.getStorage(),s=t.getItem("jazz-midi-session-start");if(s){const r=(Date.now()-parseInt(s))/6e4;this.recordSession(r),t.removeItem("jazz-midi-session-start")}}exportData(){return JSON.stringify({profile:this.profile,statistics:this.statistics,exportDate:new Date,version:"1.0"},null,2)}importData(t){try{const s=JSON.parse(t);if(s.profile&&s.statistics)return this.profile={...this.profile,...s.profile},this.statistics={...this.statistics,...s.statistics},this.saveProfile(),this.saveStatistics(),this.notifyListeners(),!0}catch(s){console.error("Failed to import user data:",s)}return!1}subscribe(t){return this.listeners.push(t),()=>{const s=this.listeners.indexOf(t);s>-1&&this.listeners.splice(s,1)}}loadProfile(){try{const s=p.getStorage().getItem(this.profileKey);if(s){const r=JSON.parse(s);return{...r,createdAt:new Date(r.createdAt),lastActivity:new Date(r.lastActivity)}}}catch(t){console.warn("Failed to load user profile:",t)}return this.createDefaultProfile()}loadStatistics(){try{const s=p.getStorage().getItem(this.storageKey);if(s){const r=JSON.parse(s);return{...r,masteredChords:r.masteredChords?.map(a=>({...a,lastPracticed:new Date(a.lastPracticed)}))||[],masteredScales:r.masteredScales?.map(a=>({...a,lastPracticed:new Date(a.lastPracticed)}))||[],masteredProgressions:r.masteredProgressions?.map(a=>({...a,lastPracticed:new Date(a.lastPracticed)}))||[],recentSessions:r.recentSessions?.map(a=>({...a,date:new Date(a.date)}))||[]}}}catch(t){console.warn("Failed to load user statistics:",t)}return this.createDefaultStatistics()}createDefaultProfile(){return{id:crypto.randomUUID(),name:"Jazz Student",createdAt:new Date,lastActivity:new Date,totalPracticeTime:0,level:1,experiencePoints:0}}createDefaultStatistics(){return{totalExercises:0,completedExercises:0,averageAccuracy:0,averageScore:0,totalPracticeTime:0,currentStreak:0,longestStreak:0,noteProgress:new Map,missedNotes:new Map,missedChords:new Map,practiceCalendar:new Map,chordStats:this.createDefaultTypeStats(),scaleStats:this.createDefaultTypeStats(),progressionStats:this.createDefaultTypeStats(),partitionStats:this.createDefaultTypeStats(),rhythmStats:this.createDefaultTypeStats(),masteredChords:[],masteredScales:[],masteredProgressions:[],recentSessions:[],improvementTrend:0}}createDefaultTypeStats(){return{attempted:0,completed:0,averageAccuracy:0,averageScore:0,bestScore:0,totalTime:0,masteryLevel:"beginner"}}updateOverallStats(t){this.statistics.totalExercises++,t.success&&this.statistics.completedExercises++;const s=this.statistics.totalExercises;this.statistics.averageAccuracy=(this.statistics.averageAccuracy*(s-1)+t.accuracy)/s,this.statistics.averageScore=(this.statistics.averageScore*(s-1)+t.score)/s,this.statistics.totalPracticeTime+=t.timeElapsed/(1e3*60)}updateTypeStats(t){const s=this.getTypeStats(t.exerciseType);s.attempted++,t.success&&s.completed++;const r=s.attempted;s.averageAccuracy=(s.averageAccuracy*(r-1)+t.accuracy)/r,s.averageScore=(s.averageScore*(r-1)+t.score)/r,s.bestScore=Math.max(s.bestScore,t.score),s.totalTime+=t.timeElapsed/(1e3*60),s.masteryLevel=this.calculateMasteryLevel(s)}updateMastery(t){}updateStreak(t){t.success&&t.accuracy>=80?(this.statistics.currentStreak++,this.statistics.longestStreak=Math.max(this.statistics.longestStreak,this.statistics.currentStreak)):this.statistics.currentStreak=0}getTypeStats(t){switch(t){case"chord":return this.statistics.chordStats;case"scale":return this.statistics.scaleStats;case"progression":return this.statistics.progressionStats;case"partition":return this.statistics.partitionStats;case"rhythm":return this.statistics.rhythmStats;default:throw new Error(`Unknown exercise type: ${t}`)}}calculateMasteryLevel(t){return t.averageScore>=90&&t.attempted>=100?"expert":t.averageScore>=80&&t.attempted>=50?"advanced":t.averageScore>=70&&t.attempted>=20?"intermediate":"beginner"}calculateExperiencePoints(t){let s=t.score;return t.success&&(s+=10),t.accuracy>=100&&(s+=20),t.mistakes===0&&(s+=15),s}calculateLevel(t){return Math.floor(t/1e3)+1}recordSession(t){const s={date:new Date,duration:t,exercisesCompleted:0,averageScore:0,topCategory:"chords",improvements:[]};this.statistics.recentSessions.unshift(s),this.statistics.recentSessions.length>10&&this.statistics.recentSessions.pop()}getDefaultAchievements(){return[{id:"first-chord",name:"First Chord",description:"Complete your first chord exercise",icon:"ðŸŽµ",progress:0,requirements:[{type:"exercise_count",target:1,current:0}]},{id:"chord-master",name:"Chord Master",description:"Complete 100 chord exercises",icon:"ðŸŽ¼",progress:0,requirements:[{type:"exercise_count",target:100,current:0}]},{id:"perfect-accuracy",name:"Perfect Performance",description:"Achieve 100% accuracy in an exercise",icon:"â­",progress:0,requirements:[{type:"accuracy",target:100,current:0}]},{id:"practice-streak",name:"Practice Makes Perfect",description:"Maintain a 7-day practice streak",icon:"ðŸ”¥",progress:0,requirements:[{type:"streak",target:7,current:0}]}]}calculateAchievementProgress(t){switch(t.id){case"first-chord":return this.statistics.chordStats.completed>0?100:0;case"chord-master":return Math.min(100,this.statistics.chordStats.completed/100*100);case"perfect-accuracy":return this.statistics.averageAccuracy>=100?100:0;case"practice-streak":return Math.min(100,this.statistics.currentStreak/7*100);default:return 0}}checkAchievements(){}updateNoteProgress(t,s,r,a,i,o){const n=this.generateProgressKey(t,s,r);let c=this.statistics.noteProgress.get(n);c||(c={note:t,exerciseType:s,chordType:r,attempts:0,successes:0,averageAccuracy:0,bestTime:1/0,lastPracticed:new Date,masteryLevel:"beginner"}),c.attempts++,a&&c.successes++,c.averageAccuracy=(c.averageAccuracy*(c.attempts-1)+o)/c.attempts,i<c.bestTime&&(c.bestTime=i),c.lastPracticed=new Date;const l=c.successes/c.attempts;l>=.95&&c.averageAccuracy>=95?c.masteryLevel="mastered":l>=.8&&c.averageAccuracy>=80?c.masteryLevel="advanced":l>=.6&&c.averageAccuracy>=60?c.masteryLevel="intermediate":c.masteryLevel="beginner",this.statistics.noteProgress.set(n,c),this.saveStatistics()}getNoteProgress(t,s,r){const a=this.generateProgressKey(t,s,r);return this.statistics.noteProgress.get(a)}getProgressByType(t){return Array.from(this.statistics.noteProgress.values()).filter(s=>s.exerciseType===t)}generateProgressKey(t,s,r){return r?`${t}-${s}-${r}`:`${t}-${s}`}saveProfile(){try{p.getStorage().setItem(this.profileKey,JSON.stringify(this.profile))}catch(t){console.warn("Failed to save user profile:",t)}}saveStatistics(){try{p.getStorage().setItem(this.storageKey,JSON.stringify(this.statistics))}catch(t){console.warn("Failed to save user statistics:",t)}}notifyListeners(){this.listeners.forEach(t=>{try{t(this.statistics)}catch(s){console.error("Error in stats listener:",s)}})}trackMissedNote(t,s){const r=this.statistics.missedNotes.get(t);r?(r.count++,r.lastMissed=new Date):this.statistics.missedNotes.set(t,{count:1,lastMissed:new Date,exerciseType:s}),this.saveStatistics()}trackMissedChord(t,s){const r=this.statistics.missedChords.get(t);r?(r.count++,r.lastMissed=new Date):this.statistics.missedChords.set(t,{count:1,lastMissed:new Date,exerciseType:s}),this.saveStatistics()}getMostMissedNotes(t=12){return this.statistics.missedNotes instanceof Map||(this.statistics.missedNotes=new Map),Array.from(this.statistics.missedNotes.entries()).map(([s,r])=>({note:s,count:r.count,lastMissed:r.lastMissed})).sort((s,r)=>r.count-s.count).slice(0,t)}getMostMissedChords(t=5){return this.statistics.missedChords instanceof Map||(this.statistics.missedChords=new Map),Array.from(this.statistics.missedChords.entries()).map(([s,r])=>({chord:s,count:r.count,lastMissed:r.lastMissed,exerciseType:r.exerciseType})).sort((s,r)=>r.count-s.count).slice(0,t)}getWeaknessRecommendations(){const t=[],s=this.getMostMissedNotes(3),r=this.getMostMissedChords(3);return s.forEach(({note:a})=>{const i=a.replace(/[0-9]/g,"");t.push({weakness:`Note: ${a}`,recommendedExercise:`${i} Major Scale`,path:`/exercises/scales?root=${i}&mode=Maj`})}),r.forEach(({chord:a})=>{t.push({weakness:`Chord: ${a}`,recommendedExercise:`${a} Practice`,path:"/exercises/chords?root=C&quality=maj7"})}),t.slice(0,5)}updateDailyPractice(t){const r=new Date().toISOString().split("T")[0],a=this.statistics.practiceCalendar.get(r);a?(a.exercisesCompleted++,a.practiceTime+=t.timeElapsed/(1e3*60)):this.statistics.practiceCalendar.set(r,{date:r,exercisesCompleted:1,practiceTime:t.timeElapsed/(1e3*60)})}getPracticeCalendar(t=84){const s=[],r=new Date;this.statistics.practiceCalendar instanceof Map||(this.statistics.practiceCalendar=new Map);for(let a=t-1;a>=0;a--){const i=new Date(r);i.setDate(i.getDate()-a);const o=i.toISOString().split("T")[0],n=this.statistics.practiceCalendar.get(o);n?s.push(n):s.push({date:o,exercisesCompleted:0,practiceTime:0})}return s}getPracticeStreak(){const t=new Date;let s=0,r=0,a=0;const i=t.toISOString().split("T")[0];this.statistics.practiceCalendar.has(i);for(let o=0;o<365;o++){const n=new Date(t);n.setDate(n.getDate()-o);const c=n.toISOString().split("T")[0];if(this.statistics.practiceCalendar.has(c)){if(o===0||a>0)a++,s===0&&(s=a);else break;r=Math.max(r,a)}else{if(o===0)continue;a>0&&(r=Math.max(r,a),a=0)}}return{current:s,longest:Math.max(r,this.statistics.longestStreak)}}}const ne=p.getInstance(),te=e=>e;function W(e){const t=e-1;return t*t*t+1}function Z(e){const t=typeof e=="string"&&e.match(/^\s*(-?[\d.]+)([^\s]*)\s*$/);return t?[parseFloat(t[1]),t[2]||"px"]:[e,"px"]}function fe(e,{delay:t=0,duration:s=400,easing:r=te}={}){const a=+getComputedStyle(e).opacity;return{delay:t,duration:s,easing:r,css:i=>`opacity: ${i*a}`}}function le(e,{delay:t=0,duration:s=400,easing:r=W,x:a=0,y:i=0,opacity:o=0}={}){const n=getComputedStyle(e),c=+n.opacity,l=n.transform==="none"?"":n.transform,u=c*(1-o),[g,f]=Z(a),[S,y]=Z(i);return{delay:t,duration:s,easing:r,css:(v,b)=>`
			transform: ${l} translate(${(1-v)*g}${f}, ${(1-v)*S}${y});
			opacity: ${c-u*b}`}}function ue(e,{delay:t=0,duration:s=400,easing:r=W,axis:a="y"}={}){const i=getComputedStyle(e),o=+i.opacity,n=a==="y"?"height":"width",c=parseFloat(i[n]),l=a==="y"?["top","bottom"]:["left","right"],u=l.map(d=>`${d[0].toUpperCase()}${d.slice(1)}`),g=parseFloat(i[`padding${u[0]}`]),f=parseFloat(i[`padding${u[1]}`]),S=parseFloat(i[`margin${u[0]}`]),y=parseFloat(i[`margin${u[1]}`]),v=parseFloat(i[`border${u[0]}Width`]),b=parseFloat(i[`border${u[1]}Width`]);return{delay:t,duration:s,easing:r,css:d=>`overflow: hidden;opacity: ${Math.min(d*20,1)*o};${n}: ${d*c}px;padding-${l[0]}: ${d*g}px;padding-${l[1]}: ${d*f}px;margin-${l[0]}: ${d*S}px;margin-${l[1]}: ${d*y}px;border-${l[0]}-width: ${d*v}px;border-${l[1]}-width: ${d*b}px;min-${n}: 0`}}function de(e,{delay:t=0,duration:s=400,easing:r=W,start:a=0,opacity:i=0}={}){const o=getComputedStyle(e),n=+o.opacity,c=o.transform==="none"?"":o.transform,l=1-a,u=n*(1-i);return{delay:t,duration:s,easing:r,css:(g,f)=>`
			transform: ${c} scale(${1-l*f});
			opacity: ${n-u*f}
		`}}export{N as C,Bt as a,R as b,le as c,oe as d,ie as e,fe as f,qt as g,ue as h,st as i,Vt as j,ae as k,re as l,de as m,Gt as r,O as s,ce as t,ne as u};
